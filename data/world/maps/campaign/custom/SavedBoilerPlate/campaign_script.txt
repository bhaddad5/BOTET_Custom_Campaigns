    ;;;;;;;;;;;;;START END TIMES SCRIPTS;;;;;;;;;;;;;;;

   ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Hunting, fishing, harvest. Isilendil;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


    declare_counter turn_end_mushrooms
    set_counter turn_end_mushrooms 0


    monitor_event PreFactionTurnStart FactionIsLocal
        inc_counter turn_end_mushrooms 1
        generate_random_counter hunt 1 5
        generate_random_counter fishing 1 5

        ;;;;;;;;;;;;;;;즲  󰬠𪠻;;;;;;;;;;;;;;;;;;;;;;;

        if I_CompareCounter month = 6
            set_event_counter summer_market 1
            historic_event SUMMER_MARKET_START factions { southern_european, eastern_european, }
        end_if
        if I_CompareCounter month > 6
            set_event_counter summer_market 0
        end_if
        if I_CompareCounter month < 6
            set_event_counter summer_market 0
        end_if

        ;;;;;;;;;;;;;;;Ϫ򮡥𴥱򻻻;;;;;;;;;;;;;;;;;;;;;

        if I_CompareCounter month = 10
            set_event_counter octoberfest 1
            historic_event OCTOBERFEST_START factions { poland, }
        end_if
        if I_CompareCounter month > 10
            set_event_counter octoberfest 0
        end_if
        if I_CompareCounter month < 10
            set_event_counter octoberfest 0
        end_if
        ;;;;;;;;;;;;;;;İ颻;;;;;;;;;;;;;;;;;;;;;;;;

        if I_CompareCounter month = 8
            set_event_counter morrslieb 1
            historic_event MORRSLIEB factions { hungary, }
        end_if
        if I_CompareCounter month > 8
            set_event_counter morrslieb 0
        end_if
        if I_CompareCounter month < 8
            set_event_counter morrslieb 0
        end_if
        ;;;;;;;;;;;;;;;İ颻;;;;;;;;;;;;;;;;;;;;;;;;
        if I_CompareCounter turn_end_mushrooms = 3
            generate_random_counter mushrooms 1 5
            set_counter turn_end_mushrooms 0
        end_if

        if I_EventCounter mushrooms = 5
            set_event_counter very_good_mushrooms 1
            set_event_counter good_mushrooms 0
            set_event_counter normal_mushrooms 0
            set_event_counter bad_mushrooms 0
            set_event_counter very_bad_mushrooms 0
            historic_event SHROOMS_VERY_GOOD factions { greek, moors, }
        end_if

        if I_EventCounter mushrooms = 4
            set_event_counter very_good_mushrooms 0
            set_event_counter good_mushrooms 1
            set_event_counter normal_mushrooms 0
            set_event_counter bad_mushrooms 0
            set_event_counter very_bad_mushrooms 0
            historic_event SHROOMS_GOOD factions { greek, moors, }
        end_if

        if I_EventCounter mushrooms = 3
            set_event_counter very_good_mushrooms 0
            set_event_counter good_mushrooms 0
            set_event_counter normal_mushrooms 1
            set_event_counter bad_mushrooms 0
            set_event_counter very_bad_mushrooms 0
        end_if

        if I_EventCounter mushrooms = 2
            set_event_counter very_good_mushrooms 0
            set_event_counter good_mushrooms 0
            set_event_counter normal_mushrooms 0
            set_event_counter bad_mushrooms 1
            set_event_counter very_bad_mushrooms 0
            historic_event SHROOMS_BAD factions { greek, moors, }
        end_if

        if I_EventCounter mushrooms = 1
            set_event_counter very_good_mushrooms 0
            set_event_counter good_mushrooms 0
            set_event_counter normal_mushrooms 0
            set_event_counter bad_mushrooms 0
            set_event_counter very_bad_mushrooms 1
            historic_event SHROOMS_VERY_BAD factions { greek, moors, }
        end_if
        ;;;;;;;;;;;;;;;ϵﳠ;;;;;;;;;;;;;;;;;;;;;;;;

        if I_EventCounter hunt = 5
            set_event_counter very_good_hunt 1
            set_event_counter good_hunt 0
            set_event_counter normal_hunt 0
            set_event_counter bad_hunt 0
            set_event_counter very_bad_hunt 0
            historic_event HUNT_VERY_GOOD factions { Nord_culture, turks, skaven, egypt, }
        end_if

        if I_EventCounter hunt = 4
            set_event_counter very_good_hunt 0
            set_event_counter good_hunt 1
            set_event_counter normal_hunt 0
            set_event_counter bad_hunt 0
            set_event_counter very_bad_hunt 0
            historic_event HUNT_GOOD factions { Nord_culture, turks, skaven, egypt, }
        end_if

        if I_EventCounter hunt = 3
            set_event_counter very_good_hunt 0
            set_event_counter good_hunt 0
            set_event_counter normal_hunt 1
            set_event_counter bad_hunt 0
            set_event_counter very_bad_hunt 0
        end_if

        if I_EventCounter hunt = 2
            set_event_counter very_good_hunt 0
            set_event_counter good_hunt 0
            set_event_counter normal_hunt 0
            set_event_counter bad_hunt 1
            set_event_counter very_bad_hunt 0
            historic_event HUNT_BAD factions { Nord_culture, turks, skaven, egypt, }
        end_if

        if I_EventCounter hunt = 1
            set_event_counter very_good_hunt 0
            set_event_counter good_hunt 0
            set_event_counter normal_hunt 0
            set_event_counter bad_hunt 0
            set_event_counter very_bad_hunt 1
            historic_event HUNT_VERY_BAD factions { Nord_culture, turks, skaven, egypt, }
        end_if


        ;;;;;;;;;;;;;;;ѻ⡫렻;;;;;;;;;;;;;;;;;;;;;;;

        if I_EventCounter fishing = 5
            set_event_counter very_good_fishing 1
            set_event_counter good_fishing 0
            set_event_counter normal_fishing 0
            set_event_counter bad_fishing 0
            set_event_counter very_bad_fishing 0
        end_if

        if I_EventCounter fishing = 4
            set_event_counter very_good_fishing 0
            set_event_counter good_fishing 1
            set_event_counter normal_fishing 0
            set_event_counter bad_fishing 0
            set_event_counter very_bad_fishing 0
        end_if

        if I_EventCounter fishing = 3
            set_event_counter very_good_fishing 0
            set_event_counter good_fishing 0
            set_event_counter normal_fishing 1
            set_event_counter bad_fishing 0
            set_event_counter very_bad_fishing 0
        end_if

        if I_EventCounter fishing = 2
            set_event_counter very_good_fishing 0
            set_event_counter good_fishing 0
            set_event_counter normal_fishing 0
            set_event_counter bad_fishing 1
            set_event_counter very_bad_fishing 0
        end_if

        if I_EventCounter fishing = 1
            set_event_counter very_good_fishing 0
            set_event_counter good_fishing 0
            set_event_counter normal_fishing 0
            set_event_counter bad_fishing 0
            set_event_counter very_bad_fishing 1
        end_if

        ;;;;;;;;;;;;;;;԰易黻;;;;;;;;;;;;;;;;;;;;;;

        if I_CompareCounter month = 8
            generate_random_counter harvest 1 5
        end_if


        if I_EventCounter harvest = 5
            and I_CompareCounter month = 8
            set_event_counter very_good_harvest 1
            set_event_counter good_harvest 0
            set_event_counter normal_harvest 0
            set_event_counter bad_harvest 0
            set_event_counter very_bad_harvest 0
            historic_event HARVEST_VERY_GOOD factions { southern_european, eastern_european, }
        end_if

        if I_EventCounter harvest = 4
            and I_CompareCounter month = 8
            set_event_counter very_good_harvest 0
            set_event_counter good_harvest 1
            set_event_counter normal_harvest 0
            set_event_counter bad_harvest 0
            set_event_counter very_bad_harvest 0
            historic_event HARVEST_GOOD factions { southern_european, eastern_european, }
        end_if

        if I_EventCounter harvest = 3
            and I_CompareCounter month = 8
            set_event_counter very_good_harvest 0
            set_event_counter good_harvest 0
            set_event_counter normal_harvest 1
            set_event_counter bad_harvest 0
            set_event_counter very_bad_harvest 0
            historic_event HARVEST_NORMAL factions { southern_european, eastern_european, }
        end_if

        if I_EventCounter harvest = 2
            and I_CompareCounter month = 8
            set_event_counter very_good_harvest 0
            set_event_counter good_harvest 0
            set_event_counter normal_harvest 0
            set_event_counter bad_harvest 1
            set_event_counter very_bad_harvest 0
            historic_event HARVEST_BAD factions { southern_european, eastern_european, }
        end_if

        if I_EventCounter harvest = 1
            and I_CompareCounter month = 8
            set_event_counter very_good_harvest 0
            set_event_counter good_harvest 0
            set_event_counter normal_harvest 0
            set_event_counter bad_harvest 0
            set_event_counter very_bad_harvest 1
            historic_event HARVEST_VERY_BAD factions { southern_european, eastern_european, }
        end_if


        if I_CompareCounter month = 11
            set_event_counter harvest 0
        end_if

    end_monitor

     

    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Battle models. Yomen;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

    monitor_event BecomesFactionLeader FactionType saxons
        and I_NumberOfSettlements saxons >= 1

        change_battle_model saxons leader Elector_count_stir

    end_monitor

    monitor_event BecomesFactionLeader FactionType france
        and I_NumberOfSettlements france >= 1

        change_battle_model france leader Elector_count_oste

    end_monitor

    monitor_event BecomesFactionHeir FactionType france
        and I_NumberOfSettlements france >= 1

        change_battle_model france heir Kessell

    end_monitor

    monitor_event BecomesFactionLeader FactionType spain
        and I_NumberOfSettlements spain >= 1

        change_battle_model spain leader Helmut

    end_monitor

    monitor_event BecomesFactionLeader FactionType scotland
        and I_NumberOfSettlements scotland >= 1

        change_battle_model scotland leader Todbringer

    end_monitor

    monitor_event BecomesFactionLeader FactionType venice
        and I_NumberOfSettlements venice >= 1

        change_battle_model venice leader Marius

    end_monitor

    monitor_event BecomesFactionLeader FactionType milan
        and I_NumberOfSettlements milan >= 1

        change_battle_model milan leader Aldebrand

    end_monitor

    monitor_event BecomesFactionLeader FactionType sicily
        and I_NumberOfSettlements sicily >= 1

        change_battle_model sicily leader Teoderik

    end_monitor

    monitor_event BecomesFactionLeader FactionType byzantium
        and I_NumberOfSettlements byzantium >= 1

        change_battle_model byzantium leader Raukov

    end_monitor

    monitor_event BecomesFactionLeader FactionType portugal
        and I_NumberOfSettlements portugal >= 1

        change_battle_model portugal leader Wiss_count

    end_monitor

    monitor_event BecomesFactionLeader FactionType saxons
        and I_NumberOfSettlements saxons >= 1

        change_battle_model saxons leader Elector_count_stir

    end_monitor

    monitor_event BecomesFactionLeader FactionType russia
        and I_NumberOfSettlements russia >= 1

        change_battle_model russia leader kislev_tzar

    end_monitor

    monitor_event BecomesFactionLeader FactionType norway
        and I_NumberOfSettlements norway >= 1

        change_battle_model norway leader Lord_of_Khorne

    end_monitor

    monitor_event BecomesFactionHeir FactionType norway
        and I_NumberOfSettlements norway >= 1

        change_battle_model norway heir Khorne_geroldd

    end_monitor

    monitor_event BecomesFactionLeader FactionType teutonic_order
        and I_NumberOfSettlements teutonic_order >= 1

        change_battle_model teutonic_order leader Lord_of_Slaanesh

    end_monitor

    monitor_event BecomesFactionLeader FactionType lithuania
        and I_NumberOfSettlements lithuania >= 1

        change_battle_model lithuania leader Lord_of_Tzeentch

    end_monitor

    monitor_event BecomesFactionHeir FactionType lithuania
        and I_NumberOfSettlements lithuania >= 1

        change_battle_model lithuania heir Tzeent_geroldd

    end_monitor

    monitor_event BecomesFactionLeader FactionType novgorod
        and I_NumberOfSettlements novgorod >= 1

        change_battle_model novgorod leader Lord_of_Nurgl

    end_monitor

    monitor_event BecomesFactionLeader FactionType mongols
        and I_NumberOfSettlements mongols >= 1

        change_battle_model mongols leader DE_general

    end_monitor

    monitor_event BecomesFactionHeir FactionType mongols
        and I_NumberOfSettlements mongols >= 1

        change_battle_model mongols heir DE_general

    end_monitor

    monitor_event BecomesFactionLeader FactionType kalmar_union
        and I_NumberOfSettlements kalmar_union >= 1

        change_battle_model kalmar_union leader rus_grand_duke_kiy

    end_monitor

    monitor_event BecomesFactionHeir FactionType kalmar_union
        and I_NumberOfSettlements kalmar_union >= 1

        change_battle_model kalmar_union heir rus_heir

    end_monitor

    monitor_event BecomesFactionLeader FactionType aztecs
        and I_NumberOfSettlements aztecs >= 1

        change_battle_model aztecs leader Rykarth

    end_monitor

    monitor_event BecomesFactionLeader FactionType turks
        and I_NumberOfSettlements turks >= 1

        change_battle_model turks leader Grimgor

    end_monitor

    monitor_event BecomesFactionHeir FactionType turks
        and I_NumberOfSettlements turks >= 1

        change_battle_model turks heir Black_orcs1

    end_monitor

    monitor_event BecomesFactionLeader FactionType poland
        and I_NumberOfSettlements poland >= 1

        change_battle_model poland leader DWKing

    end_monitor

    monitor_event BecomesFactionLeader FactionType hungary
        and I_NumberOfSettlements hungary >= 1

        change_battle_model hungary leader Mannfred

    end_monitor

    monitor_event BecomesFactionHeir FactionType hungary
        and I_NumberOfSettlements hungary >= 1

        change_battle_model hungary heir Vampire_heir

    end_monitor

    monitor_event BecomesFactionHeir FactionType normans
        and I_NumberOfSettlements normans >= 1

        change_battle_model normans leader orion

    end_monitor

    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Money script;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

    monitor_event FactionTurnStart FactionIsLocal
        and I_TurnNumber > 0
        and CampaignDifficulty = medium

        if I_IsFactionAIControlled hre
            increment_kings_purse hre 5000
        end_if

        if I_IsFactionAIControlled russia
            increment_kings_purse russia 2000
        end_if

        if I_IsFactionAIControlled turks
            increment_kings_purse turks 15000
        end_if

        if I_IsFactionAIControlled spain
            increment_kings_purse spain 3000
        end_if

        if I_IsFactionAIControlled scotland
            increment_kings_purse scotland 3000
        end_if

        if I_IsFactionAIControlled portugal
            increment_kings_purse portugal 3000
        end_if

        if I_IsFactionAIControlled venice
            increment_kings_purse venice 3000
        end_if

        if I_IsFactionAIControlled milan
            increment_kings_purse milan 3000
        end_if

        if I_IsFactionAIControlled byzantium
            increment_kings_purse byzantium 3000
        end_if

        if I_IsFactionAIControlled france
            increment_kings_purse france 3000
        end_if

        if I_IsFactionAIControlled norway
            increment_kings_purse norway 10000
        end_if

        if I_IsFactionAIControlled teutonic_order
            increment_kings_purse teutonic_order 10000
        end_if

        if I_IsFactionAIControlled lithuania
            increment_kings_purse lithuania 10000
        end_if

        if I_IsFactionAIControlled novgorod
            increment_kings_purse novgorod 10000
        end_if

        if I_IsFactionAIControlled england
            increment_kings_purse england 6000
        end_if

        if I_IsFactionAIControlled poland
            increment_kings_purse poland 10000
        end_if

        if I_IsFactionAIControlled ogres
            increment_kings_purse ogres 10000
        end_if

        if I_IsFactionAIControlled 	sicily
            increment_kings_purse sicily 2000
        end_if

        if I_IsFactionAIControlled 	saxons
            increment_kings_purse saxons 3000
        end_if

        if I_IsFactionAIControlled 	mongols
            increment_kings_purse 	mongols 6000
        end_if

        if I_IsFactionAIControlled 	kalmar_union
            increment_kings_purse 	kalmar_union 6000
        end_if

        if I_IsFactionAIControlled 	moors
            increment_kings_purse 	moors 10000
        end_if

        if I_IsFactionAIControlled 	egypt
            increment_kings_purse 	egypt 10000
        end_if

        if I_IsFactionAIControlled 	hungary
            increment_kings_purse 	hungary 10000
        end_if

        if I_IsFactionAIControlled 	aztecs
            increment_kings_purse 	aztecs 10000
        end_if

        if I_IsFactionAIControlled 	normans
            increment_kings_purse 	normans 5000
        end_if

        if I_IsFactionAIControlled 	denmark
            increment_kings_purse 	denmark 25000
        end_if

        if I_IsFactionAIControlled 	timurids
            increment_kings_purse 	timurids 8000
        end_if

        if I_IsFactionAIControlled 	papal_states
            increment_kings_purse 	papal_states 6000
        end_if

        if I_IsFactionAIControlled 	skaven
            increment_kings_purse 	skaven 15000
        end_if
        terminate_monitor
    end_monitor


    monitor_event FactionTurnStart FactionIsLocal
        and I_TurnNumber > 0
        and CampaignDifficulty = hard

        if I_IsFactionAIControlled hre
            increment_kings_purse hre 6000
        end_if

        if I_IsFactionAIControlled russia
            increment_kings_purse russia 3000
        end_if

        if I_IsFactionAIControlled turks
            increment_kings_purse turks 20000
        end_if

        if I_IsFactionAIControlled spain
            increment_kings_purse spain 6000
        end_if

        if I_IsFactionAIControlled scotland
            increment_kings_purse scotland 5000
        end_if

        if I_IsFactionAIControlled portugal
            increment_kings_purse portugal 5000
        end_if

        if I_IsFactionAIControlled venice
            increment_kings_purse venice 5000
        end_if

        if I_IsFactionAIControlled milan
            increment_kings_purse milan 5000
        end_if

        if I_IsFactionAIControlled byzantium
            increment_kings_purse byzantium 5000
        end_if

        if I_IsFactionAIControlled france
            increment_kings_purse france 5000
        end_if

        if I_IsFactionAIControlled norway
            increment_kings_purse norway 15000
        end_if

        if I_IsFactionAIControlled teutonic_order
            increment_kings_purse teutonic_order 15000
        end_if

        if I_IsFactionAIControlled lithuania
            increment_kings_purse lithuania 15000
        end_if

        if I_IsFactionAIControlled novgorod
            increment_kings_purse novgorod 15000
        end_if

        if I_IsFactionAIControlled england
            increment_kings_purse england 10000
        end_if

        if I_IsFactionAIControlled poland
            increment_kings_purse poland 15000
        end_if

        if I_IsFactionAIControlled ogres
            increment_kings_purse ogres 15000
        end_if

        if I_IsFactionAIControlled 	sicily
            increment_kings_purse sicily 4000
        end_if

        if I_IsFactionAIControlled 	saxons
            increment_kings_purse saxons 5000
        end_if

        if I_IsFactionAIControlled 	mongols
            increment_kings_purse 	mongols 10000
        end_if

        if I_IsFactionAIControlled 	kalmar_union
            increment_kings_purse 	kalmar_union 8000
        end_if

        if I_IsFactionAIControlled 	moors
            increment_kings_purse 	moors 10000
        end_if

        if I_IsFactionAIControlled 	egypt
            increment_kings_purse 	egypt 10000
        end_if

        if I_IsFactionAIControlled 	hungary
            increment_kings_purse 	hungary 20000
        end_if

        if I_IsFactionAIControlled 	aztecs
            increment_kings_purse 	aztecs 20000
        end_if

        if I_IsFactionAIControlled 	normans
            increment_kings_purse 	normans 10000
        end_if

        if I_IsFactionAIControlled 	denmark
            increment_kings_purse 	denmark 30000
        end_if

        if I_IsFactionAIControlled 	timurids
            increment_kings_purse 	timurids 10000
        end_if

        if I_IsFactionAIControlled 	papal_states
            increment_kings_purse 	papal_states 8000
        end_if

        if I_IsFactionAIControlled 	skaven
            increment_kings_purse 	skaven 30000
        end_if
        terminate_monitor
    end_monitor


    monitor_event FactionTurnStart FactionIsLocal
        and I_TurnNumber > 0
        and CampaignDifficulty = very_hard

        if I_IsFactionAIControlled hre
            increment_kings_purse hre 6000
        end_if

        if I_IsFactionAIControlled russia
            increment_kings_purse russia 3000
        end_if

        if I_IsFactionAIControlled turks
            increment_kings_purse turks 35000
        end_if

        if I_IsFactionAIControlled spain
            increment_kings_purse spain 6000
        end_if

        if I_IsFactionAIControlled scotland
            increment_kings_purse scotland 6000
        end_if

        if I_IsFactionAIControlled portugal
            increment_kings_purse portugal 6000
        end_if

        if I_IsFactionAIControlled venice
            increment_kings_purse venice 6000
        end_if

        if I_IsFactionAIControlled milan
            increment_kings_purse milan 6000
        end_if

        if I_IsFactionAIControlled byzantium
            increment_kings_purse byzantium 6000
        end_if

        if I_IsFactionAIControlled france
            increment_kings_purse france 6000
        end_if

        if I_IsFactionAIControlled norway
            increment_kings_purse norway 30000
        end_if

        if I_IsFactionAIControlled teutonic_order
            increment_kings_purse teutonic_order 30000
        end_if

        if I_IsFactionAIControlled lithuania
            increment_kings_purse lithuania 30000
        end_if

        if I_IsFactionAIControlled novgorod
            increment_kings_purse novgorod 30000
        end_if

        if I_IsFactionAIControlled england
            increment_kings_purse england 8000
        end_if

        if I_IsFactionAIControlled poland
            increment_kings_purse poland 25000
        end_if

        if I_IsFactionAIControlled ogres
            increment_kings_purse ogres 25000
        end_if

        if I_IsFactionAIControlled 	sicily
            increment_kings_purse sicily 2000
        end_if

        if I_IsFactionAIControlled 	saxons
            increment_kings_purse saxons 9000
        end_if

        if I_IsFactionAIControlled 	mongols
            increment_kings_purse 	mongols 8000
        end_if

        if I_IsFactionAIControlled 	kalmar_union
            increment_kings_purse 	kalmar_union 8000
        end_if

        if I_IsFactionAIControlled 	moors
            increment_kings_purse 	moors 25000
        end_if

        if I_IsFactionAIControlled 	egypt
            increment_kings_purse 	egypt 10000
        end_if

        if I_IsFactionAIControlled 	hungary
            increment_kings_purse 	hungary 25000
        end_if

        if I_IsFactionAIControlled 	aztecs
            increment_kings_purse 	aztecs 30000
        end_if

        if I_IsFactionAIControlled 	normans
            increment_kings_purse 	normans 5000
        end_if

        if I_IsFactionAIControlled 	denmark
            increment_kings_purse 	denmark 40000
        end_if

        if I_IsFactionAIControlled 	timurids
            increment_kings_purse 	timurids 10000
        end_if

        if I_IsFactionAIControlled 	papal_states
            increment_kings_purse 	papal_states 10000
        end_if

        if I_IsFactionAIControlled 	skaven
            increment_kings_purse 	skaven 35000
        end_if
        terminate_monitor
    end_monitor


    monitor_event FactionTurnStart FactionType hre
        and IsFactionAIControlled
        and Treasury < -500
        add_money hre 10000
    end_monitor

    monitor_event FactionTurnStart FactionType russia
        and IsFactionAIControlled
        and Treasury < -500
        add_money russia 5000
    end_monitor

    monitor_event FactionTurnStart FactionType turks
        and IsFactionAIControlled
        and Treasury < -500
        add_money turks 30000
    end_monitor

    monitor_event FactionTurnStart FactionType turks
        and IsFactionAIControlled
        and CampaignDifficulty = medium
        and Treasury < 5000
        add_money turks 10000
    end_monitor

    monitor_event FactionTurnStart FactionType turks
        and IsFactionAIControlled
        and CampaignDifficulty = hard
        and Treasury < 8000
        add_money turks 15000
    end_monitor

    monitor_event FactionTurnStart FactionType turks
        and IsFactionAIControlled
        and CampaignDifficulty = very_hard
        and Treasury < 8000
        add_money turks 20000
    end_monitor

    monitor_event FactionTurnStart FactionType spain
        and IsFactionAIControlled
        and Treasury < -500
        add_money spain 10000
    end_monitor

    monitor_event FactionTurnStart FactionType papal_states
        and IsFactionAIControlled
        and Treasury < -500
        add_money papal_states 10000
    end_monitor

    monitor_event FactionTurnStart FactionType papal_states
        and IsFactionAIControlled
        and Treasury < 5000
        add_money papal_states 5000
    end_monitor

    monitor_event FactionTurnStart FactionType scotland
        and IsFactionAIControlled
        and Treasury < -500
        add_money scotland 10000
    end_monitor

    monitor_event FactionTurnStart FactionType portugal
        and IsFactionAIControlled
        and Treasury < -500
        add_money portugal 10000
    end_monitor

    monitor_event FactionTurnStart FactionType venice
        and IsFactionAIControlled
        and Treasury < -500
        add_money venice 10000
    end_monitor

    monitor_event FactionTurnStart FactionType milan
        and IsFactionAIControlled
        and Treasury < -500
        add_money milan 10000
    end_monitor

    monitor_event FactionTurnStart FactionType byzantium
        and IsFactionAIControlled
        and Treasury < -500
        add_money byzantium 10000
    end_monitor

    monitor_event FactionTurnStart FactionType france
        and IsFactionAIControlled
        and Treasury < -500
        add_money france 10000
    end_monitor

    monitor_event FactionTurnStart FactionType norway
        and IsFactionAIControlled
        and Treasury < -500
        add_money norway 30000
    end_monitor

    monitor_event FactionTurnStart FactionType teutonic_order
        and IsFactionAIControlled
        and Treasury < -500
        add_money teutonic_order 30000
    end_monitor

    monitor_event FactionTurnStart FactionType lithuania
        and IsFactionAIControlled
        and Treasury < -500
        add_money lithuania 30000
    end_monitor

    monitor_event FactionTurnStart FactionType novgorod
        and IsFactionAIControlled
        and Treasury < -500
        add_money novgorod 30000
    end_monitor

    monitor_event FactionTurnStart FactionType england
        and IsFactionAIControlled
        and Treasury < -500
        add_money england 40000
    end_monitor

    monitor_event FactionTurnStart FactionType poland
        and IsFactionAIControlled
        and Treasury < -500
        add_money poland 40000
    end_monitor

    monitor_event FactionTurnStart FactionType ogres
        and IsFactionAIControlled
        and Treasury < -500
        add_money ogres 40000
    end_monitor

    monitor_event FactionTurnStart FactionType ogres
        and IsFactionAIControlled
        and Treasury < 1000
        add_money ogres 20000
    end_monitor

    monitor_event FactionTurnStart FactionType sicily
        and IsFactionAIControlled
        and Treasury < -500
        add_money sicily 15000
    end_monitor

    monitor_event FactionTurnStart FactionType saxons
        and IsFactionAIControlled
        and Treasury < -500
        add_money saxons 15000
    end_monitor

    monitor_event FactionTurnStart FactionType denmark
        and IsFactionAIControlled
        and Treasury < -500
        add_money denmark 40000
    end_monitor

    monitor_event FactionTurnStart FactionType denmark
        and CampaignDifficulty = medium
        and IsFactionAIControlled
        and Treasury < 10000
        add_money denmark 10000
    end_monitor

    monitor_event FactionTurnStart FactionType denmark
        and CampaignDifficulty = hard
        and IsFactionAIControlled
        and Treasury < 10000
        add_money denmark 15000
    end_monitor

    monitor_event FactionTurnStart FactionType denmark
        and CampaignDifficulty = very_hard
        and IsFactionAIControlled
        and Treasury < 10000
        add_money denmark 20000
    end_monitor

    monitor_event FactionTurnStart FactionType mongols
        and IsFactionAIControlled
        and Treasury < -500
        add_money mongols 20000
    end_monitor

    monitor_event FactionTurnStart FactionType egypt
        and IsFactionAIControlled
        and Treasury < -500
        add_money egypt 30000
    end_monitor

    monitor_event FactionTurnStart FactionType moors
        and IsFactionAIControlled
        and Treasury < -500
        add_money moors 30000
    end_monitor

    monitor_event FactionTurnStart FactionType kalmar_union
        and IsFactionAIControlled
        and Treasury < -500
        add_money kalmar_union 10000
    end_monitor

    monitor_event FactionTurnStart FactionType hungary
        and IsFactionAIControlled
        and Treasury < -500
        add_money hungary 30000
    end_monitor

    monitor_event FactionTurnStart FactionType hungary
        and IsFactionAIControlled
        and Treasury < 5000
        add_money hungary 5000
    end_monitor

    monitor_event FactionTurnStart FactionType aztecs
        and IsFactionAIControlled
        and Treasury < -500
        add_money aztecs 10000
    end_monitor

    monitor_event FactionTurnStart FactionType normans
        and IsFactionAIControlled
        and Treasury < -500
        add_money normans 10000
    end_monitor

    monitor_event FactionTurnStart FactionType timurids
        and IsFactionAIControlled
        and Treasury < -500
        add_money timurids 40000
    end_monitor

    monitor_event FactionTurnStart FactionType skaven
        and IsFactionAIControlled
        and Treasury < -500
        add_money skaven 40000
    end_monitor

    monitor_event FactionTurnStart FactionType skaven
        and CampaignDifficulty = medium
        and IsFactionAIControlled
        and Treasury < 5000
        add_money skaven 10000
    end_monitor

    monitor_event FactionTurnStart FactionType skaven
        and CampaignDifficulty = hard
        and IsFactionAIControlled
        and Treasury < 10000
        add_money skaven 15000
    end_monitor

    monitor_event FactionTurnStart FactionType skaven
        and CampaignDifficulty = very_hard
        and IsFactionAIControlled
        and Treasury < 10000
        add_money skaven 20000
    end_monitor


    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;INTRODUCTION;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

    monitor_event FactionTurnStart FactionIsLocal
        if I_LocalFaction byzantium
            historic_event introduction_ostland
        end_if
        if I_LocalFaction poland
            historic_event introduction_dwarfs
        end_if
        if I_LocalFaction denmark
            historic_event introduction_chaos
        end_if
        if I_LocalFaction england
            historic_event introduction_elves
        end_if
        if I_LocalFaction france
            historic_event introduction_ostermark
        end_if
        if I_LocalFaction hre
            historic_event introduction_reikland
        end_if
        if I_LocalFaction hungary
            historic_event introduction_silvania
        end_if
        if I_LocalFaction milan
            historic_event introduction_hochland
        end_if
        if I_LocalFaction saxons
            historic_event introduction_stirland
        end_if
        if I_LocalFaction norway
            historic_event introduction_khorn
        end_if
        if I_LocalFaction portugal
            historic_event introduction_viciland
        end_if
        if I_LocalFaction russia
            historic_event introduction_kislev
        end_if
        if I_LocalFaction lithuania
            historic_event introduction_tzinch
        end_if
        if I_LocalFaction sicily
            historic_event introduction_nordland
        end_if
        if I_LocalFaction spain
            historic_event introduction_talabakland
        end_if
        if I_LocalFaction turks
            historic_event introduction_orks
        end_if
        if I_LocalFaction venice
            historic_event introduction_averland
        end_if
        if I_LocalFaction kalmar_union
            historic_event introduction_kalmar_union
        end_if
        if I_LocalFaction novgorod
            historic_event introduction_nurgl
        end_if
        if I_LocalFaction teutonic_order
            historic_event introduction_slaanesh
        end_if
        if I_LocalFaction scotland
            historic_event introduction_middenland
        end_if
        if I_LocalFaction aztecs
            historic_event INTRODUCTION_CHAOS_DWARF
        end_if
        if I_LocalFaction moors
            historic_event INTRODUCTION_GOBLINS
        end_if
        if I_LocalFaction timurids
            historic_event INTRODUCTION_KHEMRI
        end_if
        if I_LocalFaction normans
            historic_event INTRODUCTION_NORSKA
        end_if
        if I_LocalFaction skaven
            historic_event INTRODUCTION_SKAVEN
        end_if
        if I_LocalFaction mongols
            historic_event INTRODUCTION_DARKELVES
        end_if
        terminate_monitor
    end_monitor
	
	
	;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Seasons. Hick;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

    ;	1. 12 Turns per year.
    declare_counter month
    declare_counter winter_severity
    set_counter winter_severity 1 ;normal winter, 2 = severe winter, 3 = mild winter
    set_counter month 1 ;set to January

    monitor_event PreFactionTurnStart FactionIsLocal ; set the season for each month
        if I_CompareCounter month == 1 ;January
            and I_CompareCounter winter_severity == 1 ; normal winter
            console_command season winter
            set_event_counter winter 1
        end_if

        if I_CompareCounter month == 1 ;January
            and I_CompareCounter winter_severity == 2; severe winter
            console_command season winter
            set_event_counter winter 1
        end_if

        if I_CompareCounter month == 1 ;January
            and I_CompareCounter winter_severity == 3; mild winter
            console_command season winter
            set_event_counter winter 1
            set_event_counter summer_winter 1; next turn will be summer

        end_if

        if I_CompareCounter month == 2 ;February
            and I_CompareCounter winter_severity == 1; normal winter
            console_command season winter
            set_event_counter winter 1
            set_event_counter summer_winter 1; next turn will be summer
        end_if

        if I_CompareCounter month == 2 ;February
            and I_CompareCounter winter_severity == 2; severe winter
            console_command season winter
            set_event_counter winter 1
        end_if

        if I_CompareCounter month == 2 ;February
            and I_CompareCounter winter_severity == 3; mild winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 3 ;March
            and I_CompareCounter winter_severity == 1; normal winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 3 ;March
            and I_CompareCounter winter_severity == 2;severe winter
            console_command season winter
            set_event_counter winter 1
            set_event_counter summer_winter 1; next turn will be summer
        end_if

        if I_CompareCounter month == 3 ;March
            and I_CompareCounter winter_severity == 3; mild winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 4 ;April
            and I_CompareCounter winter_severity == 1; normal winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 4 ;April
            and I_CompareCounter winter_severity == 2; severe winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 4 ;April
            and I_CompareCounter winter_severity == 3; mild winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 5 ;May
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 6 ;June
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 7 ;July
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 8 ;August
            console_command season summer
            set_event_counter winter 0
        end_if
        if I_CompareCounter month == 8 ;August
            and I_CompareCounter winter_severity == 2 ; severe winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 9 ;September
            and I_CompareCounter winter_severity == 1; normal winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 9 ;September
            and I_CompareCounter winter_severity == 2; severe winter
            console_command season summer
            set_event_counter winter 0

        end_if

        if I_CompareCounter month == 9 ;September
            and I_CompareCounter winter_severity == 3; mild winter
            console_command season summer
            set_event_counter winter 0
        end_if

        if I_CompareCounter month == 10 ;October
            and I_CompareCounter winter_severity == 1; normal winter
            console_command season winter
            set_event_counter winter 1
        end_if

        if I_CompareCounter month == 10 ;October
            and I_CompareCounter winter_severity == 2; severe winter
            set_event_counter summer_winter 2;next turn will be winter
            console_command season winter
            set_event_counter winter 1
        end_if

        if I_CompareCounter month == 10 ;October
            and I_CompareCounter winter_severity == 3; mild winter
            console_command season winter
            set_event_counter winter 1

        end_if

        if I_CompareCounter month == 11 ;November
            and I_CompareCounter winter_severity == 1; normal winter
            console_command season winter
            set_event_counter winter 1
            set_event_counter summer_winter 2;next turn will be winter
        end_if

        if I_CompareCounter month == 11; November
            and I_CompareCounter winter_severity == 2; severe winter
            console_command season winter
            set_event_counter winter 1
            historic_event severe_winter
        end_if

        if I_CompareCounter month == 11 ;November
            and I_CompareCounter winter_severity == 3; mild winter
            console_command season summer
            set_event_counter winter 1

        end_if

        if I_CompareCounter month == 12 ;December
            and I_CompareCounter winter_severity == 1; normal winter
            console_command season winter
            set_event_counter winter 1
        end_if

        if I_CompareCounter month == 12; November
            and I_CompareCounter winter_severity == 2; severe winter
            console_command season winter
        end_if

        if I_CompareCounter month == 12 ;December
            and I_CompareCounter winter_severity == 3; mild winter
            console_command season summer
            set_event_counter winter 0
            historic_event mild_winter
            set_event_counter summer_winter 2;next turn will be winter
        end_if

        inc_counter month 1 ;advance the month
        if I_CompareCounter month == 13 ;start a new year
            set_counter month 1
        end_if
    end_monitor


    monitor_event FactionTurnEnd FactionType slave ; randomized winter
        and I_CompareCounter month == 6
        generate_random_counter random_winter 1 10
        if I_EventCounter random_winter >= 1
            and I_EventCounter random_winter <= 8
            set_counter winter_severity 1 ;80 percent chance of severe winter
        end_if

        if I_EventCounter random_winter == 9
            set_counter winter_severity 2 ;10 percent chance of severe winter
        end_if

        if I_EventCounter random_winter == 10
            set_counter winter_severity 3 ;10 percent chance of mild winter
        end_if
    end_monitor

    monitor_event FactionTurnEnd FactionType slave
        and I_CompareCounter month > 1
        console_command season summer
    end_monitor
	
	
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;Garrison script;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


;;;;;;;;;;;;;;;;;;;;;Current Faction Merc Recruitment Script;;;;;;;;;;;;;;;;;;;;;;;;;;

monitor_event PreFactionTurnStart FactionType skaven
        set_event_counter  skaven_turn 1
        end_monitor
monitor_event FactionTurnEnd FactionType skaven
        set_event_counter  skaven_turn 0
        end_monitor

monitor_event PreFactionTurnStart FactionType turks
        set_event_counter  turks_turn 1
        end_monitor
monitor_event FactionTurnEnd FactionType turks
        set_event_counter  turks_turn 0
        end_monitor

monitor_event PreFactionTurnStart FactionType denmark
        set_event_counter  denmark_turn 1
        end_monitor
monitor_event FactionTurnEnd FactionType denmark
        set_event_counter  denmark_turn 0
        end_monitor

monitor_event PreFactionTurnStart FactionType norway
        set_event_counter  norway_turn 1
        end_monitor
monitor_event FactionTurnEnd FactionType norway
        set_event_counter  norway_turn 0
        end_monitor

monitor_event PreFactionTurnStart FactionType lithuania
        set_event_counter  lithuania_turn 1
        end_monitor
monitor_event FactionTurnEnd FactionType lithuania
        set_event_counter  lithuania_turn 0
        end_monitor

monitor_event PreFactionTurnStart FactionType novgorod
        set_event_counter  novgorod_turn 1
        end_monitor
monitor_event FactionTurnEnd FactionType novgorod
        set_event_counter  novgorod_turn 0
        end_monitor

monitor_event PreFactionTurnStart FactionType teutonic_order
        set_event_counter  teutonic_order_turn 1
        end_monitor
monitor_event FactionTurnEnd FactionType teutonic_order
        set_event_counter  teutonic_order_turn 0
        end_monitor
		
monitor_event PreFactionTurnStart FactionType russia
        set_event_counter  kislev_turn 1
        end_monitor
monitor_event FactionTurnEnd FactionType russia
        set_event_counter  kislev_turn 0
        end_monitor
	
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;========================================================
;===================== G5 BAI STUFF =====================
;========================================================

;### Germanicu5 ReallyBadAI Battle System Scrips v5.x
;### This file contains manually programmed AI behaviour eliminating previously unfixable, hardcoded bugs and greatly influences battle performance
;### Support available at http://www.twcenter.net/forums/forumdisplay.php?f=1745 , http://www.twcenter.net/forums/showthread.php?t=257970 and http://www.twcenter.net/forums/showthread.php?t=253132
;### Non-private use of code only by permission,
;### coded by Germanicu5

;;;;;;;Print Info
log always Germanicu5 ReallyBadAI v5.7 Running. Please upload log and savegames when reporting battle CTDs for SS.
monitor_event GameReloaded
log always Germanicu5 ReallyBadAI v5.7 Running. Please upload log and savegames when reporting battle CTDs for SS.
end_monitor

;;;;;;;
declare_counter g5_battle_difficulty_high
;;;;;;;
declare_counter fire_labels
declare_counter panel_check
declare_counter player_unit_count
declare_counter enemy_unit_count
declare_counter open_battle
declare_counter labels_only
declare_counter stakes_lock
;;;;;;;
declare_counter pu1_missile
declare_counter pu2_missile
declare_counter pu3_missile
declare_counter pu4_missile
declare_counter pu5_missile
declare_counter pu6_missile
declare_counter pu7_missile
declare_counter pu8_missile
declare_counter pu9_missile
declare_counter pu10_missile
declare_counter pu11_missile
declare_counter pu12_missile
declare_counter pu13_missile
declare_counter pu14_missile
declare_counter pu15_missile
declare_counter pu16_missile
declare_counter pu17_missile
declare_counter pu18_missile
declare_counter pu19_missile
declare_counter pu20_missile
;;;;;;;Checks
declare_counter check_timer
declare_counter elephant_fix_check
declare_counter elephant_fix_check_sally
declare_counter script_delay
declare_counter reinf_check
declare_counter sally_defense_check
declare_counter sally_check
;;;;;;;Stakes
declare_counter label_ready
declare_counter stakes_on
;;;;;;;Reinforcements
declare_counter army4_ready
declare_counter reinf_late

declare_counter distance_trigger1
declare_counter distance_trigger2
declare_counter distance_trigger3
declare_counter distance_trigger4
declare_counter distance_trigger5

declare_counter kill_labelling_reinf_allied
declare_counter army3_reinf_allied
declare_counter army4_reinf_allied
declare_counter army5_reinf_allied
declare_counter army6_reinf_allied
declare_counter army7_reinf_allied
declare_counter army8_reinf_allied
declare_counter army9_reinf_allied
declare_counter army10_reinf_allied
declare_counter army11_reinf_allied
declare_counter army12_reinf_allied
declare_counter army13_reinf_allied
declare_counter army14_reinf_allied
declare_counter army15_reinf_allied
declare_counter army16_reinf_allied
declare_counter launch_alliance_0
declare_counter launch_alliance_1

declare_counter apply_strategy
declare_counter relaunch_movement

declare_counter att_alliance_ready
declare_counter def_alliance_ready
declare_counter def_alliance_ready_siege

declare_counter army3_moving
declare_counter army3_run
declare_counter army3_reinf_late
declare_counter army4_moving
declare_counter army4_run
declare_counter army4_reinf_late
declare_counter army5_moving
declare_counter army5_run
declare_counter army5_reinf_late
declare_counter army6_moving
declare_counter army6_run
declare_counter army6_reinf_late
declare_counter army7_moving
declare_counter army7_run
declare_counter army7_reinf_late
declare_counter army8_moving
declare_counter army8_run
declare_counter army8_reinf_late
declare_counter army9_moving
declare_counter army9_run
declare_counter army9_reinf_late
declare_counter army10_moving
declare_counter army10_run
declare_counter army10_reinf_late
declare_counter army11_moving
declare_counter army11_run
declare_counter army11_reinf_late
declare_counter army12_moving
declare_counter army12_run
declare_counter army12_reinf_late
declare_counter army13_moving
declare_counter army13_run
declare_counter army13_reinf_late
declare_counter army14_moving
declare_counter army14_run
declare_counter army14_reinf_late
declare_counter army15_moving
declare_counter army15_run
declare_counter army15_reinf_late
declare_counter army16_moving
declare_counter army16_run
declare_counter army16_reinf_late

declare_counter army4_ready_siege ; acts as launching counter
declare_counter army4_moving_siege
declare_counter army4_run_siege
declare_counter reinf_check_interval

;;;;;;;HA Fix
declare_counter ha_fix
;;;;;;;Elephant Fix
declare_counter elephant_fix
declare_counter elephant_gate
declare_counter elephant_gate_s
declare_counter elephant_gate_tier2
declare_counter elephant_gate_tier3
declare_counter elephant_gate_tier2s
declare_counter elephant_gate_tier3s
declare_counter rally_walls
declare_counter rally_walls_s
declare_counter second_ring
declare_counter third_ring
declare_counter second_ring_s
declare_counter third_ring_s
declare_counter del_objective
declare_counter del_objective_s
;;;;;;;Sally-out
declare_counter sally-out_fix
declare_counter sally_defense
declare_counter reform_back
declare_counter reform_multi
declare_counter unit_under_fire
declare_counter kill_sally
declare_counter sally_reinf
declare_counter reset_position
declare_counter defend_location
declare_counter reset_army2
declare_counter assign_labels
;;;;;;;Siege
declare_counter siege_fix
declare_counter army_sieging
declare_counter army_south
declare_counter army_north
declare_counter army_east
declare_counter army_west
declare_counter emergency_stop
declare_counter omfg_cannon_tower
declare_counter army2_sally
declare_counter wall_advance_s
;;;;;;;Protect General
declare_counter protect_general
declare_counter general_wait
declare_counter protect_siege
declare_counter g_stop
;;;;;;;Sally-out, AI defending
declare_counter army4_ready_sally
declare_counter army4_location
declare_counter path_n
declare_counter path_ne
declare_counter path_e
declare_counter path_se
declare_counter path_s
declare_counter path_sw
declare_counter path_w
declare_counter path_nw
declare_counter obstacle_check
declare_counter label_army4
declare_counter army4_moving_s
declare_counter army4_idle_s
declare_counter line_passed
declare_counter army2_idle_s
declare_counter army4_idle_r
declare_counter wall_line_passed
declare_counter reset_position_s
declare_counter repeat_test1
declare_counter repeat_test2
declare_counter repeat_test3
declare_counter repeat_test4
declare_counter repeat_test5
declare_counter repeat_test6
;;;;;;;Open Battles
declare_counter ob_defense_launch
declare_counter ob_defend
declare_counter ob_siege_attack
declare_counter ob_under_fire
declare_counter ob_repeat_test
declare_counter ob_engaged
declare_counter player_units_closing
declare_counter player_enveloping
declare_counter player_engaged_reinf
;;;;;;;AI Stuck Fix
declare_counter ai_stuck_launch
declare_counter a2u1_stuck
declare_counter a2u2_stuck
declare_counter a2u3_stuck
declare_counter a2u4_stuck
declare_counter a2u5_stuck
declare_counter a2u6_stuck
declare_counter a2u7_stuck
declare_counter a2u8_stuck
declare_counter a2u9_stuck
declare_counter a2u10_stuck
declare_counter a2u11_stuck
declare_counter a2u12_stuck
declare_counter a2u13_stuck
declare_counter a2u14_stuck
declare_counter a2u15_stuck
declare_counter a2u16_stuck
declare_counter a2u17_stuck
declare_counter a2u18_stuck
declare_counter a2u19_stuck
declare_counter a2u20_stuck
declare_counter a2u1_status
declare_counter a2u2_status
declare_counter a2u3_status
declare_counter a2u4_status
declare_counter a2u5_status
declare_counter a2u6_status
declare_counter a2u7_status
declare_counter a2u8_status
declare_counter a2u9_status
declare_counter a2u10_status
declare_counter a2u11_status
declare_counter a2u12_status
declare_counter a2u13_status
declare_counter a2u14_status
declare_counter a2u15_status
declare_counter a2u16_status
declare_counter a2u17_status
declare_counter a2u18_status
declare_counter a2u19_status
declare_counter a2u20_status
declare_counter a2u1_distance
declare_counter a2u2_distance
declare_counter a2u3_distance
declare_counter a2u4_distance
declare_counter a2u5_distance
declare_counter a2u6_distance
declare_counter a2u7_distance
declare_counter a2u8_distance
declare_counter a2u9_distance
declare_counter a2u10_distance
declare_counter a2u11_distance
declare_counter a2u12_distance
declare_counter a2u13_distance
declare_counter a2u14_distance
declare_counter a2u15_distance
declare_counter a2u16_distance
declare_counter a2u17_distance
declare_counter a2u18_distance
declare_counter a2u19_distance
declare_counter a2u20_distance
;;;;;;;
set_event_counter no_advice 1

monitor_event PreFactionTurnStart FactionIsLocal
    and BattleDifficulty > medium

    set_counter g5_battle_difficulty_high 1
    terminate_monitor
end_monitor

monitor_event PreFactionTurnStart FactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsGeneral TargetFactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsGeneral ! FactionIsLocal
    and ! TargetFactionIsLocal
    and I_CompareCounter panel_check != 2

    set_counter panel_check 2
end_monitor

monitor_event GeneralAssaultsResidence TargetFactionIsLocal
    and I_CompareCounter panel_check != 1

    set_counter panel_check 1
end_monitor

monitor_event GeneralAssaultsResidence ! FactionIsLocal
    and ! TargetFactionIsLocal
    and I_CompareCounter panel_check != 2

    set_counter panel_check 2
end_monitor

monitor_event ButtonPressed ButtonPressed prebattle_fight_button
    and I_CompareCounter panel_check = 1

;    suspend_unscripted_advice true
    set_counter fire_labels 10
    ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
    set_counter player_unit_count 0
    set_counter enemy_unit_count 0
    set_counter open_battle 0
    set_counter labels_only 0
    set_counter stakes_lock 0
    ;;;;;;;
    set_counter pu1_missile 0
    set_counter pu2_missile 0
    set_counter pu3_missile 0
    set_counter pu4_missile 0
    set_counter pu5_missile 0
    set_counter pu6_missile 0
    set_counter pu7_missile 0
    set_counter pu8_missile 0
    set_counter pu9_missile 0
    set_counter pu10_missile 0
    set_counter pu11_missile 0
    set_counter pu12_missile 0
    set_counter pu13_missile 0
    set_counter pu14_missile 0
    set_counter pu15_missile 0
    set_counter pu16_missile 0
    set_counter pu17_missile 0
    set_counter pu18_missile 0
    set_counter pu19_missile 0
    set_counter pu20_missile 0
    ;;;;;;;Checks
    set_counter check_timer 0
    set_counter elephant_fix_check 0
    set_counter elephant_fix_check_sally 0
    set_counter reinf_check 0
    set_counter script_delay 0
    set_counter sally_defense_check 0
    set_counter sally_check 0
    ;;;;;;;Stakes
    set_counter label_ready 0
    set_counter stakes_on 0
    ;;;;;;;Reinforcements
    set_counter army4_ready 0
    set_counter reinf_late 0

    set_counter distance_trigger1 0
    set_counter distance_trigger2 0
    set_counter distance_trigger3 0
    set_counter distance_trigger4 0
    set_counter distance_trigger5 0

    set_counter kill_labelling_reinf_allied 0
    set_counter army3_reinf_allied 0
    set_counter army4_reinf_allied 0
    set_counter army5_reinf_allied 0
    set_counter army6_reinf_allied 0
    set_counter army7_reinf_allied 0
    set_counter army8_reinf_allied 0
    set_counter army9_reinf_allied 0
    set_counter army10_reinf_allied 0
    set_counter army11_reinf_allied 0
    set_counter army12_reinf_allied 0
    set_counter army13_reinf_allied 0
    set_counter army14_reinf_allied 0
    set_counter army15_reinf_allied 0
    set_counter army16_reinf_allied 0
    set_counter launch_alliance_0 0
    set_counter launch_alliance_1 0

    set_counter apply_strategy 0
    set_counter relaunch_movement 0

    set_counter att_alliance_ready 0
    set_counter def_alliance_ready 0
    set_counter def_alliance_ready_siege 0

    set_counter army3_moving 0
    set_counter army3_run 0
    set_counter army3_reinf_late 0
    set_counter army4_moving 0
    set_counter army4_run 0
    set_counter army4_reinf_late 0
    set_counter army5_moving 0
    set_counter army5_run 0
    set_counter army5_reinf_late 0
    set_counter army6_moving 0
    set_counter army6_run 0
    set_counter army6_reinf_late 0
    set_counter army7_moving 0
    set_counter army7_run 0
    set_counter army7_reinf_late 0
    set_counter army8_moving 0
    set_counter army8_run 0
    set_counter army8_reinf_late 0
    set_counter army9_moving 0
    set_counter army9_run 0
    set_counter army9_reinf_late 0
    set_counter army10_moving 0
    set_counter army10_run 0
    set_counter army10_reinf_late 0
    set_counter army11_moving 0
    set_counter army11_run 0
    set_counter army11_reinf_late 0
    set_counter army12_moving 0
    set_counter army12_run 0
    set_counter army12_reinf_late 0
    set_counter army13_moving 0
    set_counter army13_run 0
    set_counter army13_reinf_late 0
    set_counter army14_moving 0
    set_counter army14_run 0
    set_counter army14_reinf_late 0
    set_counter army15_moving 0
    set_counter army15_run 0
    set_counter army15_reinf_late 0
    set_counter army16_moving 0
    set_counter army16_run 0
    set_counter army16_reinf_late 0

    set_counter army4_ready_siege 0 ; acts as launching counter
    set_counter army4_moving_siege 0
    set_counter army4_run_siege 0
    set_counter reinf_check_interval 0

    ;;;;;;;HA Fix
    set_counter ha_fix 0
    ;;;;;;;Elephant Fix
    set_counter elephant_fix 0
    set_counter elephant_gate 0
    set_counter elephant_gate_s 0
    set_counter elephant_gate_tier2 0
    set_counter elephant_gate_tier3 0
    set_counter elephant_gate_tier2s 0
    set_counter elephant_gate_tier3s 0
    set_counter rally_walls 0
    set_counter rally_walls_s 0
    set_counter second_ring 0
    set_counter third_ring 0
    set_counter second_ring_s 0
    set_counter third_ring_s 0
    set_counter del_objective 0
    set_counter del_objective_s 0
    ;;;;;;;Sally-out
    set_counter sally-out_fix 0
    set_counter sally_defense 0
    set_counter reform_back 0
    set_counter reform_multi 0
    set_counter unit_under_fire 0
    set_counter kill_sally 0
    set_counter sally_reinf 0
    set_counter reset_position 0
    set_counter defend_location 0
    set_counter reset_army2 0
    set_counter assign_labels 0
    ;;;;;;;Siege
    set_counter siege_fix 0
    set_counter army_sieging 0
    set_counter army_south 0
    set_counter army_north 0
    set_counter army_east 0
    set_counter army_west 0
    set_counter emergency_stop 0
    set_counter omfg_cannon_tower 0
    set_counter army2_sally 0
    set_counter wall_advance_s 0
    ;;;;;;;Protect General
    set_counter protect_general 0
    set_counter general_wait 0
    set_counter protect_siege 0
    set_counter g_stop 0
    ;;;;;;;Sally-out, AI defending
    set_counter army4_ready_sally 0
    set_counter army4_location 0
    set_counter path_n 0
    set_counter path_ne 0
    set_counter path_e 0
    set_counter path_se 0
    set_counter path_s 0
    set_counter path_sw 0
    set_counter path_w 0
    set_counter path_nw 0
    set_counter obstacle_check 0
    set_counter label_army4 0
    set_counter army4_moving_s 0
    set_counter army4_idle_s 0
    set_counter line_passed 0
    set_counter army2_idle_s 0
    set_counter army4_idle_r 0
    set_counter wall_line_passed 0
    set_counter reset_position_s 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    ;;;;;;;Open Battles
    set_counter ob_defense_launch 0
    set_counter ob_defend 0
    set_counter ob_siege_attack 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 0
    set_counter ob_engaged 0
    set_counter player_units_closing 0
    set_counter player_enveloping 0
    set_counter player_engaged_reinf 0
    ;;;;;;;AI Stuck Fix
    set_counter ai_stuck_launch 0
    set_counter a2u1_stuck 0
    set_counter a2u2_stuck 0
    set_counter a2u3_stuck 0
    set_counter a2u4_stuck 0
    set_counter a2u5_stuck 0
    set_counter a2u6_stuck 0
    set_counter a2u7_stuck 0
    set_counter a2u8_stuck 0
    set_counter a2u9_stuck 0
    set_counter a2u10_stuck 0
    set_counter a2u11_stuck 0
    set_counter a2u12_stuck 0
    set_counter a2u13_stuck 0
    set_counter a2u14_stuck 0
    set_counter a2u15_stuck 0
    set_counter a2u16_stuck 0
    set_counter a2u17_stuck 0
    set_counter a2u18_stuck 0
    set_counter a2u19_stuck 0
    set_counter a2u20_stuck 0
    set_counter a2u1_status 0
    set_counter a2u2_status 0
    set_counter a2u3_status 0
    set_counter a2u4_status 0
    set_counter a2u5_status 0
    set_counter a2u6_status 0
    set_counter a2u7_status 0
    set_counter a2u8_status 0
    set_counter a2u9_status 0
    set_counter a2u10_status 0
    set_counter a2u11_status 0
    set_counter a2u12_status 0
    set_counter a2u13_status 0
    set_counter a2u14_status 0
    set_counter a2u15_status 0
    set_counter a2u16_status 0
    set_counter a2u17_status 0
    set_counter a2u18_status 0
    set_counter a2u19_status 0
    set_counter a2u20_status 0
    set_counter a2u1_distance 0
    set_counter a2u2_distance 0
    set_counter a2u3_distance 0
    set_counter a2u4_distance 0
    set_counter a2u5_distance 0
    set_counter a2u6_distance 0
    set_counter a2u7_distance 0
    set_counter a2u8_distance 0
    set_counter a2u9_distance 0
    set_counter a2u10_distance 0
    set_counter a2u11_distance 0
    set_counter a2u12_distance 0
    set_counter a2u13_distance 0
    set_counter a2u14_distance 0
    set_counter a2u15_distance 0
    set_counter a2u16_distance 0
    set_counter a2u17_distance 0
    set_counter a2u18_distance 0
    set_counter a2u19_distance 0
    set_counter a2u20_distance 0
    prepare_for_battle
end_monitor

monitor_conditions I_InBattle
    and I_CompareCounter fire_labels = 10

    set_counter fire_labels 0
    battle_wait 0.1

    if ! I_BattleIsSiegeBattle
    set_counter fire_labels 1
    end_if

    if I_BattleIsSiegeBattle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter fire_labels 1
    end_if

if I_BattlePlayerArmyIsAttacker

    ;;;Army 1
    set_counter player_unit_count 0
    if I_BattlePlayerArmyNumberOfUnits > 0
    label_unit 0 0 0 a1u1
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 1
    label_unit 0 0 1 a1u2
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 2
    label_unit 0 0 2 a1u3
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 3
    label_unit 0 0 3 a1u4
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 4
    label_unit 0 0 4 a1u5
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 5
    label_unit 0 0 5 a1u6
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 6
    label_unit 0 0 6 a1u7
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 7
    label_unit 0 0 7 a1u8
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 8
    label_unit 0 0 8 a1u9
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 9
    label_unit 0 0 9 a1u10
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 10
    label_unit 0 0 10 a1u11
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 11
    label_unit 0 0 11 a1u12
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 12
    label_unit 0 0 12 a1u13
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 13
    label_unit 0 0 13 a1u14
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 14
    label_unit 0 0 14 a1u15
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 15
    label_unit 0 0 15 a1u16
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 16
    label_unit 0 0 16 a1u17
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 17
    label_unit 0 0 17 a1u18
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 18
    label_unit 0 0 18 a1u19
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits = 20
    label_unit 0 0 19 a1u20
    inc_counter player_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if
if I_BattlePlayerArmyIsAttacker
;    and ! I_BattleIsSiegeBattle
    ;;;Army 2
    set_counter enemy_unit_count 0
    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if I_BattlePlayerArmyIsAttacker

    if I_BattlePlayerArmyNumberOfUnits = 1
    define_unit_group army1 a1u1
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 2
    define_unit_group army1 a1u1 a1u2
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 3
    define_unit_group army1 a1u1 a1u2 a1u3
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 4
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 5
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 6
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 7
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 8
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 9
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 10
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 11
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 12
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 13
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 14
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 15
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 16
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 17
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 18
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 19
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 20
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19 a1u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker
;    and ! I_BattleIsSiegeBattle
    if I_BattleEnemyArmyNumberOfUnits = 1
    define_unit_group army2 a2u1
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 2
    define_unit_group army2 a2u1 a2u2
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 3
    define_unit_group army2 a2u1 a2u2 a2u3
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 4
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 5
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 6
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 7
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 8
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 9
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 10
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 11
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 12
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 13
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 14
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 15
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 16
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 17
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 18
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 19
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 20
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19 a2u20
    end_if
end_if
if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 1
    set_counter enemy_unit_count 0
    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 0 0 0 a1u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 0 0 1 a1u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 0 0 2 a1u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 0 0 3 a1u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 0 0 4 a1u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 0 0 5 a1u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 0 0 6 a1u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 0 0 7 a1u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 0 0 8 a1u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 0 0 9 a1u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 0 0 10 a1u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 0 0 11 a1u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 0 0 12 a1u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 0 0 13 a1u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 0 0 14 a1u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 0 0 15 a1u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 0 0 16 a1u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 0 0 17 a1u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 0 0 18 a1u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 0 0 19 a1u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ;;;Army 2
    set_counter player_unit_count 0
    if I_BattlePlayerArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter player_unit_count 1
    if I_BattlePlayerArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter player_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_BattleEnemyArmyNumberOfUnits = 1
    define_unit_group army1 a1u1
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 2
    define_unit_group army1 a1u1 a1u2
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 3
    define_unit_group army1 a1u1 a1u2 a1u3
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 4
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 5
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 6
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 7
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 8
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 9
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 10
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 11
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 12
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 13
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 14
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 15
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 16
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 17
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 18
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 19
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19
    end_if
    if I_BattleEnemyArmyNumberOfUnits = 20
    define_unit_group army1 a1u1 a1u2 a1u3 a1u4 a1u5 a1u6 a1u7 a1u8 a1u9 a1u10 a1u11 a1u12 a1u13 a1u14 a1u15 a1u16 a1u17 a1u18 a1u19 a1u20
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 1
    define_unit_group army2 a2u1
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 2
    define_unit_group army2 a2u1 a2u2
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 3
    define_unit_group army2 a2u1 a2u2 a2u3
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 4
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 5
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 6
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 7
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 8
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 9
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 10
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 11
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 12
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 13
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 14
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 15
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 16
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 17
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 18
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 19
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19
    end_if
    if I_BattlePlayerArmyNumberOfUnits = 20
    define_unit_group army2 a2u1 a2u2 a2u3 a2u4 a2u5 a2u6 a2u7 a2u8 a2u9 a2u10 a2u11 a2u12 a2u13 a2u14 a2u15 a2u16 a2u17 a2u18 a2u19 a2u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker
    if I_CompareCounter player_unit_count >= 1
    if I_UnitPercentageAmmoLeft a1u1 > 0
    set_counter pu1_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u1 = horde
    set_counter pu1_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 2
    if I_UnitPercentageAmmoLeft a1u2 > 0
    set_counter pu2_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u2 = horde
    set_counter pu2_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 3
    if I_UnitPercentageAmmoLeft a1u3 > 0
    set_counter pu3_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u3 = horde
    set_counter pu3_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 4
    if I_UnitPercentageAmmoLeft a1u4 > 0
    set_counter pu4_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u4 = horde
    set_counter pu4_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 5
    if I_UnitPercentageAmmoLeft a1u5 > 0
    set_counter pu5_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u5 = horde
    set_counter pu5_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 6
    if I_UnitPercentageAmmoLeft a1u6 > 0
    set_counter pu6_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u6 = horde
    set_counter pu6_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 7
    if I_UnitPercentageAmmoLeft a1u7 > 0
    set_counter pu7_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u7 = horde
    set_counter pu7_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 8
    if I_UnitPercentageAmmoLeft a1u8 > 0
    set_counter pu8_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u8 = horde
    set_counter pu8_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 9
    if I_UnitPercentageAmmoLeft a1u9 > 0
    set_counter pu9_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u9 = horde
    set_counter pu9_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 10
    if I_UnitPercentageAmmoLeft a1u10 > 0
    set_counter pu10_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u10 = horde
    set_counter pu10_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 11
    if I_UnitPercentageAmmoLeft a1u11 > 0
    set_counter pu11_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u11 = horde
    set_counter pu11_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 12
    if I_UnitPercentageAmmoLeft a1u12 > 0
    set_counter pu12_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u12 = horde
    set_counter pu12_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 13
    if I_UnitPercentageAmmoLeft a1u13 > 0
    set_counter pu13_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u13 = horde
    set_counter pu13_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 14
    if I_UnitPercentageAmmoLeft a1u14 > 0
    set_counter pu14_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u14 = horde
    set_counter pu14_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 15
    if I_UnitPercentageAmmoLeft a1u15 > 0
    set_counter pu15_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u15 = horde
    set_counter pu15_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 16
    if I_UnitPercentageAmmoLeft a1u16 > 0
    set_counter pu16_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u16 = horde
    set_counter pu16_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 17
    if I_UnitPercentageAmmoLeft a1u17 > 0
    set_counter pu17_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u17 = horde
    set_counter pu17_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 18
    if I_UnitPercentageAmmoLeft a1u18 > 0
    set_counter pu18_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u18 = horde
    set_counter pu18_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 19
    if I_UnitPercentageAmmoLeft a1u19 > 0
    set_counter pu19_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u19 = horde
    set_counter pu19_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count = 20
    if I_UnitPercentageAmmoLeft a1u20 > 0
    set_counter pu20_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a1u20 = horde
    set_counter pu20_missile 2
    end_if
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if ! I_BattlePlayerArmyIsAttacker
    if I_CompareCounter player_unit_count >= 1
    if I_UnitPercentageAmmoLeft a2u1 > 0
    set_counter pu1_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u1 = horde
    set_counter pu1_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 2
    if I_UnitPercentageAmmoLeft a2u2 > 0
    set_counter pu2_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u2 = horde
    set_counter pu2_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 3
    if I_UnitPercentageAmmoLeft a2u3 > 0
    set_counter pu3_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u3 = horde
    set_counter pu3_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 4
    if I_UnitPercentageAmmoLeft a2u4 > 0
    set_counter pu4_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u4 = horde
    set_counter pu4_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 5
    if I_UnitPercentageAmmoLeft a2u5 > 0
    set_counter pu5_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u5 = horde
    set_counter pu5_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 6
    if I_UnitPercentageAmmoLeft a2u6 > 0
    set_counter pu6_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u6 = horde
    set_counter pu6_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 7
    if I_UnitPercentageAmmoLeft a2u7 > 0
    set_counter pu7_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u7 = horde
    set_counter pu7_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 8
    if I_UnitPercentageAmmoLeft a2u8 > 0
    set_counter pu8_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u8 = horde
    set_counter pu8_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 9
    if I_UnitPercentageAmmoLeft a2u9 > 0
    set_counter pu9_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u9 = horde
    set_counter pu9_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 10
    if I_UnitPercentageAmmoLeft a2u10 > 0
    set_counter pu10_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u10 = horde
    set_counter pu10_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 11
    if I_UnitPercentageAmmoLeft a2u11 > 0
    set_counter pu11_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u11 = horde
    set_counter pu11_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 12
    if I_UnitPercentageAmmoLeft a2u12 > 0
    set_counter pu12_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u12 = horde
    set_counter pu12_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 13
    if I_UnitPercentageAmmoLeft a2u13 > 0
    set_counter pu13_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u13 = horde
    set_counter pu13_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 14
    if I_UnitPercentageAmmoLeft a2u14 > 0
    set_counter pu14_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u14 = horde
    set_counter pu14_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 15
    if I_UnitPercentageAmmoLeft a2u15 > 0
    set_counter pu15_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u15 = horde
    set_counter pu15_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 16
    if I_UnitPercentageAmmoLeft a2u16 > 0
    set_counter pu16_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u16 = horde
    set_counter pu16_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 17
    if I_UnitPercentageAmmoLeft a2u17 > 0
    set_counter pu17_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u17 = horde
    set_counter pu17_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 18
    if I_UnitPercentageAmmoLeft a2u18 > 0
    set_counter pu18_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u18 = horde
    set_counter pu18_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count >= 19
    if I_UnitPercentageAmmoLeft a2u19 > 0
    set_counter pu19_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u19 = horde
    set_counter pu19_missile 2
    end_if
    end_if

    if I_CompareCounter player_unit_count = 20
    if I_UnitPercentageAmmoLeft a2u20 > 0
    set_counter pu20_missile 1
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_UnitFormation a2u20 = horde
    set_counter pu20_missile 2
    end_if
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if
;    battle_wait 0.1
;    ai_active_set off
    battle_wait 0.1
    ai_active_set on
    set_counter labels_only 1

    if I_BattleIsSiegeBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter ai_stuck_launch 1
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattlePlayerArmyNumberOfAttribute stakes > 0
    set_counter stakes_lock 1
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
    set_counter protect_siege 1
    end_if

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and ! I_BattleIsRiverBattle
    and ! I_ConflictType SuccessfulAmbush
    set_counter open_battle 1
    end_if

if I_CompareCounter fire_labels = 1
    if I_BattleIsSiegeBattle
    label_location 0, -850, south_side
    label_location 0, 850, north_side
    label_location -850, 0, west_side
    label_location 850, 0, east_side
    end_if

    if I_BattleIsSallyOutBattle
    label_location 0, -850, south_side
    label_location 0, 850, north_side
    label_location -850, 0, west_side
    label_location 850, 0, east_side
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    label_location -470, -470, sw
    label_location 470, -470, se
    label_location -470, 470, nw
    label_location 470, 470, ne
    label_location -400, -400, sw_wall
    label_location 400, -400, se_wall
    label_location -400, 400, nw_wall
    label_location 400, 400, ne_wall
    end_if

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 west_side east_side > 200
    set_counter army_south 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 west_side east_side < -200
    set_counter army_north 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 south_side north_side > 200
    set_counter army_east 1
    end_if
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a1u1 south_side north_side < -200
    set_counter army_west 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 west_side east_side > 200
    set_counter army_south 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 west_side east_side < -200
    set_counter army_north 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 south_side north_side > 200
    set_counter army_east 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitDistanceFromLine a2u1 south_side north_side < -200
    set_counter army_west 1
    end_if
    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter sally-out_fix 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter siege_fix 1
    end_if

    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    and I_BattleIsSiegeBattle
    set_counter elephant_fix 1
    end_if

end_if
end_monitor

monitor_event BattleConflictPhaseCommenced FactionIsLocal
    and I_CompareCounter panel_check = 1

    set_counter script_delay 1
    battle_wait 15
    if I_CompareCounter script_delay = 1

    if I_CompareCounter fire_labels = 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_CompareCounter g5_battle_difficulty_high = 1
    and I_BattleIsSiegeBattle
    set_counter label_ready 1
    end_if

    if I_CompareCounter fire_labels = 1
    if I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_CompareCounter g5_battle_difficulty_high = 1
    and ! I_BattleIsSiegeBattle
    set_counter label_ready 1
    end_if

    if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1
    ai_gta_plan_set 1 DEFEND_FEATURE
    battle_wait 1
    ai_active_set on
    set_counter ob_defense_launch 1
    end_if
    end_if

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and ! I_BattleIsRiverBattle
    and ! I_ConflictType SuccessfulAmbush
    and I_BattleEnemyArmyNumberOfUnits > 2
    set_counter g_stop 1
    end_if

    if I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter fire_labels = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter sally_defense 1
    set_counter assign_labels 1
    end_if

    if I_BattleStarted
    and I_CompareCounter fire_labels = 1
    and I_CompareCounter open_battle = 1
    set_counter ha_fix 1
    end_if

    if I_BattleStarted
    and I_CompareCounter fire_labels = 1
    and I_BattleIsRiverBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter ha_fix 1
    end_if
    set_counter script_delay 0
    end_if
end_monitor

monitor_event BattleReinforcementsArrive ! ArmyIsLocal
    and I_CompareCounter panel_check = 1
    and I_CompareCounter fire_labels = 1

    set_counter reinf_check 1
    battle_wait 15
if I_CompareCounter reinf_check = 1
    set_counter reinf_check 2
    battle_wait 15
if I_CompareCounter reinf_check = 2
    set_counter reinf_check 3
    battle_wait 15
if I_CompareCounter reinf_check = 3
 if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 3
    label_unit 0 1 0 a3u1
    define_unit_group army3a a3u1
    if ! I_PercentageUnitGroupKilled army3a = 100
    undefine_unit_group army3a
    ;;;Army 3
    label_unit 0 1 0 a3u1
    label_unit 0 1 1 a3u2
    label_unit 0 1 2 a3u3
    label_unit 0 1 3 a3u4
    label_unit 0 1 4 a3u5
    label_unit 0 1 5 a3u6
    label_unit 0 1 6 a3u7
    label_unit 0 1 7 a3u8
    label_unit 0 1 8 a3u9
    label_unit 0 1 9 a3u10
    label_unit 0 1 10 a3u11
    label_unit 0 1 11 a3u12
    label_unit 0 1 12 a3u13
    label_unit 0 1 13 a3u14
    label_unit 0 1 14 a3u15
    label_unit 0 1 15 a3u16
    label_unit 0 1 16 a3u17
    label_unit 0 1 17 a3u18
    label_unit 0 1 18 a3u19
    label_unit 0 1 19 a3u20

    define_unit_group army3 a3u1 a3u2 a3u3 a3u4 a3u5 a3u6 a3u7 a3u8 a3u9 a3u10 a3u11 a3u12 a3u13 a3u14 a3u15 a3u16 a3u17 a3u18 a3u19 a3u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker

    ;;;Army 4
    label_unit 1 1 0 a4u1
    define_unit_group army4a a4u1
    if ! I_PercentageUnitGroupKilled army4a = 100
    undefine_unit_group army4a
    ;;;Army 4
    label_unit 1 1 0 a4u1
    label_unit 1 1 1 a4u2
    label_unit 1 1 2 a4u3
    label_unit 1 1 3 a4u4
    label_unit 1 1 4 a4u5
    label_unit 1 1 5 a4u6
    label_unit 1 1 6 a4u7
    label_unit 1 1 7 a4u8
    label_unit 1 1 8 a4u9
    label_unit 1 1 9 a4u10
    label_unit 1 1 10 a4u11
    label_unit 1 1 11 a4u12
    label_unit 1 1 12 a4u13
    label_unit 1 1 13 a4u14
    label_unit 1 1 14 a4u15
    label_unit 1 1 15 a4u16
    label_unit 1 1 16 a4u17
    label_unit 1 1 17 a4u18
    label_unit 1 1 18 a4u19
    label_unit 1 1 19 a4u20

    define_unit_group army4 a4u1 a4u2 a4u3 a4u4 a4u5 a4u6 a4u7 a4u8 a4u9 a4u10 a4u11 a4u12 a4u13 a4u14 a4u15 a4u16 a4u17 a4u18 a4u19 a4u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army3 = 100
    set_counter army3_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army4 = 100
    set_counter army4_reinf_allied 1
    end_if

    if I_PercentageUnitGroupKilled army3 = 100
    and I_PercentageUnitGroupKilled army4 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

if ! I_BattleIsSallyOutBattle

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 5
    label_unit 0 2 0 a5u1
    define_unit_group army5a a5u1
    if ! I_PercentageUnitGroupKilled army5a = 100
    undefine_unit_group army5a
    ;;;Army 5
    label_unit 0 2 0 a5u1
    label_unit 0 2 1 a5u2
    label_unit 0 2 2 a5u3
    label_unit 0 2 3 a5u4
    label_unit 0 2 4 a5u5
    label_unit 0 2 5 a5u6
    label_unit 0 2 6 a5u7
    label_unit 0 2 7 a5u8
    label_unit 0 2 8 a5u9
    label_unit 0 2 9 a5u10
    label_unit 0 2 10 a5u11
    label_unit 0 2 11 a5u12
    label_unit 0 2 12 a5u13
    label_unit 0 2 13 a5u14
    label_unit 0 2 14 a5u15
    label_unit 0 2 15 a5u16
    label_unit 0 2 16 a5u17
    label_unit 0 2 17 a5u18
    label_unit 0 2 18 a5u19
    label_unit 0 2 19 a5u20

    define_unit_group army5 a5u1 a5u2 a5u3 a5u4 a5u5 a5u6 a5u7 a5u8 a5u9 a5u10 a5u11 a5u12 a5u13 a5u14 a5u15 a5u16 a5u17 a5u18 a5u19 a5u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker
    ;;;Army 6
    label_unit 1 2 0 a6u1
    define_unit_group army6a a6u1
    if ! I_PercentageUnitGroupKilled army6a = 100
    undefine_unit_group army6a 	
    ;;;Army 6
    label_unit 1 2 0 a6u1
    label_unit 1 2 1 a6u2
    label_unit 1 2 2 a6u3
    label_unit 1 2 3 a6u4
    label_unit 1 2 4 a6u5
    label_unit 1 2 5 a6u6
    label_unit 1 2 6 a6u7
    label_unit 1 2 7 a6u8
    label_unit 1 2 8 a6u9
    label_unit 1 2 9 a6u10
    label_unit 1 2 10 a6u11
    label_unit 1 2 11 a6u12
    label_unit 1 2 12 a6u13
    label_unit 1 2 13 a6u14
    label_unit 1 2 14 a6u15
    label_unit 1 2 15 a6u16
    label_unit 1 2 16 a6u17
    label_unit 1 2 17 a6u18
    label_unit 1 2 18 a6u19
    label_unit 1 2 19 a6u20

    define_unit_group army6 a6u1 a6u2 a6u3 a6u4 a6u5 a6u6 a6u7 a6u8 a6u9 a6u10 a6u11 a6u12 a6u13 a6u14 a6u15 a6u16 a6u17 a6u18 a6u19 a6u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army5 = 100
    set_counter army5_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army6 = 100
    set_counter army6_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army5 = 100
    and I_PercentageUnitGroupKilled army6 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 7
    label_unit 0 3 0 a7u1
    define_unit_group army7a a7u1
    if ! I_PercentageUnitGroupKilled army7a = 100
    undefine_unit_group army7a 	
    ;;;Army 7
    label_unit 0 3 0 a7u1
    label_unit 0 3 1 a7u2
    label_unit 0 3 2 a7u3
    label_unit 0 3 3 a7u4
    label_unit 0 3 4 a7u5
    label_unit 0 3 5 a7u6
    label_unit 0 3 6 a7u7
    label_unit 0 3 7 a7u8
    label_unit 0 3 8 a7u9
    label_unit 0 3 9 a7u10
    label_unit 0 3 10 a7u11
    label_unit 0 3 11 a7u12
    label_unit 0 3 12 a7u13
    label_unit 0 3 13 a7u14
    label_unit 0 3 14 a7u15
    label_unit 0 3 15 a7u16
    label_unit 0 3 16 a7u17
    label_unit 0 3 17 a7u18
    label_unit 0 3 18 a7u19
    label_unit 0 3 19 a7u20

    define_unit_group army7 a7u1 a7u2 a7u3 a7u4 a7u5 a7u6 a7u7 a7u8 a7u9 a7u10 a7u11 a7u12 a7u13 a7u14 a7u15 a7u16 a7u17 a7u18 a7u19 a7u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 8
    label_unit 1 3 0 a8u1
    define_unit_group army8a a8u1
    if ! I_PercentageUnitGroupKilled army8a = 100
    undefine_unit_group army8a 	
    ;;;Army 8
    label_unit 1 3 0 a8u1
    label_unit 1 3 1 a8u2
    label_unit 1 3 2 a8u3
    label_unit 1 3 3 a8u4
    label_unit 1 3 4 a8u5
    label_unit 1 3 5 a8u6
    label_unit 1 3 6 a8u7
    label_unit 1 3 7 a8u8
    label_unit 1 3 8 a8u9
    label_unit 1 3 9 a8u10
    label_unit 1 3 10 a8u11
    label_unit 1 3 11 a8u12
    label_unit 1 3 12 a8u13
    label_unit 1 3 13 a8u14
    label_unit 1 3 14 a8u15
    label_unit 1 3 15 a8u16
    label_unit 1 3 16 a8u17
    label_unit 1 3 17 a8u18
    label_unit 1 3 18 a8u19
    label_unit 1 3 19 a8u20

    define_unit_group army8 a8u1 a8u2 a8u3 a8u4 a8u5 a8u6 a8u7 a8u8 a8u9 a8u10 a8u11 a8u12 a8u13 a8u14 a8u15 a8u16 a8u17 a8u18 a8u19 a8u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army7 = 100
    set_counter army7_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army8 = 100
    set_counter army8_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army7 = 100
    and I_PercentageUnitGroupKilled army8 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 9
    label_unit 0 4 0 a9u1
    define_unit_group army9a a9u1
    if ! I_PercentageUnitGroupKilled army9a = 100
    undefine_unit_group army9a 	
    ;;;Army 9
    label_unit 0 4 0 a9u1
    label_unit 0 4 1 a9u2
    label_unit 0 4 2 a9u3
    label_unit 0 4 3 a9u4
    label_unit 0 4 4 a9u5
    label_unit 0 4 5 a9u6
    label_unit 0 4 6 a9u7
    label_unit 0 4 7 a9u8
    label_unit 0 4 8 a9u9
    label_unit 0 4 9 a9u10
    label_unit 0 4 10 a9u11
    label_unit 0 4 11 a9u12
    label_unit 0 4 12 a9u13
    label_unit 0 4 13 a9u14
    label_unit 0 4 14 a9u15
    label_unit 0 4 15 a9u16
    label_unit 0 4 16 a9u17
    label_unit 0 4 17 a9u18
    label_unit 0 4 18 a9u19
    label_unit 0 4 19 a9u20

    define_unit_group army9 a9u1 a9u2 a9u3 a9u4 a9u5 a9u6 a9u7 a9u8 a9u9 a9u10 a9u11 a9u12 a9u13 a9u14 a9u15 a9u16 a9u17 a9u18 a9u19 a9u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 10
    label_unit 1 4 0 a10u1
    define_unit_group army10a a10u1
    if ! I_PercentageUnitGroupKilled army10a = 100
    undefine_unit_group army10a 	
    ;;;Army 10
    label_unit 1 4 0 a10u1
    label_unit 1 4 1 a10u2
    label_unit 1 4 2 a10u3
    label_unit 1 4 3 a10u4
    label_unit 1 4 4 a10u5
    label_unit 1 4 5 a10u6
    label_unit 1 4 6 a10u7
    label_unit 1 4 7 a10u8
    label_unit 1 4 8 a10u9
    label_unit 1 4 9 a10u10
    label_unit 1 4 10 a10u11
    label_unit 1 4 11 a10u12
    label_unit 1 4 12 a10u13
    label_unit 1 4 13 a10u14
    label_unit 1 4 14 a10u15
    label_unit 1 4 15 a10u16
    label_unit 1 4 16 a10u17
    label_unit 1 4 17 a10u18
    label_unit 1 4 18 a10u19
    label_unit 1 4 19 a10u20

    define_unit_group army10 a10u1 a10u2 a10u3 a10u4 a10u5 a10u6 a10u7 a10u8 a10u9 a10u10 a10u11 a10u12 a10u13 a10u14 a10u15 a10u16 a10u17 a10u18 a10u19 a10u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army9 = 100
    set_counter army9_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army10 = 100
    set_counter army10_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army9 = 100
    and I_PercentageUnitGroupKilled army10 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 11
    label_unit 0 5 0 a11u1
    define_unit_group army11a a11u1
    if ! I_PercentageUnitGroupKilled army11a = 100
    undefine_unit_group army11a 	
    ;;;Army 11
    label_unit 0 5 0 a11u1
    label_unit 0 5 1 a11u2
    label_unit 0 5 2 a11u3
    label_unit 0 5 3 a11u4
    label_unit 0 5 4 a11u5
    label_unit 0 5 5 a11u6
    label_unit 0 5 6 a11u7
    label_unit 0 5 7 a11u8
    label_unit 0 5 8 a11u9
    label_unit 0 5 9 a11u10
    label_unit 0 5 10 a11u11
    label_unit 0 5 11 a11u12
    label_unit 0 5 12 a11u13
    label_unit 0 5 13 a11u14
    label_unit 0 5 14 a11u15
    label_unit 0 5 15 a11u16
    label_unit 0 5 16 a11u17
    label_unit 0 5 17 a11u18
    label_unit 0 5 18 a11u19
    label_unit 0 5 19 a11u20

    define_unit_group army11 a11u1 a11u2 a11u3 a11u4 a11u5 a11u6 a11u7 a11u8 a11u9 a11u10 a11u11 a11u12 a11u13 a11u14 a11u15 a11u16 a11u17 a11u18 a11u19 a11u20
    end_if
end_if
if I_BattlePlayerArmyIsAttacker 	
    ;;;Army 12
    label_unit 1 5 0 a12u1
    define_unit_group army12a a12u1
    if ! I_PercentageUnitGroupKilled army12a = 100
    undefine_unit_group army12a 	
    ;;;Army 12
    label_unit 1 5 0 a12u1
    label_unit 1 5 1 a12u2
    label_unit 1 5 2 a12u3
    label_unit 1 5 3 a12u4
    label_unit 1 5 4 a12u5
    label_unit 1 5 5 a12u6
    label_unit 1 5 6 a12u7
    label_unit 1 5 7 a12u8
    label_unit 1 5 8 a12u9
    label_unit 1 5 9 a12u10
    label_unit 1 5 10 a12u11
    label_unit 1 5 11 a12u12
    label_unit 1 5 12 a12u13
    label_unit 1 5 13 a12u14
    label_unit 1 5 14 a12u15
    label_unit 1 5 15 a12u16
    label_unit 1 5 16 a12u17
    label_unit 1 5 17 a12u18
    label_unit 1 5 18 a12u19
    label_unit 1 5 19 a12u20

    define_unit_group army12 a12u1 a12u2 a12u3 a12u4 a12u5 a12u6 a12u7 a12u8 a12u9 a12u10 a12u11 a12u12 a12u13 a12u14 a12u15 a12u16 a12u17 a12u18 a12u19 a12u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army11 = 100
    set_counter army11_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army12 = 100
    set_counter army12_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army11 = 100
    and I_PercentageUnitGroupKilled army12 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 13
    label_unit 0 6 0 a13u1
    define_unit_group army13a a13u1
    if ! I_PercentageUnitGroupKilled army13a = 100
    undefine_unit_group army13a 	
    ;;;Army 13
    label_unit 0 6 0 a13u1
    label_unit 0 6 1 a13u2
    label_unit 0 6 2 a13u3
    label_unit 0 6 3 a13u4
    label_unit 0 6 4 a13u5
    label_unit 0 6 5 a13u6
    label_unit 0 6 6 a13u7
    label_unit 0 6 7 a13u8
    label_unit 0 6 8 a13u9
    label_unit 0 6 9 a13u10
    label_unit 0 6 10 a13u11
    label_unit 0 6 11 a13u12
    label_unit 0 6 12 a13u13
    label_unit 0 6 13 a13u14
    label_unit 0 6 14 a13u15
    label_unit 0 6 15 a13u16
    label_unit 0 6 16 a13u17
    label_unit 0 6 17 a13u18
    label_unit 0 6 18 a13u19
    label_unit 0 6 19 a13u20

    define_unit_group army13 a13u1 a13u2 a13u3 a13u4 a13u5 a13u6 a13u7 a13u8 a13u9 a13u10 a13u11 a13u12 a13u13 a13u14 a13u15 a13u16 a13u17 a13u18 a13u19 a13u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker	
    ;;;Army 14
    label_unit 1 6 0 a14u1
    define_unit_group army14a a14u1
    if ! I_PercentageUnitGroupKilled army14a = 100
    undefine_unit_group army14a 	
    ;;;Army 14
    label_unit 1 6 0 a14u1
    label_unit 1 6 1 a14u2
    label_unit 1 6 2 a14u3
    label_unit 1 6 3 a14u4
    label_unit 1 6 4 a14u5
    label_unit 1 6 5 a14u6
    label_unit 1 6 6 a14u7
    label_unit 1 6 7 a14u8
    label_unit 1 6 8 a14u9
    label_unit 1 6 9 a14u10
    label_unit 1 6 10 a14u11
    label_unit 1 6 11 a14u12
    label_unit 1 6 12 a14u13
    label_unit 1 6 13 a14u14
    label_unit 1 6 14 a14u15
    label_unit 1 6 15 a14u16
    label_unit 1 6 16 a14u17
    label_unit 1 6 17 a14u18
    label_unit 1 6 18 a14u19
    label_unit 1 6 19 a14u20

    define_unit_group army14 a14u1 a14u2 a14u3 a14u4 a14u5 a14u6 a14u7 a14u8 a14u9 a14u10 a14u11 a14u12 a14u13 a14u14 a14u15 a14u16 a14u17 a14u18 a14u19 a14u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army13 = 100
    set_counter army13_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army14 = 100
    set_counter army14_reinf_allied 1
    end_if
    if I_PercentageUnitGroupKilled army13 = 100
    and I_PercentageUnitGroupKilled army14 = 100
    set_counter kill_labelling_reinf_allied 1
    end_if

end_if

if I_CompareCounter kill_labelling_reinf_allied = 0

if ! I_BattlePlayerArmyIsAttacker
    ;;;Army 15
    label_unit 0 7 0 a15u1
    define_unit_group army15a a15u1
    if ! I_PercentageUnitGroupKilled army15a = 100
    undefine_unit_group army15a 	
    ;;;Army 15
    label_unit 0 7 0 a15u1
    label_unit 0 7 1 a15u2
    label_unit 0 7 2 a15u3
    label_unit 0 7 3 a15u4
    label_unit 0 7 4 a15u5
    label_unit 0 7 5 a15u6
    label_unit 0 7 6 a15u7
    label_unit 0 7 7 a15u8
    label_unit 0 7 8 a15u9
    label_unit 0 7 9 a15u10
    label_unit 0 7 10 a15u11
    label_unit 0 7 11 a15u12
    label_unit 0 7 12 a15u13
    label_unit 0 7 13 a15u14
    label_unit 0 7 14 a15u15
    label_unit 0 7 15 a15u16
    label_unit 0 7 16 a15u17
    label_unit 0 7 17 a15u18
    label_unit 0 7 18 a15u19
    label_unit 0 7 19 a15u20

    define_unit_group army15 a15u1 a15u2 a15u3 a15u4 a15u5 a15u6 a15u7 a15u8 a15u9 a15u10 a15u11 a15u12 a15u13 a15u14 a15u15 a15u16 a15u17 a15u18 a15u19 a15u20
    end_if
end_if

if I_BattlePlayerArmyIsAttacker	
    ;;;Army 16
    label_unit 1 7 0 a16u1
    define_unit_group army16a a16u1
    if ! I_PercentageUnitGroupKilled army16a = 100
    undefine_unit_group army16a 	
    ;;;Army 16
    label_unit 1 7 0 a16u1
    label_unit 1 7 1 a16u2
    label_unit 1 7 2 a16u3
    label_unit 1 7 3 a16u4
    label_unit 1 7 4 a16u5
    label_unit 1 7 5 a16u6
    label_unit 1 7 6 a16u7
    label_unit 1 7 7 a16u8
    label_unit 1 7 8 a16u9
    label_unit 1 7 9 a16u10
    label_unit 1 7 10 a16u11
    label_unit 1 7 11 a16u12
    label_unit 1 7 12 a16u13
    label_unit 1 7 13 a16u14
    label_unit 1 7 14 a16u15
    label_unit 1 7 15 a16u16
    label_unit 1 7 16 a16u17
    label_unit 1 7 17 a16u18
    label_unit 1 7 18 a16u19
    label_unit 1 7 19 a16u20

    define_unit_group army16 a16u1 a16u2 a16u3 a16u4 a16u5 a16u6 a16u7 a16u8 a16u9 a16u10 a16u11 a16u12 a16u13 a16u14 a16u15 a16u16 a16u17 a16u18 a16u19 a16u20
    end_if
end_if

    if ! I_PercentageUnitGroupKilled army15 = 100
    set_counter army15_reinf_allied 1
    end_if

    if ! I_PercentageUnitGroupKilled army16 = 100
    set_counter army16_reinf_allied 1
    end_if
end_if

end_if
battle_wait 0.5
ai_active_set on

;;;;;;;Reinforcements

    ;;;;;;; Attacking
    if ! I_BattlePlayerArmyIsAttacker
    and ! I_ConflictType SuccessfulAmbush
;    and ! I_ConflictType FailedAmbush
    and ! I_BattleIsSiegeBattle
    and I_CompareCounter army3_reinf_allied = 1

    set_counter apply_strategy 1
;    battle_wait 1
;    set_counter att_alliance_ready 1
    end_if

    ;;;;;;; Defending
    if I_BattlePlayerArmyIsAttacker
    and ! I_ConflictType SuccessfulAmbush
;    and ! I_ConflictType FailedAmbush
    and I_CompareCounter army4_reinf_allied = 1

    if ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    set_counter army4_ready 1
    set_counter def_alliance_ready 1
    end_if
    if ! I_BattleIsSiegeBattle
    and I_BattleIsSallyOutBattle
    set_counter army4_ready_sally 1
    set_counter sally_reinf 1
    end_if

    ;;;;;;; Siege
    if I_BattleIsSiegeBattle
    set_counter def_alliance_ready_siege 1
    end_if
    end_if
end_if
end_if
end_if
end_monitor

;Apply Strategy

monitor_conditions I_BattleStarted
    and I_CompareCounter apply_strategy = 1

if ! I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1

;    ai_gta_plan_set 0 ATTACK_ALL
    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
    set_counter launch_alliance_0 1
end_if

if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter open_battle = 1

;    ai_gta_plan_set 1 ATTACK_ALL
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999
    set_counter launch_alliance_1 1
end_if

if I_CompareCounter launch_alliance_0 = 1
    and I_CompareCounter army3_reinf_allied = 1

    ;;;Army 1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a1u20
    ;;;Army 3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a3u20
if I_CompareCounter army5_reinf_allied = 1
    ;;;Army 5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a5u20
if I_CompareCounter army7_reinf_allied = 1
    ;;;Army 7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a7u20
if I_CompareCounter army9_reinf_allied = 1
     ;;;Army 9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a9u20
if I_CompareCounter army11_reinf_allied = 1
    ;;;Army 11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a11u20
if I_CompareCounter army13_reinf_allied = 1
    ;;;Army 13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a13u20
if I_CompareCounter army15_reinf_allied = 1
    ;;;Army 15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u1
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u2
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u3
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u4
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u5
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u6
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u7
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u8
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u9
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u10
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u11
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u12
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u13
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u14
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u15
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u16
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u17
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u18
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u19
    ai_gta_add_unit_label 0 G5_OBJECTIVE a15u20
end_if
end_if
end_if
end_if
end_if
end_if
end_if

if I_CompareCounter launch_alliance_1 = 1
    and I_CompareCounter army4_reinf_allied = 1

    ;;;Army 2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a2u20
    ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20
if I_CompareCounter army6_reinf_allied = 1
    ;;;Army 6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a6u20
if I_CompareCounter army8_reinf_allied = 1
    ;;;Army 8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a8u20
if I_CompareCounter army10_reinf_allied = 1
     ;;;Army 10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a10u20
if I_CompareCounter army12_reinf_allied = 1
    ;;;Army 12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a12u20
if I_CompareCounter army14_reinf_allied = 1
    ;;;Army 14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a14u20
if I_CompareCounter army16_reinf_allied = 1
    ;;;Army 16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a16u20
end_if
end_if
end_if
end_if
end_if
end_if
end_if
battle_wait 0.5
ai_active_set on
set_counter apply_strategy 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter relaunch_movement = 1

    ai_active_set on
    battle_wait 0.5
    set_counter army3_moving 0
    set_counter army4_moving 0
    set_counter army5_moving 0
    set_counter army6_moving 0
    set_counter army7_moving 0
    set_counter army8_moving 0
    set_counter army9_moving 0
    set_counter army10_moving 0
    set_counter army11_moving 0
    set_counter army12_moving 0
    set_counter army13_moving 0
    set_counter army14_moving 0
    set_counter army15_moving 0
    set_counter army16_moving 0

    battle_wait 5
    set_counter relaunch_movement 0
end_monitor

;;;;;;; Attacking

monitor_conditions I_BattleStarted
    and I_CompareCounter att_alliance_ready = 1
    and ! I_BattlePlayerArmyIsAttacker
 ;    inc_counter reinf_check_interval 1
 if I_CompareCounter army3_reinf_allied = 1

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 1
    and I_UnitEnemyUnitInRadius a3u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army3_moving 0
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 1
    and ! I_UnitEnemyUnitInRadius a3u1 160
    and I_UnitDistanceFromUnit a1u1 a3u1 > 150
    and I_IsUnitIdle a3u1

    set_counter army3_reinf_late 1
    battle_wait 1
    set_counter army3_moving 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_moving = 0
    and ! I_UnitEnemyUnitInRadius a3u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    set_counter army3_run 1
    set_counter army3_moving 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 1000

    set_counter army3_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 750

    set_counter army3_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 500

    set_counter army3_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 300

    set_counter army3_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a3u1 a1u1 < 200

    set_counter army3_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a3u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army3

    set_counter army3_run 1
    battle_wait 0.5
    set_counter army3_moving 1
    set_counter army3_reinf_late 0
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 100

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitKilled a3u1 > 60

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitGroupKilled army3 > 50

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a3u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army3 a1u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a3u1 < 250
    and I_IsUnitIdle a3u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a3u1 < 250
    and I_IsUnitUnderFire a3u1

    set_counter army3_reinf_allied 0
    unit_group_order_halt army3
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army3_reinf_allied = 1
    and I_CompareCounter army3_run = 1

;    unit_group_order_halt army3
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army3 a1u1 run
    battle_wait 0.5
    set_counter army3_run 0
    end_if

end_if

if I_CompareCounter army5_reinf_allied = 1

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 1
    and I_UnitEnemyUnitInRadius a5u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army5_moving 0
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 1
    and ! I_UnitEnemyUnitInRadius a5u1 160
    and I_UnitDistanceFromUnit a1u1 a5u1 > 150
    and I_IsUnitIdle a5u1

    set_counter army5_reinf_late 1
    battle_wait 1
    set_counter army5_moving 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_moving = 0
    and ! I_UnitEnemyUnitInRadius a5u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    set_counter army5_run 1
    set_counter army5_moving 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 1000

    set_counter army5_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 750

    set_counter army5_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 500

    set_counter army5_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 300

    set_counter army5_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a5u1 a1u1 < 200

    set_counter army5_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a5u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army5

    set_counter army5_run 1
    battle_wait 0.5
    set_counter army5_moving 1
    set_counter army5_reinf_late 0
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 100

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitKilled a5u1 > 60

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitGroupKilled army5 > 50

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a5u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army5 a1u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a5u1 < 250
    and I_IsUnitIdle a5u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a5u1 < 250
    and I_IsUnitUnderFire a5u1

    set_counter army5_reinf_allied 0
    unit_group_order_halt army5
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army5_reinf_allied = 1
    and I_CompareCounter army5_run = 1

;    unit_group_order_halt army5
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army5 a1u1 run
    battle_wait 0.5
    set_counter army5_run 0
    end_if

end_if

if I_CompareCounter army7_reinf_allied = 1

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 1
    and I_UnitEnemyUnitInRadius a7u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army7_moving 0
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 1
    and ! I_UnitEnemyUnitInRadius a7u1 160
    and I_UnitDistanceFromUnit a1u1 a7u1 > 150
    and I_IsUnitIdle a7u1

    set_counter army7_reinf_late 1
    battle_wait 1
    set_counter army7_moving 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_moving = 0
    and ! I_UnitEnemyUnitInRadius a7u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    set_counter army7_run 1
    set_counter army7_moving 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 1000

    set_counter army7_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 750

    set_counter army7_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 500

    set_counter army7_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 300

    set_counter army7_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a7u1 a1u1 < 200

    set_counter army7_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a7u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army7

    set_counter army7_run 1
    battle_wait 0.5
    set_counter army7_moving 1
    set_counter army7_reinf_late 0
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 100

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitKilled a7u1 > 60

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitGroupKilled army7 > 50

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a7u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army7 a1u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a7u1 < 250
    and I_IsUnitIdle a7u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a7u1 < 250
    and I_IsUnitUnderFire a7u1

    set_counter army7_reinf_allied 0
    unit_group_order_halt army7
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army7_reinf_allied = 1
    and I_CompareCounter army7_run = 1

;    unit_group_order_halt army7
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army7 a1u1 run
    battle_wait 0.5
    set_counter army7_run 0
    end_if

end_if

if I_CompareCounter army9_reinf_allied = 1

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 1
    and I_UnitEnemyUnitInRadius a9u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army9_moving 0
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 1
    and ! I_UnitEnemyUnitInRadius a9u1 160
    and I_UnitDistanceFromUnit a1u1 a9u1 > 150
    and I_IsUnitIdle a9u1

    set_counter army9_reinf_late 1
    battle_wait 1
    set_counter army9_moving 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_moving = 0
    and ! I_UnitEnemyUnitInRadius a9u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    set_counter army9_run 1
    set_counter army9_moving 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 1000

    set_counter army9_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 750

    set_counter army9_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 500

    set_counter army9_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 300

    set_counter army9_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a9u1 a1u1 < 200

    set_counter army9_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a9u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army9

    set_counter army9_run 1
    battle_wait 0.5
    set_counter army9_moving 1
    set_counter army9_reinf_late 0
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 100

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitKilled a9u1 > 60

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitGroupKilled army9 > 50

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a9u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army9 a1u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a9u1 < 250
    and I_IsUnitIdle a9u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a9u1 < 250
    and I_IsUnitUnderFire a9u1

    set_counter army9_reinf_allied 0
    unit_group_order_halt army9
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army9_reinf_allied = 1
    and I_CompareCounter army9_run = 1

;    unit_group_order_halt army9
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army9 a1u1 run
    battle_wait 0.5
    set_counter army9_run 0
    end_if

end_if

if I_CompareCounter army11_reinf_allied = 1

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 1
    and I_UnitEnemyUnitInRadius a11u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army11_moving 0
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 1
    and ! I_UnitEnemyUnitInRadius a11u1 160
    and I_UnitDistanceFromUnit a1u1 a11u1 > 150
    and I_IsUnitIdle a11u1

    set_counter army11_reinf_late 1
    battle_wait 1
    set_counter army11_moving 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_moving = 0
    and ! I_UnitEnemyUnitInRadius a11u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    set_counter army11_run 1
    set_counter army11_moving 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 1000

    set_counter army11_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 750

    set_counter army11_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 500

    set_counter army11_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 300

    set_counter army11_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a11u1 a1u1 < 200

    set_counter army11_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a11u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army11

    set_counter army11_run 1
    battle_wait 0.5
    set_counter army11_moving 1
    set_counter army11_reinf_late 0
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 100

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitKilled a11u1 > 60

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitGroupKilled army11 > 50

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a11u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army11 a1u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a11u1 < 250
    and I_IsUnitIdle a11u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a11u1 < 250
    and I_IsUnitUnderFire a11u1

    set_counter army11_reinf_allied 0
    unit_group_order_halt army11
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army11_reinf_allied = 1
    and I_CompareCounter army11_run = 1

;    unit_group_order_halt army11
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army11 a1u1 run
    battle_wait 0.5
    set_counter army11_run 0
    end_if

end_if

if I_CompareCounter army13_reinf_allied = 1

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 1
    and I_UnitEnemyUnitInRadius a13u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army13_moving 0
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 1
    and ! I_UnitEnemyUnitInRadius a13u1 160
    and I_UnitDistanceFromUnit a1u1 a13u1 > 150
    and I_IsUnitIdle a13u1

    set_counter army13_reinf_late 1
    battle_wait 1
    set_counter army13_moving 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_moving = 0
    and ! I_UnitEnemyUnitInRadius a13u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    set_counter army13_run 1
    set_counter army13_moving 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 1000

    set_counter army13_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 750

    set_counter army13_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 500

    set_counter army13_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 300

    set_counter army13_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a13u1 a1u1 < 200

    set_counter army13_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a13u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army13

    set_counter army13_run 1
    battle_wait 0.5
    set_counter army13_moving 1
    set_counter army13_reinf_late 0
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 100

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitKilled a13u1 > 60

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitGroupKilled army13 > 50

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a13u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army13 a1u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a13u1 < 250
    and I_IsUnitIdle a13u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a13u1 < 250
    and I_IsUnitUnderFire a13u1

    set_counter army13_reinf_allied 0
    unit_group_order_halt army13
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army13_reinf_allied = 1
    and I_CompareCounter army13_run = 1

;    unit_group_order_halt army13
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army13 a1u1 run
    battle_wait 0.5
    set_counter army13_run 0
    end_if

end_if

if I_CompareCounter army15_reinf_allied = 1

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 1
    and I_UnitEnemyUnitInRadius a15u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army15_moving 0
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 1
    and ! I_UnitEnemyUnitInRadius a15u1 160
    and I_UnitDistanceFromUnit a1u1 a15u1 > 150
    and I_IsUnitIdle a15u1

    set_counter army15_reinf_late 1
    battle_wait 1
    set_counter army15_moving 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_moving = 0
    and ! I_UnitEnemyUnitInRadius a15u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    set_counter army15_run 1
    set_counter army15_moving 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 1000

    set_counter army15_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 750

    set_counter army15_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 500

    set_counter army15_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 300

    set_counter army15_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a15u1 a1u1 < 200

    set_counter army15_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a15u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army1 army15

    set_counter army15_run 1
    battle_wait 0.5
    set_counter army15_moving 1
    set_counter army15_reinf_late 0
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 150
    and I_UnitEnemyUnitInRadius a1u1 100

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 100

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitKilled a15u1 > 60

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a2u1 < 200
    and I_UnitDistanceFromUnit a1u1 a2u1 < 200

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitGroupKilled army15 > 50

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a15u1 a1u1 < 250
    and I_UnitGroupInRangeOfUnit army15 a1u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a15u1 < 250
    and I_IsUnitIdle a15u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_IsUnitRouting a1u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_PercentageUnitKilled a1u1 > 80

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_UnitDistanceFromUnit a1u1 a15u1 < 250
    and I_IsUnitUnderFire a15u1

    set_counter army15_reinf_allied 0
    unit_group_order_halt army15
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army15_reinf_allied = 1
    and I_CompareCounter army15_run = 1

;    unit_group_order_halt army15
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army15 a1u1 run
    battle_wait 0.5
    set_counter army15_run 0
    end_if

end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;; Defending

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_BattlePlayerArmyIsAttacker

;    inc_counter reinf_check_interval 1

if I_CompareCounter army4_reinf_allied = 1

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 1
    and I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army4_moving 0
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and I_UnitDistanceFromUnit a2u1 a4u1 > 150
    and I_IsUnitIdle a4u1

    set_counter army4_reinf_late 1
    battle_wait 1
    set_counter army4_moving 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_moving = 0
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run 1
    set_counter army4_moving 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 1000

    set_counter army4_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 750

    set_counter army4_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 500

    set_counter army4_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300

    set_counter army4_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200

    set_counter army4_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run 1
    battle_wait 0.5
    set_counter army4_moving 1
    set_counter army4_reinf_late 0
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 100

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitKilled a4u1 > 60

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitGroupKilled army4 > 50

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army4 a2u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitIdle a4u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitUnderFire a4u1

    set_counter army4_reinf_allied 0
    unit_group_order_halt army4
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army4_reinf_allied = 1
    and I_CompareCounter army4_run = 1

;    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army4 a2u1 run
    battle_wait 0.5
    set_counter army4_run 0
    end_if

end_if

if I_CompareCounter army6_reinf_allied = 1

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 1
    and I_UnitEnemyUnitInRadius a6u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army6_moving 0
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 1
    and ! I_UnitEnemyUnitInRadius a6u1 160
    and I_UnitDistanceFromUnit a2u1 a6u1 > 150
    and I_IsUnitIdle a6u1

    set_counter army6_reinf_late 1
    battle_wait 1
    set_counter army6_moving 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_moving = 0
    and ! I_UnitEnemyUnitInRadius a6u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    set_counter army6_run 1
    set_counter army6_moving 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 1000

    set_counter army6_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 750

    set_counter army6_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 500

    set_counter army6_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 300

    set_counter army6_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a6u1 a2u1 < 200

    set_counter army6_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a6u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army6

    set_counter army6_run 1
    battle_wait 0.5
    set_counter army6_moving 1
    set_counter army6_reinf_late 0
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 100

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitKilled a6u1 > 60

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitGroupKilled army6 > 50

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a6u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army6 a2u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a6u1 < 250
    and I_IsUnitIdle a6u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a6u1 < 250
    and I_IsUnitUnderFire a6u1

    set_counter army6_reinf_allied 0
    unit_group_order_halt army6
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army6_reinf_allied = 1
    and I_CompareCounter army6_run = 1

;    unit_group_order_halt army6
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army6 a2u1 run
    battle_wait 0.5
    set_counter army6_run 0
    end_if

end_if

if I_CompareCounter army8_reinf_allied = 1

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 1
    and I_UnitEnemyUnitInRadius a8u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army8_moving 0
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 1
    and ! I_UnitEnemyUnitInRadius a8u1 160
    and I_UnitDistanceFromUnit a2u1 a8u1 > 150
    and I_IsUnitIdle a8u1

    set_counter army8_reinf_late 1
    battle_wait 1
    set_counter army8_moving 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_moving = 0
    and ! I_UnitEnemyUnitInRadius a8u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    set_counter army8_run 1
    set_counter army8_moving 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 1000

    set_counter army8_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 750

    set_counter army8_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 500

    set_counter army8_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 300

    set_counter army8_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a8u1 a2u1 < 200

    set_counter army8_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a8u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army8

    set_counter army8_run 1
    battle_wait 0.5
    set_counter army8_moving 1
    set_counter army8_reinf_late 0
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 100

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitKilled a8u1 > 60

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitGroupKilled army8 > 50

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a8u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army8 a2u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a8u1 < 250
    and I_IsUnitIdle a8u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a8u1 < 250
    and I_IsUnitUnderFire a8u1

    set_counter army8_reinf_allied 0
    unit_group_order_halt army8
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army8_reinf_allied = 1
    and I_CompareCounter army8_run = 1

;    unit_group_order_halt army8
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army8 a2u1 run
    battle_wait 0.5
    set_counter army8_run 0
    end_if

end_if

if I_CompareCounter army10_reinf_allied = 1

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 1
    and I_UnitEnemyUnitInRadius a10u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army10_moving 0
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 1
    and ! I_UnitEnemyUnitInRadius a10u1 160
    and I_UnitDistanceFromUnit a2u1 a10u1 > 150
    and I_IsUnitIdle a10u1

    set_counter army10_reinf_late 1
    battle_wait 1
    set_counter army10_moving 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_moving = 0
    and ! I_UnitEnemyUnitInRadius a10u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    set_counter army10_run 1
    set_counter army10_moving 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 1000

    set_counter army10_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 750

    set_counter army10_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 500

    set_counter army10_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 300

    set_counter army10_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a10u1 a2u1 < 200

    set_counter army10_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a10u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army10

    set_counter army10_run 1
    battle_wait 0.5
    set_counter army10_moving 1
    set_counter army10_reinf_late 0
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 100

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitKilled a10u1 > 60

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitGroupKilled army10 > 50

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a10u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army10 a2u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a10u1 < 250
    and I_IsUnitIdle a10u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a10u1 < 250
    and I_IsUnitUnderFire a10u1

    set_counter army10_reinf_allied 0
    unit_group_order_halt army10
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army10_reinf_allied = 1
    and I_CompareCounter army10_run = 1

;    unit_group_order_halt army10
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army10 a2u1 run
    battle_wait 0.5
    set_counter army10_run 0
    end_if

end_if

if I_CompareCounter army12_reinf_allied = 1

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 1
    and I_UnitEnemyUnitInRadius a12u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army12_moving 0
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 1
    and ! I_UnitEnemyUnitInRadius a12u1 160
    and I_UnitDistanceFromUnit a2u1 a12u1 > 150
    and I_IsUnitIdle a12u1

    set_counter army12_reinf_late 1
    battle_wait 1
    set_counter army12_moving 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_moving = 0
    and ! I_UnitEnemyUnitInRadius a12u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    set_counter army12_run 1
    set_counter army12_moving 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 1000

    set_counter army12_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 750

    set_counter army12_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 500

    set_counter army12_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 300

    set_counter army12_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a12u1 a2u1 < 200

    set_counter army12_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a12u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army12

    set_counter army12_run 1
    battle_wait 0.5
    set_counter army12_moving 1
    set_counter army12_reinf_late 0
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 100

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitKilled a12u1 > 60

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitGroupKilled army12 > 50

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a12u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army12 a2u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a12u1 < 250
    and I_IsUnitIdle a12u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a12u1 < 250
    and I_IsUnitUnderFire a12u1

    set_counter army12_reinf_allied 0
    unit_group_order_halt army12
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army12_reinf_allied = 1
    and I_CompareCounter army12_run = 1

;    unit_group_order_halt army12
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army12 a2u1 run
    battle_wait 0.5
    set_counter army12_run 0
    end_if

end_if

if I_CompareCounter army14_reinf_allied = 1

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 1
    and I_UnitEnemyUnitInRadius a14u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army14_moving 0
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 1
    and ! I_UnitEnemyUnitInRadius a14u1 160
    and I_UnitDistanceFromUnit a2u1 a14u1 > 150
    and I_IsUnitIdle a14u1

    set_counter army14_reinf_late 1
    battle_wait 1
    set_counter army14_moving 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_moving = 0
    and ! I_UnitEnemyUnitInRadius a14u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    set_counter army14_run 1
    set_counter army14_moving 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 1000

    set_counter army14_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 750

    set_counter army14_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 500

    set_counter army14_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 300

    set_counter army14_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a14u1 a2u1 < 200

    set_counter army14_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a14u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army14

    set_counter army14_run 1
    battle_wait 0.5
    set_counter army14_moving 1
    set_counter army14_reinf_late 0
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 100

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitKilled a14u1 > 60

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitGroupKilled army14 > 50

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a14u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army14 a2u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a14u1 < 250
    and I_IsUnitIdle a14u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a14u1 < 250
    and I_IsUnitUnderFire a14u1

    set_counter army14_reinf_allied 0
    unit_group_order_halt army14
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army14_reinf_allied = 1
    and I_CompareCounter army14_run = 1

;    unit_group_order_halt army14
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army14 a2u1 run
    battle_wait 0.5
    set_counter army14_run 0
    end_if

end_if

if I_CompareCounter army16_reinf_allied = 1

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 1
    and I_UnitEnemyUnitInRadius a16u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    set_counter army16_moving 0
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 1
    and ! I_UnitEnemyUnitInRadius a16u1 160
    and I_UnitDistanceFromUnit a2u1 a16u1 > 150
    and I_IsUnitIdle a16u1

    set_counter army16_reinf_late 1
    battle_wait 1
    set_counter army16_moving 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_moving = 0
    and ! I_UnitEnemyUnitInRadius a16u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    set_counter army16_run 1
    set_counter army16_moving 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger1 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 1000

    set_counter army16_reinf_late 1
    set_counter distance_trigger1 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger2 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 750

    set_counter army16_reinf_late 1
    set_counter distance_trigger2 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger3 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 500

    set_counter army16_reinf_late 1
    set_counter distance_trigger3 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger4 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 300

    set_counter army16_reinf_late 1
    set_counter distance_trigger4 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter distance_trigger5 = 0
    and I_UnitDistanceFromUnit a16u1 a2u1 < 200

    set_counter army16_reinf_late 1
    set_counter distance_trigger5 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_reinf_late = 1
    and ! I_UnitEnemyUnitInRadius a16u1 160
;    and ! I_UnitGroupInRangeOfUnitGroup army2 army16

    set_counter army16_run 1
    battle_wait 0.5
    set_counter army16_moving 1
    set_counter army16_reinf_late 0
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 150
    and I_UnitEnemyUnitInRadius a2u1 100

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 100

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitKilled a16u1 > 60

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 200
    and I_UnitDistanceFromUnit a2u1 a2u1 < 200

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitGroupKilled army16 > 50

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a16u1 a2u1 < 250
    and I_UnitGroupInRangeOfUnit army16 a2u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a16u1 < 250
    and I_IsUnitIdle a16u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_IsUnitRouting a2u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_PercentageUnitKilled a2u1 > 80

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_UnitDistanceFromUnit a2u1 a16u1 < 250
    and I_IsUnitUnderFire a16u1

    set_counter army16_reinf_allied 0
    unit_group_order_halt army16
    battle_wait 0.5
    set_counter relaunch_movement 1
    end_if

    if I_CompareCounter army16_reinf_allied = 1
    and I_CompareCounter army16_run = 1

;    unit_group_order_halt army16
    battle_wait 0.5
    unit_group_move_to_missile_range_of_unit army16 a2u1 run
    battle_wait 0.5
    set_counter army16_run 0
    end_if

end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;; Defending Siege

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready_siege = 1
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter army4_ready_siege = 1

;    inc_counter reinf_check_interval 1

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 1
    and I_UnitEnemyUnitInRadius a4u1 160

    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    set_counter army4_moving_siege 0
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 1
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and I_UnitDistanceFromUnit a2u1 a4u1 > 150
    and I_IsUnitIdle a4u1

    set_counter army4_run_siege 1
    battle_wait 2
    set_counter army4_moving_siege 1
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_moving_siege = 0
    and ! I_UnitEnemyUnitInRadius a4u1 160
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    set_counter army4_run_siege 1
    set_counter army4_moving_siege 1
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a4u1 a2u1 < 200

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromPosition a4u1 1 1 < 150

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitIdle a4u1

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_UnitDistanceFromUnit a2u1 a4u1 < 250
    and I_IsUnitUnderFire a4u1

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_PercentageUnitGroupKilled army4 > 50

    set_counter army4_ready_siege 0
    unit_group_order_halt army4
    battle_wait 0.5
    ai_active_set on
    end_if

    if I_CompareCounter army4_ready_siege = 1
    and I_CompareCounter army4_run_siege = 1

    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_order_move_formed army4 1 1 run
    set_counter army4_run_siege 0
    end_if

;    if I_CompareCounter reinf_check_interval = 2
;    set_counter reinf_check_interval 0
;    end_if
    battle_wait 5
end_monitor

;;;;;;;;;;;Sally-out, AI defending

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 1

    if I_UnitDistanceFromPosition a4u1 0 850 < 200
    set_counter army4_location 1 ;north
    end_if
    if I_UnitDistanceFromPosition a4u1 0 -850 < 200
    set_counter army4_location 2 ;south
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 0 < 200
    set_counter army4_location 3 ;west
    end_if
    if I_UnitDistanceFromPosition a4u1 850 0 < 200
    set_counter army4_location 4 ;east
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 850 < 200
    set_counter army4_location 5 ;nw
    end_if
    if I_UnitDistanceFromPosition a4u1 850 850 < 200
    set_counter army4_location 6 ;ne
    end_if
    if I_UnitDistanceFromPosition a4u1 -850 850 < 200
    set_counter army4_location 7 ;sw
    end_if
    if I_UnitDistanceFromPosition a4u1 850 -850 < 200
    set_counter army4_location 8 ;se
    end_if

    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    set_counter	path_s 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    set_counter	path_sw 4
    set_counter	path_s 5
    end_if
    end_if
    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_ne 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    set_counter	path_n 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    set_counter	path_nw 4
    set_counter	path_n 5
    end_if
    end_if

    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_se 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    set_counter	path_e 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    set_counter	path_ne 4
    set_counter	path_e 5
    end_if
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_sw 2
    set_counter	path_s 3
    end_if
    end_if

    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    set_counter	path_w 3
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    set_counter	path_sw 4
    set_counter	path_w 5
    end_if
    end_if
    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_ne 2
    set_counter	path_n 3
    end_if
    end_if

    if I_CompareCounter army4_location = 5 ;nw
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    end_if
    end_if

    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    end_if
    end_if
    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_sw 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 5
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_ne 2
    set_counter	path_e 3
    end_if
    end_if

    if I_CompareCounter army4_location = 6 ;ne
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    set_counter	path_nw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_n 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_n 1
    end_if
    end_if

    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    end_if
    end_if
    if I_CompareCounter army4_location = 6
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_s 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_se 2
    set_counter	path_s 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7 ;sw
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    set_counter	path_nw 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_e 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_se 2
    set_counter	path_e 3
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    end_if
    end_if
    if I_CompareCounter army4_location = 7
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_w 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_w 1
    end_if
    end_if

    if I_CompareCounter army4_location = 8 ;se
    and I_CompareCounter army_south = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_west = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_s 1
    set_counter	path_w 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_s 1
    set_counter	path_sw 2
    set_counter	path_w 3
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_north = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    set_counter	path_n 2
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    set_counter	path_ne 2
    set_counter	path_n 3
    end_if
    end_if
    if I_CompareCounter army4_location = 8
    and I_CompareCounter army_east = 1
    if I_BattleSettlementFortificationLevel < 2
    set_counter	path_e 1
    end_if
    if I_BattleSettlementFortificationLevel > 1
    set_counter	path_e 1
    end_if
    end_if

    if I_CompareCounter army4_location = 1
    and I_CompareCounter army_north = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_location = 2
    and I_CompareCounter army_south = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_location = 3
    and I_CompareCounter army_west = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if

    if I_CompareCounter army4_location = 4
    and I_CompareCounter army_east = 1
    set_counter	army4_ready_sally 3
    set_counter	army4_ready 0
    end_if
    if I_CompareCounter army4_ready_sally = 1
    unit_group_order_halt army4
    battle_wait 0.5
    unit_group_order_change_group_formation army4 ai_infantry_protecting
;	battle_wait 45
    battle_wait 20
    if I_CompareCounter army4_ready_sally = 1
    and I_BattleIsSallyOutBattle
    battle_wait 25
    end_if
    if I_CompareCounter army4_ready_sally = 1
    and I_BattleIsSallyOutBattle
    set_counter army4_ready_sally 2
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter label_army4 = 1

    label_unit 1 1 0 a4u1
    label_unit 1 1 1 a4u2
    label_unit 1 1 2 a4u3
    label_unit 1 1 3 a4u4
    label_unit 1 1 4 a4u5
    label_unit 1 1 5 a4u6
    label_unit 1 1 6 a4u7
    label_unit 1 1 7 a4u8
    label_unit 1 1 8 a4u9
    label_unit 1 1 9 a4u10
    label_unit 1 1 10 a4u11
    label_unit 1 1 11 a4u12
    label_unit 1 1 12 a4u13
    label_unit 1 1 13 a4u14
    label_unit 1 1 14 a4u15
    label_unit 1 1 15 a4u16
    label_unit 1 1 16 a4u17
    label_unit 1 1 17 a4u18
    label_unit 1 1 18 a4u19
    label_unit 1 1 19 a4u20

;    unit_group_order_halt army4
    set_counter label_army4 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter army4_moving_s = 1
    and I_UnitEnemyUnitInRadius a4u1 130
    and ! I_UnitGroupInRangeOfUnitGroup army2 army4

    unit_group_order_halt army4
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on

    set_counter army4_moving_s 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_n = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 0 700 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 500 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 500 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 700 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 700 < 100
    set_counter path_n 0
    if I_CompareCounter path_nw > 1
    set_counter path_nw 1
    end_if
    if I_CompareCounter path_ne > 1
    set_counter path_ne 1
    end_if
    if I_CompareCounter path_nw = 0
    and I_CompareCounter path_ne = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 500 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 500 < 100
    set_counter path_n 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 30
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_s = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 0 -700 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -500 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 0 -500 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -700 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 -700 < 100
    set_counter path_s 0
    if I_CompareCounter path_sw > 1
    set_counter path_sw 1
    end_if
    if I_CompareCounter path_se > 1
    set_counter path_se 1
    end_if
    if I_CompareCounter path_sw = 0
    and I_CompareCounter path_se = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 0 -500 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 0 -500 < 100
    set_counter path_s 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_w = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 0 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -500 0 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -500 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 0 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 0 < 100
    set_counter path_w 0
    if I_CompareCounter path_nw > 1
    set_counter path_nw 1
    end_if
    if I_CompareCounter path_sw > 1
    set_counter path_sw 1
    end_if
    if I_CompareCounter path_nw = 0
    and I_CompareCounter path_sw = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 -500 0 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -500 0 < 100
    set_counter path_w 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_e = 1
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 0 > 100
    and I_BattleSettlementFortificationLevel > 2
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 500 0 > 100
    and I_BattleSettlementFortificationLevel < 3
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 500 0 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 0 < 100
    and I_BattleSettlementFortificationLevel > 2
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 0 < 100
    set_counter path_e 0
    if I_CompareCounter path_ne > 1
    set_counter path_ne 1
    end_if
    if I_CompareCounter path_se > 1
    set_counter path_se 1
    end_if
    if I_CompareCounter path_ne = 0
    and I_CompareCounter path_se = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    if I_UnitGroupDistanceFromPosition army4 500 0 < 100
    and I_BattleSettlementFortificationLevel < 3
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 500 0 < 100
    set_counter path_e 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_nw = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 700 < 100
    set_counter path_nw 0
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_n = 0
    and I_CompareCounter path_w = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_ne = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 700 < 100
    set_counter path_ne 0
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_n > 1
    set_counter path_n 1
    end_if
    if I_CompareCounter path_e = 0
    and I_CompareCounter path_n = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_sw = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 -700 -700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 -700 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 -700 -700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 -700 -700 < 100
    set_counter path_sw 0
    if I_CompareCounter path_w > 1
    set_counter path_w 1
    end_if
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_w = 0
    and I_CompareCounter path_s = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter path_se = 1
    and I_BattleSettlementFortificationLevel > 2
    and ! I_UnitEnemyUnitInRadius a4u1 130

    if I_UnitGroupDistanceFromPosition army4 700 -700 > 100
    set_counter label_army4 1
    battle_wait 0.5
    unit_group_order_move_formed army4 700 -700 run
    set_counter army4_moving_s 1
    end_if

    if I_UnitGroupDistanceFromPosition army4 700 -700 < 100
    unit_group_order_halt army4
    battle_wait 0.5
    if I_UnitGroupDistanceFromPosition army4 700 -700 < 100
    set_counter path_se 0
    if I_CompareCounter path_s > 1
    set_counter path_s 1
    end_if
    if I_CompareCounter path_e > 1
    set_counter path_e 1
    end_if
    if I_CompareCounter path_s = 0
    and I_CompareCounter path_e = 0
    set_counter army4_ready_sally 3
    set_counter army4_ready 0
    end_if
    end_if
    end_if

    battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 3

    set_counter army4_ready_sally 0
    unit_group_order_halt army4
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_IsUnitRouting a4u1

    set_counter army4_ready_sally 3
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and I_PercentageUnitKilled a4u1 > 80

    set_counter army4_ready_sally 3
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2

    if I_IsUnitGroupIdle army4
    inc_counter army4_idle_r 1
    end_if

    if ! I_IsUnitGroupIdle army4
    set_counter army4_idle_r 0
    end_if

    if I_CompareCounter army4_idle_r > 12
    set_counter army4_ready_sally 0
    end_if
    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_n = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_n = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_n 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_s = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_s = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_s 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_w = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_w = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_w 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_e = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_e = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_e 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_nw = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_nw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_nw 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_ne = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_ne = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_ne 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_sw = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_sw = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_sw 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter army4_ready_sally = 2
    and ! I_UnitEnemyUnitInRadius a4u1 130
    and I_CompareCounter path_se = 1

    set_counter check_timer 1
;	battle_wait 600
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 1
    set_counter check_timer 2
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 2
    set_counter check_timer 3
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 3
    set_counter check_timer 4
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 4
    set_counter check_timer 5
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 5
    set_counter check_timer 6
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 6
    set_counter check_timer 7
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 7
    set_counter check_timer 8
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 8
    set_counter check_timer 9
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 9
    set_counter check_timer 10
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 10
    set_counter check_timer 11
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 11
    set_counter check_timer 12
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 12
    set_counter check_timer 13
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 13
    set_counter check_timer 14
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 14
    set_counter check_timer 15
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 15
    set_counter check_timer 16
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 16
    set_counter check_timer 17
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 17
    set_counter check_timer 18
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 18
    set_counter check_timer 19
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 19
    set_counter check_timer 20
    battle_wait 30
    if I_CompareCounter path_se = 1
    and I_CompareCounter army4_ready_sally = 2
    and I_CompareCounter check_timer = 20
    set_counter path_se 0
    set_counter sally_reinf 0
    set_counter army4_ready_sally 0
    set_counter label_army4 1
;    battle_wait 0.5
 ;   ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

;################## Germanicu5 Integrated Stakes script ###########################

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAttacking
    and ! I_ConflictType SuccessfulAmbush
    and ! I_BattleIsSiegeBattle
    and ! I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel < 3
    and I_IsBattleSettlementCastle
    and I_BattlePlayerAllianceOddsAgainst < 2.0
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel > 2
    and I_IsBattleSettlementCastle
    and I_BattlePlayerAllianceOddsAgainst < 2.5
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 4
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel < 3
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerAllianceOddsAgainst < 1.7
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
    and I_BattleIsSallyOutBattle
    and I_BattleSettlementFortificationLevel > 2
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines < 3
    and I_BattlePlayerAllianceOddsAgainst < 2.2
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_UnitEnemyUnitInRadius a2u1 150

    set_counter stakes_on 1
    set_counter label_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter stakes_on = 1
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    and I_UnitEnemyUnitInRadius a2u1 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    and I_UnitEnemyUnitInRadius a2u2 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    and I_UnitEnemyUnitInRadius a2u3 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    and I_UnitEnemyUnitInRadius a2u4 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    and I_UnitEnemyUnitInRadius a2u5 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    and I_UnitEnemyUnitInRadius a2u6 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    and I_UnitEnemyUnitInRadius a2u7 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    and I_UnitEnemyUnitInRadius a2u8 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    and I_UnitEnemyUnitInRadius a2u9 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    and I_UnitEnemyUnitInRadius a2u10 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    and I_UnitEnemyUnitInRadius a2u11 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    and I_UnitEnemyUnitInRadius a2u12 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    and I_UnitEnemyUnitInRadius a2u13 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    and I_UnitEnemyUnitInRadius a2u14 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    and I_UnitEnemyUnitInRadius a2u15 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    and I_UnitEnemyUnitInRadius a2u16 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    and I_UnitEnemyUnitInRadius a2u17 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    and I_UnitEnemyUnitInRadius a2u18 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    and I_UnitEnemyUnitInRadius a2u19 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    and I_UnitEnemyUnitInRadius a2u20 60
    and I_CompareCounter stakes_on != 2
    set_counter stakes_on 2
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

if I_CompareCounter stakes_on = 2
;    ai_active_set off
    unit_group_order_halt army2

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    unit_deploy_stakes a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    unit_deploy_stakes a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    unit_deploy_stakes a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    unit_deploy_stakes a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    unit_deploy_stakes a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    unit_deploy_stakes a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    unit_deploy_stakes a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    unit_deploy_stakes a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    unit_deploy_stakes a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    unit_deploy_stakes a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    unit_deploy_stakes a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    unit_deploy_stakes a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    unit_deploy_stakes a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    unit_deploy_stakes a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    unit_deploy_stakes a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    unit_deploy_stakes a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    unit_deploy_stakes a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    unit_deploy_stakes a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    unit_deploy_stakes a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    unit_deploy_stakes a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter stakes_on 0
end_if
    battle_wait 1.5
end_monitor

monitor_event BattleDeploymentPhaseCommenced FactionIsLocal
    and I_BattlePlayerArmyIsAttacker
    and I_BattleIsSiegeBattle
    and I_CompareCounter panel_check = 1
    and I_CompareCounter label_ready = 1
    and I_BattlePlayerArmyNumberOfUnitCategory cavalry > 0
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry = 0
    and I_BattleEnemyArmyNumberOfAttribute stakes > 0

    if I_CompareCounter enemy_unit_count > 0
    unit_deploy_stakes a2u1

    if I_CompareCounter enemy_unit_count > 1
    unit_deploy_stakes a2u2

    if I_CompareCounter enemy_unit_count > 2
    unit_deploy_stakes a2u3

    if I_CompareCounter enemy_unit_count > 3
    unit_deploy_stakes a2u4

    if I_CompareCounter enemy_unit_count > 4
    unit_deploy_stakes a2u5

    if I_CompareCounter enemy_unit_count > 5
    unit_deploy_stakes a2u6

    if I_CompareCounter enemy_unit_count > 6
    unit_deploy_stakes a2u7

    if I_CompareCounter enemy_unit_count > 7
    unit_deploy_stakes a2u8

    if I_CompareCounter enemy_unit_count > 8
    unit_deploy_stakes a2u9

    if I_CompareCounter enemy_unit_count > 9
    unit_deploy_stakes a2u10

    if I_CompareCounter enemy_unit_count > 10
    unit_deploy_stakes a2u11

    if I_CompareCounter enemy_unit_count > 11
    unit_deploy_stakes a2u12

    if I_CompareCounter enemy_unit_count > 12
    unit_deploy_stakes a2u13

    if I_CompareCounter enemy_unit_count > 13
    unit_deploy_stakes a2u14

    if I_CompareCounter enemy_unit_count > 14
    unit_deploy_stakes a2u15

    if I_CompareCounter enemy_unit_count > 15
    unit_deploy_stakes a2u16

    if I_CompareCounter enemy_unit_count > 16
    unit_deploy_stakes a2u17

    if I_CompareCounter enemy_unit_count > 17
    unit_deploy_stakes a2u18

    if I_CompareCounter enemy_unit_count > 18
    unit_deploy_stakes a2u19

    if I_CompareCounter enemy_unit_count = 20
    unit_deploy_stakes a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter label_ready 0
end_monitor

;;;;;;;;HA fix;;;;;;;;;;;;

;monitor_conditions I_BattleStarted
;    and I_CompareCounter ha_fix = 1
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    and ! I_BattleAiAttacking
;    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
;    and I_UnitEnemyUnitInRadius a2u1 250
;    ai_gta_plan_set 1 ATTACK_ALL
;    set_counter ha_fix 0
;    set_counter ob_defense_launch 0
;    set_counter ob_defend 4
;end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ha_fix = 1
    and I_CompareCounter open_battle = 1
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAttacking
;	and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60

    ai_gta_plan_set 0 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ha_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ha_fix = 1
    and I_BattleIsRiverBattle
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_BattleAiAssaultingCrossing
;	and I_BattleEnemyArmyPercentageOfUnitCategory cavalry >= 60

    ai_gta_add_objective 0 ASSAULT_CROSSING 999

;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    ai_gta_add_unit_label 0 0 a1u1

    if I_CompareCounter enemy_unit_count > 1
    ai_gta_add_unit_label 0 0 a1u2

    if I_CompareCounter enemy_unit_count > 2
    ai_gta_add_unit_label 0 0 a1u3

    if I_CompareCounter enemy_unit_count > 3
    ai_gta_add_unit_label 0 0 a1u4

    if I_CompareCounter enemy_unit_count > 4
    ai_gta_add_unit_label 0 0 a1u5

    if I_CompareCounter enemy_unit_count > 5
    ai_gta_add_unit_label 0 0 a1u6

    if I_CompareCounter enemy_unit_count > 6
    ai_gta_add_unit_label 0 0 a1u7

    if I_CompareCounter enemy_unit_count > 7
    ai_gta_add_unit_label 0 0 a1u8

    if I_CompareCounter enemy_unit_count > 8
    ai_gta_add_unit_label 0 0 a1u9

    if I_CompareCounter enemy_unit_count > 9
    ai_gta_add_unit_label 0 0 a1u10

    if I_CompareCounter enemy_unit_count > 10
    ai_gta_add_unit_label 0 0 a1u11

    if I_CompareCounter enemy_unit_count > 11
    ai_gta_add_unit_label 0 0 a1u12

    if I_CompareCounter enemy_unit_count > 12
    ai_gta_add_unit_label 0 0 a1u13

    if I_CompareCounter enemy_unit_count > 13
    ai_gta_add_unit_label 0 0 a1u14

    if I_CompareCounter enemy_unit_count > 14
    ai_gta_add_unit_label 0 0 a1u15

    if I_CompareCounter enemy_unit_count > 15
    ai_gta_add_unit_label 0 0 a1u16

    if I_CompareCounter enemy_unit_count > 16
    ai_gta_add_unit_label 0 0 a1u17

    if I_CompareCounter enemy_unit_count > 17
    ai_gta_add_unit_label 0 0 a1u18

    if I_CompareCounter enemy_unit_count > 18
    ai_gta_add_unit_label 0 0 a1u19

    if I_CompareCounter enemy_unit_count = 20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    battle_wait 0.5
    ai_active_set on

    set_counter ha_fix 0
end_monitor

;;;;;;;;Elephant;;;;;;;;;;;;

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and ! I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and ! I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off
    unit_group_order_halt army1

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    unit_group_order_halt army1
    battle_wait 0.5
    unit_group_order_change_group_formation army1 ai_wall_assault
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSiegeBattle
    and I_BattleIsFortBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999
;    ai_active_set off

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 1
    set_counter elephant_fix 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 1
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate != 2
    set_counter elephant_gate 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier2 1
    set_counter rally_walls 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 1
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate != 2
    set_counter elephant_gate 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 3
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier2 1
    set_counter rally_walls 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter del_objective = 1
    and I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    set_counter del_objective 2
    battle_wait 15
    if I_CompareCounter del_objective = 2
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter del_objective 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier2 = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSiegeBattle
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
    ai_active_set on
    set_counter second_ring 1
    set_counter elephant_gate_tier2 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 2
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring != 2
    set_counter second_ring 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier3 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls = 2
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring != 2
    set_counter second_ring 0
    set_counter del_objective 1
    end_if
    set_counter elephant_fix_check 1
    set_counter rally_walls 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 1
    set_counter elephant_fix_check 2
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 2
    set_counter elephant_fix_check 3
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 3
    set_counter elephant_fix_check 4
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 4
    set_counter elephant_fix_check 5
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 5
    set_counter elephant_fix_check 6
    battle_wait 30
    if I_CompareCounter rally_walls = 4
    and I_CompareCounter elephant_fix_check = 6
    set_counter elephant_gate_tier3 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier3 = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2

    ai_gta_add_objective 0 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a1u1 = horde
    and ! I_UnitStatus a1u1 running_amok
    and ! I_UnitDestroyed a1u1
    and ! I_UnitStatus a1u1 left_battle
    and ! I_IsUnitRouting a1u1
    ai_gta_add_unit_label 0 0 a1u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a1u2 = horde
    and ! I_UnitStatus a1u2 running_amok
    and ! I_UnitDestroyed a1u2
    and ! I_UnitStatus a1u2 left_battle
    and ! I_IsUnitRouting a1u2
    ai_gta_add_unit_label 0 0 a1u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a1u3 = horde
    and ! I_UnitStatus a1u3 running_amok
    and ! I_UnitDestroyed a1u3
    and ! I_UnitStatus a1u3 left_battle
    and ! I_IsUnitRouting a1u3
    ai_gta_add_unit_label 0 0 a1u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a1u4 = horde
    and ! I_UnitStatus a1u4 running_amok
    and ! I_UnitDestroyed a1u4
    and ! I_UnitStatus a1u4 left_battle
    and ! I_IsUnitRouting a1u4
    ai_gta_add_unit_label 0 0 a1u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a1u5 = horde
    and ! I_UnitStatus a1u5 running_amok
    and ! I_UnitDestroyed a1u5
    and ! I_UnitStatus a1u5 left_battle
    and ! I_IsUnitRouting a1u5
    ai_gta_add_unit_label 0 0 a1u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a1u6 = horde
    and ! I_UnitStatus a1u6 running_amok
    and ! I_UnitDestroyed a1u6
    and ! I_UnitStatus a1u6 left_battle
    and ! I_IsUnitRouting a1u6
    ai_gta_add_unit_label 0 0 a1u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a1u7 = horde
    and ! I_UnitStatus a1u7 running_amok
    and ! I_UnitDestroyed a1u7
    and ! I_UnitStatus a1u7 left_battle
    and ! I_IsUnitRouting a1u7
    ai_gta_add_unit_label 0 0 a1u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a1u8 = horde
    and ! I_UnitStatus a1u8 running_amok
    and ! I_UnitDestroyed a1u8
    and ! I_UnitStatus a1u8 left_battle
    and ! I_IsUnitRouting a1u8
    ai_gta_add_unit_label 0 0 a1u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a1u9 = horde
    and ! I_UnitStatus a1u9 running_amok
    and ! I_UnitDestroyed a1u9
    and ! I_UnitStatus a1u9 left_battle
    and ! I_IsUnitRouting a1u9
    ai_gta_add_unit_label 0 0 a1u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a1u10 = horde
    and ! I_UnitStatus a1u10 running_amok
    and ! I_UnitDestroyed a1u10
    and ! I_UnitStatus a1u10 left_battle
    and ! I_IsUnitRouting a1u10
    ai_gta_add_unit_label 0 0 a1u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a1u11 = horde
    and ! I_UnitStatus a1u11 running_amok
    and ! I_UnitDestroyed a1u11
    and ! I_UnitStatus a1u11 left_battle
    and ! I_IsUnitRouting a1u11
    ai_gta_add_unit_label 0 0 a1u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a1u12 = horde
    and ! I_UnitStatus a1u12 running_amok
    and ! I_UnitDestroyed a1u12
    and ! I_UnitStatus a1u12 left_battle
    and ! I_IsUnitRouting a1u12
    ai_gta_add_unit_label 0 0 a1u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a1u13 = horde
    and ! I_UnitStatus a1u13 running_amok
    and ! I_UnitDestroyed a1u13
    and ! I_UnitStatus a1u13 left_battle
    and ! I_IsUnitRouting a1u13
    ai_gta_add_unit_label 0 0 a1u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a1u14 = horde
    and ! I_UnitStatus a1u14 running_amok
    and ! I_UnitDestroyed a1u14
    and ! I_UnitStatus a1u14 left_battle
    and ! I_IsUnitRouting a1u14
    ai_gta_add_unit_label 0 0 a1u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a1u15 = horde
    and ! I_UnitStatus a1u15 running_amok
    and ! I_UnitDestroyed a1u15
    and ! I_UnitStatus a1u15 left_battle
    and ! I_IsUnitRouting a1u15
    ai_gta_add_unit_label 0 0 a1u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a1u16 = horde
    and ! I_UnitStatus a1u16 running_amok
    and ! I_UnitDestroyed a1u16
    and ! I_UnitStatus a1u16 left_battle
    and ! I_IsUnitRouting a1u16
    ai_gta_add_unit_label 0 0 a1u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a1u17 = horde
    and ! I_UnitStatus a1u17 running_amok
    and ! I_UnitDestroyed a1u17
    and ! I_UnitStatus a1u17 left_battle
    and ! I_IsUnitRouting a1u17
    ai_gta_add_unit_label 0 0 a1u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a1u18 = horde
    and ! I_UnitStatus a1u18 running_amok
    and ! I_UnitDestroyed a1u18
    and ! I_UnitStatus a1u18 left_battle
    and ! I_IsUnitRouting a1u18
    ai_gta_add_unit_label 0 0 a1u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a1u19 = horde
    and ! I_UnitStatus a1u19 running_amok
    and ! I_UnitDestroyed a1u19
    and ! I_UnitStatus a1u19 left_battle
    and ! I_IsUnitRouting a1u19
    ai_gta_add_unit_label 0 0 a1u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a1u20 = horde
    and ! I_UnitStatus a1u20 running_amok
    and ! I_UnitDestroyed a1u20
    and ! I_UnitStatus a1u20 left_battle
    and ! I_IsUnitRouting a1u20
    ai_gta_add_unit_label 0 0 a1u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter third_ring 1
    set_counter elephant_gate_tier3 0
end_monitor

;;;;;;;;Sally-Out Elephant;;;;;;;;;;;;

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

;	set_counter sally-out_fix 1
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter elephant_gate_s 1
    set_counter elephant_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_fix = 1
    and I_BattleIsSallyOutBattle
    and I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

;	set_counter sally-out_fix 1
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter elephant_gate_s 1
    set_counter elephant_fix 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 1
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate_s != 2
    set_counter elephant_gate_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier2s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 1
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter elephant_gate_s != 2
    set_counter elephant_gate_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 3
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 3
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier2s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter del_objective_s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    set_counter del_objective_s 2
    battle_wait 15
    if I_CompareCounter del_objective_s = 2
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter del_objective_s 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier2s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter second_ring_s 1
    set_counter elephant_gate_tier2s 0
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 2
    and BattleIsMeleeAttack
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring_s != 2
    set_counter second_ring_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier3s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter rally_walls_s = 2
    and ! BattlePlayerUnitOnWalls
    and ! BattleEnemyUnitOnWalls

    if I_CompareCounter second_ring_s != 2
    set_counter second_ring_s 0
    set_counter del_objective_s 1
    end_if
    set_counter elephant_fix_check_sally 1
    set_counter rally_walls_s 4
;	battle_wait 180
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 1
    set_counter elephant_fix_check_sally 2
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 2
    set_counter elephant_fix_check_sally 3
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 3
    set_counter elephant_fix_check_sally 4
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 4
    set_counter elephant_fix_check_sally 5
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 5
    set_counter elephant_fix_check_sally 6
    battle_wait 30
    if I_CompareCounter rally_walls_s = 4
    and I_CompareCounter elephant_fix_check_sally = 6
    set_counter elephant_gate_tier3s 1
    set_counter rally_walls_s 0
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter elephant_gate_tier3s = 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitFormation a2u1 = horde
    and ! I_UnitStatus a2u1 running_amok
    and ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    and ! I_IsUnitRouting a2u1
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitFormation a2u2 = horde
    and ! I_UnitStatus a2u2 running_amok
    and ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    and ! I_IsUnitRouting a2u2
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitFormation a2u3 = horde
    and ! I_UnitStatus a2u3 running_amok
    and ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    and ! I_IsUnitRouting a2u3
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitFormation a2u4 = horde
    and ! I_UnitStatus a2u4 running_amok
    and ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    and ! I_IsUnitRouting a2u4
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitFormation a2u5 = horde
    and ! I_UnitStatus a2u5 running_amok
    and ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    and ! I_IsUnitRouting a2u5
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitFormation a2u6 = horde
    and ! I_UnitStatus a2u6 running_amok
    and ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    and ! I_IsUnitRouting a2u6
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitFormation a2u7 = horde
    and ! I_UnitStatus a2u7 running_amok
    and ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    and ! I_IsUnitRouting a2u7
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitFormation a2u8 = horde
    and ! I_UnitStatus a2u8 running_amok
    and ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    and ! I_IsUnitRouting a2u8
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitFormation a2u9 = horde
    and ! I_UnitStatus a2u9 running_amok
    and ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    and ! I_IsUnitRouting a2u9
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitFormation a2u10 = horde
    and ! I_UnitStatus a2u10 running_amok
    and ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    and ! I_IsUnitRouting a2u10
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitFormation a2u11 = horde
    and ! I_UnitStatus a2u11 running_amok
    and ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    and ! I_IsUnitRouting a2u11
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitFormation a2u12 = horde
    and ! I_UnitStatus a2u12 running_amok
    and ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    and ! I_IsUnitRouting a2u12
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitFormation a2u13 = horde
    and ! I_UnitStatus a2u13 running_amok
    and ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    and ! I_IsUnitRouting a2u13
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitFormation a2u14 = horde
    and ! I_UnitStatus a2u14 running_amok
    and ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    and ! I_IsUnitRouting a2u14
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitFormation a2u15 = horde
    and ! I_UnitStatus a2u15 running_amok
    and ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    and ! I_IsUnitRouting a2u15
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitFormation a2u16 = horde
    and ! I_UnitStatus a2u16 running_amok
    and ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    and ! I_IsUnitRouting a2u16
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitFormation a2u17 = horde
    and ! I_UnitStatus a2u17 running_amok
    and ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    and ! I_IsUnitRouting a2u17
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitFormation a2u18 = horde
    and ! I_UnitStatus a2u18 running_amok
    and ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    and ! I_IsUnitRouting a2u18
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitFormation a2u19 = horde
    and ! I_UnitStatus a2u19 running_amok
    and ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    and ! I_IsUnitRouting a2u19
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitFormation a2u20 = horde
    and ! I_UnitStatus a2u20 running_amok
    and ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    and ! I_IsUnitRouting a2u20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    ai_active_set on
    set_counter third_ring_s 1
    set_counter elephant_gate_tier3s 0
end_monitor

;;;;;;;Elephants Gate and Walls
monitor_event BattleBattleGatesDestroyedByEngine TrueCondition ;wtf
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    set_counter elephant_gate 0
    set_counter rally_walls 1
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring 0
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    set_counter elephant_gate_s 0
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring_s 0
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

monitor_event BattleWallsCaptured TrueCondition
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    set_counter elephant_gate 0
    set_counter rally_walls 1
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring 0
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    set_counter elephant_gate_s 0
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter second_ring_s 0
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

monitor_event BattleWallsBreachedByEngine TrueCondition
    and I_CompareCounter panel_check = 1

if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate = 1
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate 2
    set_counter rally_walls 0
    end_if

    if I_CompareCounter second_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 0
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter second_ring 2
    set_counter rally_walls 2
    end_if

    if I_CompareCounter third_ring = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring 0
    set_counter del_objective 1
    end_if

end_if
if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfMountClass elephant > 0

    if I_CompareCounter elephant_gate_s = 1
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter elephant_gate_s 2
    set_counter rally_walls_s 1
    end_if

    if I_CompareCounter second_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter second_ring_s 2
    set_counter rally_walls_s 2
    end_if

    if I_CompareCounter third_ring_s = 1
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel > 2
    set_counter third_ring_s 0
    set_counter del_objective_s 1
    end_if

end_if
end_monitor

;;;;;;;Sally Out Assault
monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel < 3
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 2.0

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel > 2
    and I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 3
    and I_BattlePlayerAllianceOddsAgainst > 2.5

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel < 3
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 1.7

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleSettlementFortificationLevel > 2
    and ! I_IsBattleSettlementCastle
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 2.2

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally-out_fix = 1
    and I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_BattleEnemyArmyNumberOfSpecialAbility drop_engines > 2
    and I_BattlePlayerAllianceOddsAgainst > 1.8

    set_counter kill_sally 1
    ai_gta_plan_set 1 ATTACK_SETTLEMENT
    ai_active_set on
    if I_BattleEnemyArmyNumberOfMountClass elephant > 0
    set_counter elephant_fix 1
    battle_wait 1
    end_if
    set_counter army2_sally 1
    if I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
    set_counter sally-out_fix 0
end_monitor

;;;;;;;Sally Out Defense

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 1
    and I_CompareCounter kill_sally = 0
;	and ! I_BattleIsFortBattle
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if

    if I_CompareCounter enemy_unit_count > 0
    ai_gta_add_unit_label 1 0 a2u1

    if I_CompareCounter enemy_unit_count > 1
    ai_gta_add_unit_label 1 0 a2u2

    if I_CompareCounter enemy_unit_count > 2
    ai_gta_add_unit_label 1 0 a2u3

    if I_CompareCounter enemy_unit_count > 3
    ai_gta_add_unit_label 1 0 a2u4

    if I_CompareCounter enemy_unit_count > 4
    ai_gta_add_unit_label 1 0 a2u5

    if I_CompareCounter enemy_unit_count > 5
    ai_gta_add_unit_label 1 0 a2u6

    if I_CompareCounter enemy_unit_count > 6
    ai_gta_add_unit_label 1 0 a2u7

    if I_CompareCounter enemy_unit_count > 7
    ai_gta_add_unit_label 1 0 a2u8

    if I_CompareCounter enemy_unit_count > 8
    ai_gta_add_unit_label 1 0 a2u9

    if I_CompareCounter enemy_unit_count > 9
    ai_gta_add_unit_label 1 0 a2u10

    if I_CompareCounter enemy_unit_count > 10
    ai_gta_add_unit_label 1 0 a2u11

    if I_CompareCounter enemy_unit_count > 11
    ai_gta_add_unit_label 1 0 a2u12

    if I_CompareCounter enemy_unit_count > 12
    ai_gta_add_unit_label 1 0 a2u13

    if I_CompareCounter enemy_unit_count > 13
    ai_gta_add_unit_label 1 0 a2u14

    if I_CompareCounter enemy_unit_count > 14
    ai_gta_add_unit_label 1 0 a2u15

    if I_CompareCounter enemy_unit_count > 15
    ai_gta_add_unit_label 1 0 a2u16

    if I_CompareCounter enemy_unit_count > 16
    ai_gta_add_unit_label 1 0 a2u17

    if I_CompareCounter enemy_unit_count > 17
    ai_gta_add_unit_label 1 0 a2u18

    if I_CompareCounter enemy_unit_count > 18
    ai_gta_add_unit_label 1 0 a2u19

    if I_CompareCounter enemy_unit_count = 20
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    set_counter sally_defense 2
    set_counter defend_location 1
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 2
;	and I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
    and I_UnitDistanceFromPosition a2u1 1 1 > 630
    and ! I_UnitEnemyUnitInRadius a2u1 160
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_IsUnitUnderFire a4u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter unit_under_fire 0
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_if

    if I_CompareCounter sally_defense = 0
    set_counter sally_defense 2
    end_if
    set_counter reform_back 0
    battle_wait 7
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 2
;	and I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
    and I_UnitDistanceFromPosition a2u1 1 1 > 560
    and I_UnitDistanceFromPosition a2u1 1 1 < 630
    and ! I_UnitEnemyUnitInRadius a2u1 160
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter unit_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_IsUnitUnderFire a4u1
    inc_counter unit_under_fire 2
    end_if
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

if I_CompareCounter repeat_test1 = 1
set_counter repeat_test1 2
end_if
if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1
and I_CompareCounter repeat_test1 = 0

set_counter unit_under_fire 0
set_counter repeat_test1 1
;battle_wait 10
end_if

if I_CompareCounter unit_under_fire > 0
and I_CompareCounter reform_back < 1
and I_CompareCounter repeat_test1 = 2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter unit_under_fire 0
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_if

    if I_CompareCounter sally_defense = 0
    set_counter sally_defense 2
    end_if
    set_counter reform_back 0
    battle_wait 7
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 2
    and I_BattleIsSallyOutBattle
    and I_UnitDistanceFromPosition a2u1 1 1 > 630
    and I_UnitEnemyUnitInRadius a2u1 160

    set_counter sally_defense 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_defense = 2
    and I_UnitDistanceFromPosition a2u1 1 1 > 560
    and I_UnitDistanceFromPosition a2u1 1 1 < 630
    and I_UnitEnemyUnitInRadius a2u1 160

    set_counter sally_defense 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    ai_gta_add_objective 1 ATTACK_ENEMY_BATTLEGROUP 999

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    inc_counter reform_multi 1
    set_counter defend_location 2
    set_counter sally_defense_check 1
    battle_wait 30
    if I_CompareCounter sally_defense_check = 1
    set_counter sally_defense 3
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi < 2
;	and I_UnitDistanceFromPosition a2u1 1 1 < 660
    and I_UnitGroupDistanceFromPosition army2 1 1 < 630
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter repeat_test2 = 1
    set_counter repeat_test2 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test2 = 0

    set_counter repeat_test2 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test2 = 2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reform_multi 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if
set_counter reform_back 0
if I_CompareCounter repeat_test2 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi = 2
;	and I_UnitDistanceFromPosition a2u1 1 1 < 620
    and I_UnitGroupDistanceFromPosition army2 1 1 < 600
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter repeat_test3 = 1
    set_counter repeat_test3 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test3 = 0

    set_counter repeat_test3 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test3 = 2

    if ! I_UnitEnemyUnitInRadius a2u1 150
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -750, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 750, -100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 750, 0, -100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -750, 0, 100
    end_if
    set_counter reform_multi 1

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    end_if

    if I_UnitEnemyUnitInRadius a2u1 150
    set_counter sally_defense 3
    battle_wait 7
    end_if
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test3 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi = 3
;	and I_UnitDistanceFromPosition a2u1 1 1 < 580
    and I_UnitGroupDistanceFromPosition army2 1 1 < 560
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

    if I_CompareCounter repeat_test4 = 1
    set_counter repeat_test4 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test4 = 0

    set_counter repeat_test4 1
    set_counter sally_defense 3
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test4 = 2

    if I_UnitEnemyUnitInRadius a2u1 180
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -700, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 700, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 700, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -700, 0, 100
    end_if
    set_counter reform_multi 2
    end_if
    if ! I_UnitEnemyUnitInRadius a2u1 180
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5

    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    end_if
    set_counter reform_multi 1
    end_if
    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test4 = 1
battle_wait 20
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense = 3
    and I_CompareCounter reform_multi > 3
    and ! I_IsUnitGroupEngaged army2

    set_counter sally_defense 6
    if I_CompareCounter army_south = 1
    and I_UnitDistanceFromLine a2u1 sw se < 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_north = 1
    and I_UnitDistanceFromLine a2u1 nw ne > 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_west = 1
    and I_UnitDistanceFromLine a2u1 sw nw > 0
    set_counter line_passed 1
    end_if
    if I_CompareCounter army_east = 1
    and I_UnitDistanceFromLine a2u1 se ne < 0
    set_counter line_passed 1
    end_if

if I_CompareCounter line_passed = 1

    set_counter line_passed 0

    if I_CompareCounter enemy_unit_count > 0
    if I_UnitStatus a2u1 fighting
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reform_back 3
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reform_back 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_UnitStatus a2u2 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_UnitStatus a2u3 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_UnitStatus a2u4 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_UnitStatus a2u5 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_UnitStatus a2u6 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_UnitStatus a2u7 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_UnitStatus a2u8 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_UnitStatus a2u9 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_UnitStatus a2u10 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_UnitStatus a2u11 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_UnitStatus a2u12 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_UnitStatus a2u13 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_UnitStatus a2u14 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_UnitStatus a2u15 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_UnitStatus a2u16 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_UnitStatus a2u17 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_UnitStatus a2u18 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_UnitStatus a2u19 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reform_back 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_UnitStatus a2u20 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reform_back 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_UnitDistanceFromUnit a4u1 a2u1 < 300
    if I_UnitStatus a4u1 fighting
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 pursuing
    inc_counter reform_back 1
    end_if
    if I_UnitStatus a4u1 charging
    inc_counter reform_back 1
    end_if
    end_if

    if I_CompareCounter repeat_test5 = 1
    set_counter repeat_test5 2
    end_if
    if I_CompareCounter reform_back = 0
    and I_CompareCounter repeat_test5 = 0

    set_counter repeat_test5 1
    end_if

if I_CompareCounter reform_back = 0
and I_CompareCounter repeat_test5 = 2

if ! I_UnitEnemyUnitInRadius a2u1 20

    if ! I_UnitEnemyUnitInRadius a2u1 20
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if ! I_UnitEnemyUnitInRadius a2u1 150
    and I_BattleSettlementFortificationLevel < 3
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter reset_position 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
end_if
if I_UnitEnemyUnitInRadius a2u1 20
set_counter sally_defense 3
battle_wait 20
end_if
end_if

if I_CompareCounter reform_back > 0
and I_CompareCounter reform_back < 3

set_counter reform_back 0
set_counter sally_defense 3
battle_wait 20
end_if

if I_CompareCounter reform_back > 2

set_counter reform_back 0
set_counter sally_defense 3
;battle_wait 60
battle_wait 30
if I_CompareCounter sally_defense > 2
battle_wait 30
end_if
end_if

set_counter reform_back 0
if I_CompareCounter repeat_test5 = 1
battle_wait 10
end_if
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 0  ;check
    and I_CompareCounter reform_multi > 2
    and ! I_IsUnitGroupEngaged army2
    and I_UnitEnemyUnitInRadius a2u1 160
;	and I_UnitDistanceFromPosition a2u1 1 1 < 560
    and I_UnitGroupDistanceFromPosition army2 1 1 < 560
;	and I_BattleSettlementFortificationLevel > 2

    if I_CompareCounter enemy_unit_count > 0
    and I_IsUnitUnderFire a2u1
    and ! I_IsUnitEngaged a2u1
    and ! I_UnitStatus a2u1 pursuing
    and ! I_UnitStatus a2u1 charging
    and ! I_UnitStatus a2u1 moving
    inc_counter reset_position 2
    end_if

    if I_CompareCounter enemy_unit_count > 1
    and I_IsUnitUnderFire a2u2
    and ! I_IsUnitEngaged a2u2
    and ! I_UnitStatus a2u2 pursuing
    and ! I_UnitStatus a2u2 charging
    and ! I_UnitStatus a2u2 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    and I_IsUnitUnderFire a2u3
    and ! I_IsUnitEngaged a2u3
    and ! I_UnitStatus a2u3 pursuing
    and ! I_UnitStatus a2u3 charging
    and ! I_UnitStatus a2u3 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    and I_IsUnitUnderFire a2u4
    and ! I_IsUnitEngaged a2u4
    and ! I_UnitStatus a2u4 pursuing
    and ! I_UnitStatus a2u4 charging
    and ! I_UnitStatus a2u4 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    and I_IsUnitUnderFire a2u5
    and ! I_IsUnitEngaged a2u5
    and ! I_UnitStatus a2u5 pursuing
    and ! I_UnitStatus a2u5 charging
    and ! I_UnitStatus a2u5 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    and I_IsUnitUnderFire a2u6
    and ! I_IsUnitEngaged a2u6
    and ! I_UnitStatus a2u6 pursuing
    and ! I_UnitStatus a2u6 charging
    and ! I_UnitStatus a2u6 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    and I_IsUnitUnderFire a2u7
    and ! I_IsUnitEngaged a2u7
    and ! I_UnitStatus a2u7 pursuing
    and ! I_UnitStatus a2u7 charging
    and ! I_UnitStatus a2u7 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    and I_IsUnitUnderFire a2u8
    and ! I_IsUnitEngaged a2u8
    and ! I_UnitStatus a2u8 pursuing
    and ! I_UnitStatus a2u8 charging
    and ! I_UnitStatus a2u8 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    and I_IsUnitUnderFire a2u9
    and ! I_IsUnitEngaged a2u9
    and ! I_UnitStatus a2u9 pursuing
    and ! I_UnitStatus a2u9 charging
    and ! I_UnitStatus a2u9 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    and I_IsUnitUnderFire a2u10
    and ! I_IsUnitEngaged a2u10
    and ! I_UnitStatus a2u10 pursuing
    and ! I_UnitStatus a2u10 charging
    and ! I_UnitStatus a2u10 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    and I_IsUnitUnderFire a2u11
    and ! I_IsUnitEngaged a2u11
    and ! I_UnitStatus a2u11 pursuing
    and ! I_UnitStatus a2u11 charging
    and ! I_UnitStatus a2u11 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    and I_IsUnitUnderFire a2u12
    and ! I_IsUnitEngaged a2u12
    and ! I_UnitStatus a2u12 pursuing
    and ! I_UnitStatus a2u12 charging
    and ! I_UnitStatus a2u12 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    and I_IsUnitUnderFire a2u13
    and ! I_IsUnitEngaged a2u13
    and ! I_UnitStatus a2u13 pursuing
    and ! I_UnitStatus a2u13 charging
    and ! I_UnitStatus a2u13 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    and I_IsUnitUnderFire a2u14
    and ! I_IsUnitEngaged a2u14
    and ! I_UnitStatus a2u14 pursuing
    and ! I_UnitStatus a2u14 charging
    and ! I_UnitStatus a2u14 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    and I_IsUnitUnderFire a2u15
    and ! I_IsUnitEngaged a2u15
    and ! I_UnitStatus a2u15 pursuing
    and ! I_UnitStatus a2u15 charging
    and ! I_UnitStatus a2u15 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    and I_IsUnitUnderFire a2u16
    and ! I_IsUnitEngaged a2u16
    and ! I_UnitStatus a2u16 pursuing
    and ! I_UnitStatus a2u16 charging
    and ! I_UnitStatus a2u16 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    and I_IsUnitUnderFire a2u17
    and ! I_IsUnitEngaged a2u17
    and ! I_UnitStatus a2u17 pursuing
    and ! I_UnitStatus a2u17 charging
    and ! I_UnitStatus a2u17 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    and I_IsUnitUnderFire a2u18
    and ! I_IsUnitEngaged a2u18
    and ! I_UnitStatus a2u18 pursuing
    and ! I_UnitStatus a2u18 charging
    and ! I_UnitStatus a2u18 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    and I_IsUnitUnderFire a2u19
    and ! I_IsUnitEngaged a2u19
    and ! I_UnitStatus a2u19 pursuing
    and ! I_UnitStatus a2u19 charging
    and ! I_UnitStatus a2u19 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    and I_IsUnitUnderFire a2u20
    and ! I_IsUnitEngaged a2u20
    and ! I_UnitStatus a2u20 pursuing
    and ! I_UnitStatus a2u20 charging
    and ! I_UnitStatus a2u20 moving
    inc_counter reset_position 1
    end_if

    if I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready = 0
    and I_IsUnitUnderFire a4u1
    and ! I_IsUnitEngaged a4u1
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging
    and ! I_UnitStatus a4u1 moving
    inc_counter reset_position 2
    end_if

if I_CompareCounter reset_position > 3

    if ! I_UnitEnemyUnitInRadius a2u1 20
    and I_BattleSettlementFortificationLevel > 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 1
    end_if

    if ! I_UnitEnemyUnitInRadius a2u1 150
    and I_BattleSettlementFortificationLevel < 3
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    end_if
    set_counter reform_multi 2
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    battle_wait 0.5
;	unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position 0
    set_counter sally_defense 2
    set_counter defend_location 1
end_if

if I_CompareCounter sally_defense != 2
set_counter sally_defense 3
battle_wait 15
end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_defense > 0
    and I_UnitEnemyUnitInRadius a2u1 200

    if ! I_IsUnitGroupEngaged army2
    and ! I_IsUnitGroupMoving army2
    and ! I_UnitStatus a2u1 pursuing
    and ! I_UnitStatus a2u1 charging

    inc_counter army2_idle_s 1
    end_if

    if I_CompareCounter army2_idle_s > 5
    set_counter army2_idle_s 0
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    battle_wait 0.5
;	 unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position 0
    set_counter sally_defense 2
    set_counter defend_location 1
    end_if

    if I_IsUnitGroupEngaged army2
    set_counter army2_idle_s 0
    end_if
    if I_IsUnitGroupMoving army2
    set_counter army2_idle_s 0
    end_if
    if I_UnitStatus a2u1 pursuing
    set_counter army2_idle_s 0
    end_if
    if I_UnitStatus a2u1 charging
    set_counter army2_idle_s 0
    end_if
    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 2
    and I_BattleSettlementFortificationLevel > 2
;	and I_CompareCounter reform_multi > 3
    and ! I_IsUnitGroupEngaged army2
    and ! I_UnitEnemyUnitInRadius a2u1 80

    set_counter sally_defense 6
    set_counter wall_line_passed 0
    set_counter reset_position_s 0

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitEngaged a2u1
    inc_counter reset_position_s 2
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter reset_position_s 2
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter reset_position_s 2
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitEngaged a2u2
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitEngaged a2u3
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitEngaged a2u4
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitEngaged a2u5
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitEngaged a2u6
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitEngaged a2u7
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitEngaged a2u8
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitEngaged a2u9
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitEngaged a2u10
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitEngaged a2u11
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitEngaged a2u12
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitEngaged a2u13
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitEngaged a2u14
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitEngaged a2u15
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitEngaged a2u16
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitEngaged a2u17
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitEngaged a2u18
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitEngaged a2u19
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter reset_position_s 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitEngaged a2u20
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter reset_position_s 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter reset_position_s 1
    end_if
    end_if

if I_CompareCounter reset_position_s = 0
    if I_CompareCounter army_south = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 sw_wall se_wall > 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 nw_wall ne_wall < 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 sw_wall nw_wall < 0
    inc_counter wall_line_passed 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromLine a1u1 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromLine a1u2 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromLine a1u3 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromLine a1u4 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromLine a1u5 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromLine a1u6 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromLine a1u7 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromLine a1u8 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromLine a1u9 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromLine a1u10 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromLine a1u11 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromLine a1u12 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromLine a1u13 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromLine a1u14 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromLine a1u15 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromLine a1u16 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromLine a1u17 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromLine a1u18 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromLine a1u19 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromLine a1u20 se_wall ne_wall > 0
    inc_counter wall_line_passed 1
    end_if
    end_if
end_if

    if I_CompareCounter repeat_test6 = 1
    set_counter repeat_test6 2
    end_if
    if I_CompareCounter wall_line_passed = 0
    and I_CompareCounter reset_position_s = 0
    and I_CompareCounter repeat_test6 = 0

    set_counter repeat_test6 1
    end_if
    if I_CompareCounter wall_line_passed = 0
    and I_CompareCounter reset_position_s = 0
    and I_CompareCounter repeat_test6 = 2
    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_north = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 675, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_east = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if
    if I_CompareCounter army_west = 1
    if I_CompareCounter reform_multi > 2
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -675, 0, 100
    set_counter reform_multi 2
    end_if
    if I_CompareCounter reform_multi < 3
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    set_counter reform_multi 1
    end_if
    end_if

    if I_CompareCounter enemy_unit_count > 0
    if ! I_UnitDestroyed a2u1
    and ! I_UnitStatus a2u1 left_battle
    ai_gta_add_unit_label 1 0 a2u1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if ! I_UnitDestroyed a2u2
    and ! I_UnitStatus a2u2 left_battle
    ai_gta_add_unit_label 1 0 a2u2
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if ! I_UnitDestroyed a2u3
    and ! I_UnitStatus a2u3 left_battle
    ai_gta_add_unit_label 1 0 a2u3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if ! I_UnitDestroyed a2u4
    and ! I_UnitStatus a2u4 left_battle
    ai_gta_add_unit_label 1 0 a2u4
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if ! I_UnitDestroyed a2u5
    and ! I_UnitStatus a2u5 left_battle
    ai_gta_add_unit_label 1 0 a2u5
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if ! I_UnitDestroyed a2u6
    and ! I_UnitStatus a2u6 left_battle
    ai_gta_add_unit_label 1 0 a2u6
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if ! I_UnitDestroyed a2u7
    and ! I_UnitStatus a2u7 left_battle
    ai_gta_add_unit_label 1 0 a2u7
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if ! I_UnitDestroyed a2u8
    and ! I_UnitStatus a2u8 left_battle
    ai_gta_add_unit_label 1 0 a2u8
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if ! I_UnitDestroyed a2u9
    and ! I_UnitStatus a2u9 left_battle
    ai_gta_add_unit_label 1 0 a2u9
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if ! I_UnitDestroyed a2u10
    and ! I_UnitStatus a2u10 left_battle
    ai_gta_add_unit_label 1 0 a2u10
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if ! I_UnitDestroyed a2u11
    and ! I_UnitStatus a2u11 left_battle
    ai_gta_add_unit_label 1 0 a2u11
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if ! I_UnitDestroyed a2u12
    and ! I_UnitStatus a2u12 left_battle
    ai_gta_add_unit_label 1 0 a2u12
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if ! I_UnitDestroyed a2u13
    and ! I_UnitStatus a2u13 left_battle
    ai_gta_add_unit_label 1 0 a2u13
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if ! I_UnitDestroyed a2u14
    and ! I_UnitStatus a2u14 left_battle
    ai_gta_add_unit_label 1 0 a2u14
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if ! I_UnitDestroyed a2u15
    and ! I_UnitStatus a2u15 left_battle
    ai_gta_add_unit_label 1 0 a2u15
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if ! I_UnitDestroyed a2u16
    and ! I_UnitStatus a2u16 left_battle
    ai_gta_add_unit_label 1 0 a2u16
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if ! I_UnitDestroyed a2u17
    and ! I_UnitStatus a2u17 left_battle
    ai_gta_add_unit_label 1 0 a2u17
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if ! I_UnitDestroyed a2u18
    and ! I_UnitStatus a2u18 left_battle
    ai_gta_add_unit_label 1 0 a2u18
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if ! I_UnitDestroyed a2u19
    and ! I_UnitStatus a2u19 left_battle
    ai_gta_add_unit_label 1 0 a2u19
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if ! I_UnitDestroyed a2u20
    and ! I_UnitStatus a2u20 left_battle
    ai_gta_add_unit_label 1 0 a2u20
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

;    battle_wait 0.5
;	 unit_group_order_halt army2
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter reset_position_s 0
    set_counter sally_defense 2
    set_counter defend_location 1
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    end_if

    if I_CompareCounter sally_defense != 2
    set_counter sally_defense 3
    end_if
    if I_CompareCounter wall_line_passed > 0
    battle_wait 15
    end_if
    if I_CompareCounter reset_position_s > 0
    battle_wait 15
    end_if
    if I_CompareCounter repeat_test6 = 1
    battle_wait 20
    end_if
end_monitor

;;;;;Termination
monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_defense > 0
    and I_CompareCounter kill_sally = 0
    and I_IsUnitRouting a2u1
    and ! I_IsUnitGroupEngaged army2
    and ! I_IsUnitGroupDestroyed army2

    ai_gta_del_objective 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    if I_CompareCounter army_south = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, -725, 100
    end_if
    if I_CompareCounter army_north = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 0, 725, 100
    end_if
    if I_CompareCounter army_east = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 725, 0, 100
    end_if
    if I_CompareCounter army_west = 1
    ai_gta_add_objective 1 DEFEND_TERRAIN_AREA 999 -725, 0, 100
    end_if

    set_counter sally_defense 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter assign_labels = 1
    and I_UnitDestroyed a2u1
    and ! I_IsUnitGroupDestroyed army2

    set_counter reset_army2 1
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter assign_labels 2
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter kill_sally = 0
    and I_CompareCounter assign_labels = 2
    and I_UnitDestroyed a2u1
    and ! I_IsUnitGroupDestroyed army2

    set_counter assign_labels 1
end_monitor

;;;Sally Reinforcements

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter sally_reinf = 1
    and I_CompareCounter kill_sally = 0
;	and ! I_BattleIsFortBattle
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsUnitEngaged a4u1

    if I_CompareCounter sally_defense < 3
    set_counter defend_location 1
    set_counter sally_reinf 2
    end_if

    if I_CompareCounter sally_defense > 2

    set_counter defend_location 2
    set_counter sally_reinf 2
    end_if

end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
    and I_CompareCounter sally_defense < 3
    and I_CompareCounter sally_defense != 1
    and I_CompareCounter defend_location = 1
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and ! I_IsUnitGroupEngaged army4
    and ! I_IsUnitGroupEngaged army2
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging
    and ! I_UnitEnemyUnitInRadius a4u1 20

     ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20

    battle_wait 0.5
    ai_active_set on

    set_counter defend_location 0
;	set_counter army4_idle_s 0
battle_wait 20
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
    and I_CompareCounter sally_defense > 2
    and I_CompareCounter defend_location = 2
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0

    ;;;Army 4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u1
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u2
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u3
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u4
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u5
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u6
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u7
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u8
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u9
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u10
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u11
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u12
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u13
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u14
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u15
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u16
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u17
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u18
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u19
    ai_gta_add_unit_label 1 G5_OBJECTIVE a4u20

;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter defend_location 0
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter sally_reinf = 2
;	and I_CompareCounter sally_defense > 2
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_CompareCounter defend_location = 0
;    and I_UnitEnemyUnitInRadius a4u1 200

    if ! I_IsUnitGroupEngaged army4
    and ! I_IsUnitGroupMoving army4
    and ! I_UnitStatus a4u1 pursuing
    and ! I_UnitStatus a4u1 charging

    inc_counter army4_idle_s 1
    end_if
    if I_CompareCounter army4_idle_s > 5
    set_counter defend_location 1
    set_counter sally_defense 2
    end_if

    if I_IsUnitGroupEngaged army4
    set_counter army4_idle_s 0
    end_if
    if I_IsUnitGroupMoving army4
    set_counter army4_idle_s 0
    end_if
    if I_UnitStatus a4u1 pursuing
    set_counter army4_idle_s 0
    end_if
    if I_UnitStatus a4u1 charging
    set_counter army4_idle_s 0
    end_if
    battle_wait 10
end_monitor

;;;;;Termination
monitor_conditions I_BattleStarted
    and I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_IsUnitGroupDestroyed army4
    and I_BattleIsSallyOutBattle

    set_counter sally_reinf 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter sally_reinf > 0
    and I_CompareCounter army4_ready_sally = 0
    and I_CompareCounter army4_ready = 0
    and I_UnitDestroyed a4u1
    and I_BattleIsSallyOutBattle

    set_counter label_army4 1
;    battle_wait 0.5
;    unit_group_enable_automation army4 false
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    set_counter sally_reinf 0
end_monitor

;################## Germanicu5 Integrated Protect General script ###########################

monitor_event BattleConflictPhaseCommenced FactionIsLocal
    and I_CompareCounter panel_check = 1
    and I_BattleEnemyArmyNumberOfMountClass elephant = 0
    and I_CompareCounter enemy_unit_count > 4

    battle_wait 10

    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
    and I_CompareCounter protect_siege = 1
    set_counter protect_general 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
;    and I_BattleEnemyArmyNumberOfSpecialAbility rally > 0
;    and I_CompareCounter labels_only = 1
    and I_CompareCounter kill_sally = 1
    set_counter protect_general 1
    end_if
end_monitor

monitor_event BattleBattleGatesDestroyedByEngine TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter kill_sally = 1
    set_counter general_wait 1
    end_if
end_monitor

monitor_event BattleWallsCaptured TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if
end_monitor

monitor_event BattleWallsBreachedByEngine TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter protect_general = 1

    set_counter protect_general 0
    if I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    set_counter general_wait 1
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 1
    and I_IsUnitMoveFastSet a1u1
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry > 0

    battle_wait 0.5
    unit_order_halt a1u1
    if I_CompareCounter enemy_unit_count < 7
    set_counter general_wait 2
    battle_wait 20
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 20
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter enemy_unit_count < 12
    set_counter general_wait 2
    battle_wait 25
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 25
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter enemy_unit_count < 16
    set_counter general_wait 2
    battle_wait 30
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 30
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 15
    set_counter general_wait 2
    battle_wait 35
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 35
    end_if
    end_if
    if I_BattleIsSiegeBattle
    and I_CompareCounter general_wait = 3
    release_unit a1u1
    set_counter general_wait 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 1
    and I_IsUnitMoveFastSet a2u1
    and I_BattleEnemyArmyNumberOfUnitCategory cavalry > 0

    battle_wait 0.5
    unit_order_halt a2u1

    if I_CompareCounter enemy_unit_count < 7
    set_counter general_wait 2
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 20
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter enemy_unit_count < 12
    set_counter general_wait 2
    battle_wait 25
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 25
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter enemy_unit_count < 16
    set_counter general_wait 2
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 30
    end_if
    end_if
    if I_CompareCounter enemy_unit_count > 15
    set_counter general_wait 2
    battle_wait 35
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 2
    set_counter general_wait 3
    battle_wait 35
    end_if
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter general_wait = 3
    release_unit a2u1
    set_counter general_wait 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter general_wait > 1
    and I_BattleIsSiegeBattle
    and ! I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a1u1 60

    set_counter general_wait 0
    release_unit a1u1
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter general_wait > 1
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 60

    set_counter general_wait 0
    release_unit a2u1
end_monitor

;################## Germanicu5 Integrated Siege script ###########################

monitor_conditions I_BattleStarted
    and ! I_BattleIsFortBattle
    and I_BattleEnemyArmyNumberOfMountClass elephant = 0
    and I_BattleSettlementFortificationLevel > 0
    and I_CompareCounter siege_fix = 1

    set_counter siege_fix 0

    if I_BattleIsSallyOutBattle
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    set_counter army_sieging 1
    end_if

    if I_BattleIsSallyOutBattle
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege = 0
    set_counter wall_advance_s 1
    end_if
end_monitor

;;;;;;;Sally Out

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_BattlePlayerArmyIsAttacker
    and I_CompareCounter reset_army2 = 1

    set_counter reset_army2 0
    set_counter enemy_unit_count 0

    if I_BattleEnemyArmyNumberOfUnits > 0
    label_unit 1 0 0 a2u1
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 1
    label_unit 1 0 1 a2u2
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 2
    label_unit 1 0 2 a2u3
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 3
    label_unit 1 0 3 a2u4
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 4
    label_unit 1 0 4 a2u5
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 5
    label_unit 1 0 5 a2u6
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 6
    label_unit 1 0 6 a2u7
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 7
    label_unit 1 0 7 a2u8
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 8
    label_unit 1 0 8 a2u9
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 9
    label_unit 1 0 9 a2u10
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 10
    label_unit 1 0 10 a2u11
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 11
    label_unit 1 0 11 a2u12
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 12
    label_unit 1 0 12 a2u13
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 13
    label_unit 1 0 13 a2u14
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 14
    label_unit 1 0 14 a2u15
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 15
    label_unit 1 0 15 a2u16
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 16
    label_unit 1 0 16 a2u17
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 17
    label_unit 1 0 17 a2u18
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits > 18
    label_unit 1 0 18 a2u19
    inc_counter enemy_unit_count 1
    if I_BattleEnemyArmyNumberOfUnits = 20
    label_unit 1 0 19 a2u20
    inc_counter enemy_unit_count 1
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_monitor

;;;;;;;Huge City

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 4

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 35

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
    set_counter sally_check 10
    battle_wait 30

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 10
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 14
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 14
    set_counter sally_check 15
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 15
    set_counter sally_check 16
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 16
    set_counter sally_check 17
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 17
    set_counter sally_check 18
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 18
    set_counter sally_check 19
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 19
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 4

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 80

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 60
    set_counter sally_check 20
    battle_wait 30
if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 20
    set_counter sally_check 21
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 21
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 24
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 24
    set_counter sally_check 25
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 25
    set_counter sally_check 26
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 26
    set_counter sally_check 27
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 27
    set_counter sally_check 28
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 28
    set_counter sally_check 29
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 29
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_if
end_monitor

;;;;;;;Large City

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 45

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
    set_counter sally_check 30
    battle_wait 37

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 30
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 34
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 34
    set_counter sally_check 35
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 35
    set_counter sally_check 36
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 36
    set_counter sally_check 37
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 37
    set_counter sally_check 38
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 38
    set_counter sally_check 39
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 39
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and ! I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 90

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 70
    set_counter sally_check 40
    battle_wait 35
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 40
    set_counter sally_check 41
    battle_wait 35
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 41
    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    if I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 44
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 44
    set_counter sally_check 45
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 45
    set_counter sally_check 46
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 46
    set_counter sally_check 47
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 47
    set_counter sally_check 48
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 48
    set_counter sally_check 49
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 49
    set_counter emergency_stop 0
    if I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

;;;;;;;Castle, Citadel and Fortress

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range > 0
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 100

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 75
    set_counter sally_check 50
    battle_wait 15
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 50
    set_counter sally_check 51
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 51
    set_counter sally_check 52
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 52
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 54
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 54
    set_counter sally_check 55
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 55
    set_counter sally_check 56
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 56
    set_counter sally_check 57
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 57
    set_counter sally_check 58
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 58
    set_counter sally_check 59
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 59
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and ! I_BattleIsFortBattle
     and I_CompareCounter army_sieging = 1
     and I_CompareCounter army2_sally = 1
    and I_BattleEnemyArmyNumberOfClassAndCategory missile siege > 0
    and I_BattlePlayerArmyNumberOfAttribute extreme_range = 0
    and I_BattlePlayerArmyIsAttacker
    and I_IsBattleSettlementCastle
    and I_BattleSettlementFortificationLevel 3

    battle_wait 2
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_formed army2 0 170

    set_counter emergency_stop 1
    set_counter omfg_cannon_tower 1
    battle_wait 2
    ai_active_set on
;	battle_wait 125
    set_counter sally_check 60
    battle_wait 30
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 60
    set_counter sally_check 61
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 61
    set_counter sally_check 62
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 62
    set_counter sally_check 63
    battle_wait 35
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 63
    if I_BattleStarted
    and I_CompareCounter omfg_cannon_tower > 0
    set_counter omfg_cannon_tower 0
    end_if

    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1
    if ! I_IsUnitGroupMoving army2
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    if I_IsUnitGroupMoving army2
;	battle_wait 170
    set_counter sally_check 64
    battle_wait 20
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 64
    set_counter sally_check 65
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 65
    set_counter sally_check 66
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 66
    set_counter sally_check 67
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 67
    set_counter sally_check 68
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 68
    set_counter sally_check 69
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 69
    set_counter emergency_stop 0
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    end_if
    end_if
    end_if

    set_counter army_sieging 0
    set_counter army2_sally 0
    end_if
end_monitor

;;;;;;;Wall Advance

monitor_conditions I_BattleStarted
    and I_CompareCounter wall_advance_s = 1
    and I_CompareCounter kill_sally = 1
    and I_BattleIsSallyOutBattle

    battle_wait 2
    if I_BattleSettlementFortificationLevel < 3
     and I_CompareCounter wall_advance_s = 1
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_unformed army2 0 95
    end_if

    if I_BattleSettlementFortificationLevel > 2
     and I_CompareCounter wall_advance_s = 1
    set_counter reset_army2 1
    battle_wait 0.5
    unit_group_order_halt army2
    battle_wait 0.5
    unit_group_order_relative_move_unformed army2 0 200
    end_if

    set_counter emergency_stop 1
    if I_BattleSettlementFortificationLevel < 3
;	battle_wait 72
    set_counter sally_check 113
    battle_wait 36
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 113
    set_counter sally_check 114
    battle_wait 36
    end_if
    end_if
    if I_BattleSettlementFortificationLevel > 2
;	battle_wait 145
    set_counter sally_check 110
    battle_wait 25
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 110
    set_counter sally_check 111
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 111
    set_counter sally_check 112
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 112
    set_counter sally_check 113
    battle_wait 30
    end_if
    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 113
    set_counter sally_check 114
    battle_wait 30
    end_if
    end_if

    if I_BattleIsSallyOutBattle
    and I_CompareCounter sally_check = 114
    if I_BattleStarted
    and I_CompareCounter emergency_stop = 1

    set_counter emergency_stop 0
    unit_group_order_halt army2
;    battle_wait 0.5
;    ai_active_set off
    battle_wait 0.5
    ai_active_set on
    end_if
    set_counter wall_advance_s 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_BattleIsSallyOutBattle
    and I_CompareCounter omfg_cannon_tower > 0

    set_counter omfg_cannon_tower 2
if I_CompareCounter player_unit_count > 0
    if I_UnitStatus a1u1 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u1 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u2 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u2 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u3 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u3 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u4 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u4 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u5 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u5 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u6 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u6 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u7 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u7 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u8 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u8 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u9 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u9 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u10 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u10 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u11 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u11 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u12 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u12 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u13 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u13 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u14 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u14 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u15 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u15 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u16 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u16 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u17 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u17 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u18 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u18 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u19 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u19 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    if I_CompareCounter player_unit_count > 19
    and I_CompareCounter omfg_cannon_tower != 1
    if I_UnitStatus a1u20 missiles_firing
    set_counter omfg_cannon_tower 1
    end_if
    if I_UnitStatus a1u20 missiles_reloading
    set_counter omfg_cannon_tower 1
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
end_if

if I_CompareCounter omfg_cannon_tower = 2

    if I_CompareCounter enemy_unit_count > 0
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u1
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 1
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u2
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 2
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u3
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 3
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u4
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 4
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u5
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 5
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u6
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 6
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u7
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 7
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u8
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 8
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u9
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 9
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u10
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 10
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u11
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 11
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u12
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 12
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u13
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 13
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u14
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 14
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u15
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 15
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u16
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 16
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u17
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 17
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u18
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count > 18
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u19
    set_counter omfg_cannon_tower 3
    end_if

    if I_CompareCounter enemy_unit_count = 20
    and I_CompareCounter omfg_cannon_tower = 2
    and I_IsUnitUnderFire a2u20
    set_counter omfg_cannon_tower 3
    end_if
end_if

    if I_CompareCounter omfg_cannon_tower = 3
    set_counter omfg_cannon_tower 0
    set_counter emergency_stop 0
;    ai_active_set off
;    battle_wait 0.5
    ai_active_set on
    end_if
    battle_wait 7
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter panel_check = 1
    and I_CompareCounter emergency_stop = 1
;    and I_CompareCounter labels_only = 1
    and I_CompareCounter kill_sally = 1

    if I_BattleIsSiegeBattle
    unit_group_order_halt army1
    battle_wait 0.5
    ai_active_set on
    set_counter emergency_stop 0
    end_if
    if I_BattleIsSallyOutBattle
    unit_group_order_halt army2
    battle_wait 0.5
    ai_active_set on
    set_counter emergency_stop 0
    end_if
end_monitor

;################## Open Battles #################

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter ob_defend = 0
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    set_counter ob_defend 2

    if I_UnitDistanceFromUnit a1u1 a2u1 < 220
    and I_BattleEnemyArmyNumberOfUnitClass missile = 0
    and I_BattleEnemyArmyNumberOfUnitClass skirmish = 0
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    and I_UnitDistanceFromUnit a1u1 a2u1 < 270
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattlePlayerAllianceOddsInFavour > 1.7
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_defend = 2
    and I_BattleEnemyArmyNumberOfUnitClass missile = 0
    and I_BattleEnemyArmyNumberOfUnitClass skirmish = 0
    set_counter ob_repeat_test 1
    end_if
;    if I_BattlePlayerArmyNumberOfClassAndCategory missile siege > 0
;    end_if
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 200
    and BattleEnemyUnitClass != missile
    and BattleEnemyUnitClass != skirmish
    and BattleDirectionOfAttack != front
    and BattleRangeOfAttack < 200

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_event BattlePlayerUnitAttacksEnemyUnit BattleIsMeleeAttack
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker
    and BattleDirectionOfAttack != rear
    and I_UnitEnemyUnitInRadius a2u1 200
    and BattleRangeOfAttack < 200
    and BattlePlayerUnitCategory infantry

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_UnitEnemyUnitInRadius a2u1 100
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattleEnemyArmyPercentageOfUnitCategory cavalry > 60
    and I_UnitEnemyUnitInRadius a2u1 250
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4

    set_counter player_units_closing 0

    if I_CompareCounter player_unit_count > 0
    and I_UnitDistanceFromUnit a1u1 a2u1 < 180
    and ! I_UnitStatus a1u1 missiles_firing
    and ! I_UnitStatus a1u1 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 1
    and I_UnitDistanceFromUnit a1u2 a2u1 < 180
    and ! I_UnitStatus a1u2 missiles_firing
    and ! I_UnitStatus a1u2 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 2
    and I_UnitDistanceFromUnit a1u3 a2u1 < 180
    and ! I_UnitStatus a1u3 missiles_firing
    and ! I_UnitStatus a1u3 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 3
    and I_UnitDistanceFromUnit a1u4 a2u1 < 180
    and ! I_UnitStatus a1u4 missiles_firing
    and ! I_UnitStatus a1u4 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 4
    and I_UnitDistanceFromUnit a1u5 a2u1 < 180
    and ! I_UnitStatus a1u5 missiles_firing
    and ! I_UnitStatus a1u5 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 5
    and I_UnitDistanceFromUnit a1u6 a2u1 < 180
    and ! I_UnitStatus a1u6 missiles_firing
    and ! I_UnitStatus a1u6 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 6
    and I_UnitDistanceFromUnit a1u7 a2u1 < 180
    and ! I_UnitStatus a1u7 missiles_firing
    and ! I_UnitStatus a1u7 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 7
    and I_UnitDistanceFromUnit a1u8 a2u1 < 180
    and ! I_UnitStatus a1u8 missiles_firing
    and ! I_UnitStatus a1u8 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 8
    and I_UnitDistanceFromUnit a1u9 a2u1 < 180
    and ! I_UnitStatus a1u9 missiles_firing
    and ! I_UnitStatus a1u9 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 9
    and I_UnitDistanceFromUnit a1u10 a2u1 < 180
    and ! I_UnitStatus a1u10 missiles_firing
    and ! I_UnitStatus a1u10 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 10
    and I_UnitDistanceFromUnit a1u11 a2u1 < 180
    and ! I_UnitStatus a1u11 missiles_firing
    and ! I_UnitStatus a1u11 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 11
    and I_UnitDistanceFromUnit a1u12 a2u1 < 180
    and ! I_UnitStatus a1u12 missiles_firing
    and ! I_UnitStatus a1u12 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 12
    and I_UnitDistanceFromUnit a1u13 a2u1 < 180
    and ! I_UnitStatus a1u13 missiles_firing
    and ! I_UnitStatus a1u13 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 13
    and I_UnitDistanceFromUnit a1u14 a2u1 < 180
    and ! I_UnitStatus a1u14 missiles_firing
    and ! I_UnitStatus a1u14 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 14
    and I_UnitDistanceFromUnit a1u15 a2u1 < 180
    and ! I_UnitStatus a1u15 missiles_firing
    and ! I_UnitStatus a1u15 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 15
    and I_UnitDistanceFromUnit a1u16 a2u1 < 180
    and ! I_UnitStatus a1u16 missiles_firing
    and ! I_UnitStatus a1u16 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 16
    and I_UnitDistanceFromUnit a1u17 a2u1 < 180
    and ! I_UnitStatus a1u17 missiles_firing
    and ! I_UnitStatus a1u17 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 17
    and I_UnitDistanceFromUnit a1u18 a2u1 < 180
    and ! I_UnitStatus a1u18 missiles_firing
    and ! I_UnitStatus a1u18 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count > 18
    and I_UnitDistanceFromUnit a1u19 a2u1 < 180
    and ! I_UnitStatus a1u19 missiles_firing
    and ! I_UnitStatus a1u19 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_unit_count = 20
    and I_UnitDistanceFromUnit a1u20 a2u1 < 180
    and ! I_UnitStatus a1u20 missiles_firing
    and ! I_UnitStatus a1u20 missiles_reloading
    inc_counter player_units_closing 1
    end_if

    if I_CompareCounter player_units_closing > 1
    inc_counter player_enveloping 1
    end_if
    if I_CompareCounter player_units_closing < 1
    set_counter player_enveloping 0
    end_if
    if I_CompareCounter player_enveloping > 5
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    end_if

    battle_wait 10
end_monitor

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter panel_check = 1
    and I_CompareCounter ob_defend > 1
    and I_CompareCounter ob_defend != 4
    and BattleIsMeleeAttack
    and BattleEnemyUnitClass heavy
    and BattleEnemyUnitCategory cavalry
    and ! BattlePlayerUnitClass heavy
    and ! BattlePlayerUnitClass heavy
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    inc_counter ob_engaged -1
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defend > 1
    and I_CompareCounter ob_defend != 4
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    if I_PercentageOfArmyKilled 0 0 < 5
    and I_PercentageOfArmyKilled 1 0 > 10
    set_counter ob_repeat_test 4
    end_if

    if I_PercentageOfArmyKilled 0 0 < 10
    and I_PercentageOfArmyKilled 1 0 > 20
    set_counter ob_repeat_test 4
    end_if

    if I_PercentageOfArmyKilled 0 0 < 15
    and I_PercentageOfArmyKilled 1 0 > 25
    set_counter ob_repeat_test 4
    end_if
    battle_wait 30
end_monitor

;monitor_event BattlePlayerUnitAttacksEnemyUnit TrueCondition
;    and I_CompareCounter panel_check = 1
;    and I_CompareCounter ob_defense_launch = 1
;    and ! I_CompareCounter ob_defend > 1
;    and BattlePlayerUnitCategory siege
;    and BattlePlayerUnitClass missile
;    and BattleRangeOfAttack < 400
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    set_counter ob_siege_attack 1
;end_monitor

;monitor_conditions I_BattleStarted
;    and I_CompareCounter ob_defense_launch = 1
;    and I_CompareCounter ob_siege_attack = 1
;    and I_CompareCounter open_battle = 1
;    and I_BattlePlayerArmyIsAttacker
;    if I_PercentageOfArmyKilled 0 0 < 3
;    and I_PercentageOfArmyKilled 1 0 > 5
;    set_counter ob_defend 2
;    set_counter ob_siege_attack 0
;    end_if
;    if I_PercentageOfArmyKilled 0 0 < 5
;    and I_PercentageOfArmyKilled 1 0 > 10
;    if I_CompareCounter ob_repeat_test < 2
;    set_counter ob_repeat_test 2
;    end_if
;    set_counter ob_defend 2
;    set_counter ob_siege_attack 0
;    end_if
;    battle_wait 30
;end_monitor

;;;;;; Reinf triggers

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_BattlePlayerArmyIsAttacker

    if I_CompareCounter player_engaged_reinf = 4
    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
    end_if

    if I_IsUnitGroupEngaged army1
    inc_counter player_engaged_reinf 1
    end_if

    if I_CompareCounter player_engaged_reinf > 0
    and ! I_IsUnitGroupEngaged army1
    set_counter player_engaged_reinf 0
    end_if

    battle_wait 10
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_PercentageUnitGroupKilled army4 > 10
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter def_alliance_ready = 1
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter open_battle = 1
    and I_CompareCounter ob_defend != 4
    and I_UnitEnemyUnitInRadius a4u1 100
    and I_BattlePlayerArmyIsAttacker

    ai_gta_plan_set 1 ATTACK_ALL
    set_counter apply_strategy 1
    set_counter ob_defend 4
    set_counter ob_defense_launch 0
    set_counter def_alliance_ready 0
end_monitor

;;;;;; Main monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter ob_defense_launch = 1
    and I_CompareCounter ob_defend = 2
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker

    set_counter ob_defend 3

    if I_CompareCounter enemy_unit_count > 0
    if I_IsUnitUnderFire a2u1
    inc_counter ob_under_fire 2
    end_if
    if I_UnitStatus a2u1 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u1 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u1 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 1
    if I_IsUnitUnderFire a2u2
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u2 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u2 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u2 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 2
    if I_IsUnitUnderFire a2u3
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u3 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u3 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u3 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 3
    if I_IsUnitUnderFire a2u4
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u4 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u4 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u4 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 4
    if I_IsUnitUnderFire a2u5
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u5 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u5 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u5 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 5
    if I_IsUnitUnderFire a2u6
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u6 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u6 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u6 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 6
    if I_IsUnitUnderFire a2u7
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u7 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u7 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u7 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 7
    if I_IsUnitUnderFire a2u8
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u8 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u8 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u8 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 8
    if I_IsUnitUnderFire a2u9
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u9 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u9 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u9 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 9
    if I_IsUnitUnderFire a2u10
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u10 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u10 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u10 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 10
    if I_IsUnitUnderFire a2u11
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u11 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u11 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u11 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 11
    if I_IsUnitUnderFire a2u12
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u12 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u12 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u12 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 12
    if I_IsUnitUnderFire a2u13
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u13 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u13 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u13 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 13
    if I_IsUnitUnderFire a2u14
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u14 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u14 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u14 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 14
    if I_IsUnitUnderFire a2u15
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u15 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u15 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u15 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 15
    if I_IsUnitUnderFire a2u16
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u16 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u16 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u16 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 16
    if I_IsUnitUnderFire a2u17
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u17 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u17 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u17 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 17
    if I_IsUnitUnderFire a2u18
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u18 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u18 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u18 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count > 18
    if I_IsUnitUnderFire a2u19
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u19 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u19 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u19 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    if I_CompareCounter enemy_unit_count = 20
    if I_IsUnitUnderFire a2u20
    inc_counter ob_under_fire 1
    end_if
    if I_UnitStatus a2u20 fighting
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 pursuing
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 charging
    inc_counter ob_engaged 1
    end_if
    if I_UnitStatus a2u20 missiles_firing
    inc_counter ob_under_fire -1
    end_if
    if I_UnitStatus a2u20 missiles_reloading
    inc_counter ob_under_fire -1
    end_if

    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if
    end_if

    if I_CompareCounter ob_under_fire < 1
    if I_CompareCounter ob_engaged > 0

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if

    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_engaged 0
    set_counter ob_repeat_test 3
    end_if

    if I_CompareCounter ob_repeat_test = 1
    set_counter ob_engaged 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 2
    end_if

    if I_CompareCounter ob_repeat_test = 0
    set_counter ob_engaged 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 1
    end_if
    end_if

    if I_CompareCounter ob_engaged < 1

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 2
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    end_if

    if I_CompareCounter ob_repeat_test < 3
    set_counter ob_repeat_test 1
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    end_if
    end_if

    end_if

    if I_CompareCounter ob_under_fire > 0
    if I_CompareCounter ob_engaged > 0

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if
    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_engaged 0
    set_counter ob_repeat_test 3
    end_if
    if I_CompareCounter ob_repeat_test < 2
    set_counter ob_under_fire 0
    set_counter ob_engaged 0
    set_counter ob_repeat_test 2
    end_if
    end_if

    if I_CompareCounter ob_engaged < 1

    if I_CompareCounter ob_repeat_test = 3
    set_counter ob_repeat_test 4
    end_if

    if I_CompareCounter ob_repeat_test = 2
    set_counter ob_repeat_test 3
    end_if
    if I_CompareCounter ob_repeat_test = 1
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 2
    end_if

    if I_CompareCounter ob_repeat_test = 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 1
    end_if
    end_if

    end_if
    if I_CompareCounter ob_repeat_test = 4
    if I_CompareCounter ob_under_fire < 1
    and I_CompareCounter ob_engaged < 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 3
        set_counter ob_repeat_test 2
    end_if
    if I_CompareCounter ob_under_fire > 0

        ai_gta_plan_set 1 ATTACK_ALL
        set_counter apply_strategy 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 4
        set_counter ob_repeat_test 0
        set_counter ob_defense_launch 0
    end_if
    if I_CompareCounter ob_engaged > 0

        ai_gta_plan_set 1 ATTACK_ALL
        set_counter apply_strategy 1
        set_counter ob_under_fire 0
        set_counter ob_engaged 0
        set_counter ob_defend 4
        set_counter ob_repeat_test 0
        set_counter ob_defense_launch 0
    end_if

    end_if

        if I_CompareCounter ob_defend = 3
        set_counter ob_defend 2
        end_if
        battle_wait 15
end_monitor

;;;;;;;General Stop

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 1
    and I_CompareCounter open_battle = 1
    and I_BattleEnemyArmyNumberOfUnits > 2
    and I_BattlePlayerArmyIsAttacker
    and I_BattleAiAttacking
    and I_UnitEnemyUnitInRadius a2u1 120

    set_counter g_stop 2
    label_unit 1 0 0 a2u1
    battle_wait 0.1
    unit_order_halt a2u1
    if I_BattleEnemyArmyNumberOfUnits > 5
    battle_wait 30
    end_if
    if I_BattleEnemyArmyNumberOfUnits < 6
    battle_wait 15
    end_if
    if I_BattlePlayerArmyIsAttacker
    and I_CompareCounter g_stop = 2
    and I_BattleAiAttacking
    release_unit a2u1
    set_counter g_stop 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 1
    and I_CompareCounter open_battle = 1
    and ! I_BattlePlayerArmyIsAttacker
    and I_BattleAiAttacking
    and I_UnitEnemyUnitInRadius a1u1 120

    set_counter g_stop 3
    label_unit 0 0 0 a1u1
    battle_wait 0.1
    unit_order_halt a1u1
    battle_wait 30
    if ! I_BattlePlayerArmyIsAttacker
    and I_CompareCounter g_stop = 3
    and I_BattleAiAttacking
    release_unit a1u1
    set_counter g_stop 0
    end_if
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 2
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a2u1 60

    release_unit a2u1
    set_counter g_stop 0
end_monitor

monitor_conditions I_BattleStarted
    and I_CompareCounter g_stop = 3
    and I_CompareCounter open_battle = 1
    and I_BattlePlayerArmyIsAttacker
    and I_UnitEnemyUnitInRadius a1u1 60

    release_unit a1u1
    set_counter g_stop 0
end_monitor

;;;;;;;AI Stuck Fix

monitor_event BattleEnemyUnitAttacksPlayerUnit TrueCondition
    and I_CompareCounter ai_stuck_launch = 1
    and BattleIsMeleeAttack
    and I_BattleIsSiegeBattle
    set_counter ai_stuck_launch 2
end_monitor

monitor_conditions I_CompareCounter ai_stuck_launch = 2
    and I_BattleIsSiegeBattle

if I_CompareCounter enemy_unit_count > 0
and ! I_UnitDestroyed a2u1

    if I_UnitStatus a2u1 moving
    if I_CompareCounter a2u1_status = 0
    set_counter a2u1_status 1
    end_if
    if I_CompareCounter a2u1_status != 1
    set_counter a2u1_status 0
    end_if
    end_if

    if I_UnitStatus a2u1 routing
    if I_CompareCounter a2u1_status = 0
    set_counter a2u1_status 2
    end_if
    if I_CompareCounter a2u1_status != 2
    set_counter a2u1_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u1 moving
    and ! I_UnitStatus a2u1 routing
    set_counter a2u1_status 0
    end_if

    if I_CompareCounter a2u1_status > 0

    if I_UnitDistanceFromPosition a2u1 0,0 >= 150
    and I_UnitDistanceFromPosition a2u1 0,0 < 175
    if I_CompareCounter a2u1_distance != 1
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 1
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 175
    and I_UnitDistanceFromPosition a2u1 0,0 < 200
    if I_CompareCounter a2u1_distance != 2
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 2
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 200
    and I_UnitDistanceFromPosition a2u1 0,0 < 225
    if I_CompareCounter a2u1_distance != 3
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 3
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 225
    and I_UnitDistanceFromPosition a2u1 0,0 < 250
    if I_CompareCounter a2u1_distance != 4
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 4
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 250
    and I_UnitDistanceFromPosition a2u1 0,0 < 275
    if I_CompareCounter a2u1_distance != 5
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 5
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 275
    and I_UnitDistanceFromPosition a2u1 0,0 < 300
    if I_CompareCounter a2u1_distance != 6
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 6
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 300
    and I_UnitDistanceFromPosition a2u1 0,0 < 325
    if I_CompareCounter a2u1_distance != 7
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 7
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 325
    and I_UnitDistanceFromPosition a2u1 0,0 < 350
    if I_CompareCounter a2u1_distance != 8
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 8
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 350
    and I_UnitDistanceFromPosition a2u1 0,0 < 375
    if I_CompareCounter a2u1_distance != 9
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 9
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 375
    and I_UnitDistanceFromPosition a2u1 0,0 < 400
    if I_CompareCounter a2u1_distance != 10
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 10
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 400
    and I_UnitDistanceFromPosition a2u1 0,0 < 425
    if I_CompareCounter a2u1_distance != 11
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 11
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 425
    and I_UnitDistanceFromPosition a2u1 0,0 < 450
    if I_CompareCounter a2u1_distance != 12
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 12
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 450
    and I_UnitDistanceFromPosition a2u1 0,0 < 500
    if I_CompareCounter a2u1_distance != 13
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 13
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 500
    and I_UnitDistanceFromPosition a2u1 0,0 < 550
    if I_CompareCounter a2u1_distance != 14
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 14
    inc_counter a2u1_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u1 0,0 >= 550
    and I_UnitDistanceFromPosition a2u1 0,0 < 600
    if I_CompareCounter a2u1_distance != 15
    set_counter a2u1_stuck 0
    end_if
    set_counter a2u1_distance 15
    inc_counter a2u1_stuck 1
    end_if

    if I_CompareCounter a2u1_stuck = 4
    unit_order_halt a2u1
    unit_set_morale a2u1 wavering
    battle_wait 0.1
    unit_unset_morale a2u1
    release_unit a2u1
    set_counter a2u1_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 1
and ! I_UnitDestroyed a2u2

    if I_UnitStatus a2u2 moving
    if I_CompareCounter a2u2_status = 0
    set_counter a2u2_status 1
    end_if
    if I_CompareCounter a2u2_status != 1
    set_counter a2u2_status 0
    end_if
    end_if

    if I_UnitStatus a2u2 routing
    if I_CompareCounter a2u2_status = 0
    set_counter a2u2_status 2
    end_if
    if I_CompareCounter a2u2_status != 2
    set_counter a2u2_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u2 moving
    and ! I_UnitStatus a2u2 routing
    set_counter a2u2_status 0
    end_if

    if I_CompareCounter a2u2_status > 0

    if I_UnitDistanceFromPosition a2u2 0,0 >= 150
    and I_UnitDistanceFromPosition a2u2 0,0 < 175
    if I_CompareCounter a2u2_distance != 1
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 1
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 175
    and I_UnitDistanceFromPosition a2u2 0,0 < 200
    if I_CompareCounter a2u2_distance != 2
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 2
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 200
    and I_UnitDistanceFromPosition a2u2 0,0 < 225
    if I_CompareCounter a2u2_distance != 3
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 3
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 225
    and I_UnitDistanceFromPosition a2u2 0,0 < 250
    if I_CompareCounter a2u2_distance != 4
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 4
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 250
    and I_UnitDistanceFromPosition a2u2 0,0 < 275
    if I_CompareCounter a2u2_distance != 5
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 5
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 275
    and I_UnitDistanceFromPosition a2u2 0,0 < 300
    if I_CompareCounter a2u2_distance != 6
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 6
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 300
    and I_UnitDistanceFromPosition a2u2 0,0 < 325
    if I_CompareCounter a2u2_distance != 7
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 7
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 325
    and I_UnitDistanceFromPosition a2u2 0,0 < 350
    if I_CompareCounter a2u2_distance != 8
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 8
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 350
    and I_UnitDistanceFromPosition a2u2 0,0 < 375
    if I_CompareCounter a2u2_distance != 9
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 9
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 375
    and I_UnitDistanceFromPosition a2u2 0,0 < 400
    if I_CompareCounter a2u2_distance != 10
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 10
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 400
    and I_UnitDistanceFromPosition a2u2 0,0 < 425
    if I_CompareCounter a2u2_distance != 11
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 11
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 425
    and I_UnitDistanceFromPosition a2u2 0,0 < 450
    if I_CompareCounter a2u2_distance != 12
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 12
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 450
    and I_UnitDistanceFromPosition a2u2 0,0 < 500
    if I_CompareCounter a2u2_distance != 13
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 13
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 500
    and I_UnitDistanceFromPosition a2u2 0,0 < 550
    if I_CompareCounter a2u2_distance != 14
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 14
    inc_counter a2u2_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u2 0,0 >= 550
    and I_UnitDistanceFromPosition a2u2 0,0 < 600
    if I_CompareCounter a2u2_distance != 15
    set_counter a2u2_stuck 0
    end_if
    set_counter a2u2_distance 15
    inc_counter a2u2_stuck 1
    end_if

    if I_CompareCounter a2u2_stuck = 4
    unit_order_halt a2u2
    unit_set_morale a2u2 wavering
    battle_wait 0.1
    unit_unset_morale a2u2
    release_unit a2u2
    set_counter a2u2_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 2
and ! I_UnitDestroyed a2u3

    if I_UnitStatus a2u3 moving
    if I_CompareCounter a2u3_status = 0
    set_counter a2u3_status 1
    end_if
    if I_CompareCounter a2u3_status != 1
    set_counter a2u3_status 0
    end_if
    end_if

    if I_UnitStatus a2u3 routing
    if I_CompareCounter a2u3_status = 0
    set_counter a2u3_status 2
    end_if
    if I_CompareCounter a2u3_status != 2
    set_counter a2u3_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u3 moving
    and ! I_UnitStatus a2u3 routing
    set_counter a2u3_status 0
    end_if

    if I_CompareCounter a2u3_status > 0

    if I_UnitDistanceFromPosition a2u3 0,0 >= 150
    and I_UnitDistanceFromPosition a2u3 0,0 < 175
    if I_CompareCounter a2u3_distance != 1
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 1
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 175
    and I_UnitDistanceFromPosition a2u3 0,0 < 200
    if I_CompareCounter a2u3_distance != 2
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 2
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 200
    and I_UnitDistanceFromPosition a2u3 0,0 < 225
    if I_CompareCounter a2u3_distance != 3
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 3
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 225
    and I_UnitDistanceFromPosition a2u3 0,0 < 250
    if I_CompareCounter a2u3_distance != 4
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 4
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 250
    and I_UnitDistanceFromPosition a2u3 0,0 < 275
    if I_CompareCounter a2u3_distance != 5
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 5
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 275
    and I_UnitDistanceFromPosition a2u3 0,0 < 300
    if I_CompareCounter a2u3_distance != 6
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 6
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 300
    and I_UnitDistanceFromPosition a2u3 0,0 < 325
    if I_CompareCounter a2u3_distance != 7
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 7
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 325
    and I_UnitDistanceFromPosition a2u3 0,0 < 350
    if I_CompareCounter a2u3_distance != 8
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 8
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 350
    and I_UnitDistanceFromPosition a2u3 0,0 < 375
    if I_CompareCounter a2u3_distance != 9
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 9
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 375
    and I_UnitDistanceFromPosition a2u3 0,0 < 400
    if I_CompareCounter a2u3_distance != 10
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 10
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 400
    and I_UnitDistanceFromPosition a2u3 0,0 < 425
    if I_CompareCounter a2u3_distance != 11
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 11
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 425
    and I_UnitDistanceFromPosition a2u3 0,0 < 450
    if I_CompareCounter a2u3_distance != 12
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 12
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 450
    and I_UnitDistanceFromPosition a2u3 0,0 < 500
    if I_CompareCounter a2u3_distance != 13
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 13
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 500
    and I_UnitDistanceFromPosition a2u3 0,0 < 550
    if I_CompareCounter a2u3_distance != 14
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 14
    inc_counter a2u3_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u3 0,0 >= 550
    and I_UnitDistanceFromPosition a2u3 0,0 < 600
    if I_CompareCounter a2u3_distance != 15
    set_counter a2u3_stuck 0
    end_if
    set_counter a2u3_distance 15
    inc_counter a2u3_stuck 1
    end_if

    if I_CompareCounter a2u3_stuck = 4
    unit_order_halt a2u3
    unit_set_morale a2u3 wavering
    battle_wait 0.1
    unit_unset_morale a2u3
    release_unit a2u3
    set_counter a2u3_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 3
and ! I_UnitDestroyed a2u4

    if I_UnitStatus a2u4 moving
    if I_CompareCounter a2u4_status = 0
    set_counter a2u4_status 1
    end_if
    if I_CompareCounter a2u4_status != 1
    set_counter a2u4_status 0
    end_if
    end_if

    if I_UnitStatus a2u4 routing
    if I_CompareCounter a2u4_status = 0
    set_counter a2u4_status 2
    end_if
    if I_CompareCounter a2u4_status != 2
    set_counter a2u4_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u4 moving
    and ! I_UnitStatus a2u4 routing
    set_counter a2u4_status 0
    end_if

    if I_CompareCounter a2u4_status > 0

    if I_UnitDistanceFromPosition a2u4 0,0 >= 150
    and I_UnitDistanceFromPosition a2u4 0,0 < 175
    if I_CompareCounter a2u4_distance != 1
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 1
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 175
    and I_UnitDistanceFromPosition a2u4 0,0 < 200
    if I_CompareCounter a2u4_distance != 2
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 2
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 200
    and I_UnitDistanceFromPosition a2u4 0,0 < 225
    if I_CompareCounter a2u4_distance != 3
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 3
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 225
    and I_UnitDistanceFromPosition a2u4 0,0 < 250
    if I_CompareCounter a2u4_distance != 4
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 4
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 250
    and I_UnitDistanceFromPosition a2u4 0,0 < 275
    if I_CompareCounter a2u4_distance != 5
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 5
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 275
    and I_UnitDistanceFromPosition a2u4 0,0 < 300
    if I_CompareCounter a2u4_distance != 6
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 6
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 300
    and I_UnitDistanceFromPosition a2u4 0,0 < 325
    if I_CompareCounter a2u4_distance != 7
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 7
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 325
    and I_UnitDistanceFromPosition a2u4 0,0 < 350
    if I_CompareCounter a2u4_distance != 8
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 8
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 350
    and I_UnitDistanceFromPosition a2u4 0,0 < 375
    if I_CompareCounter a2u4_distance != 9
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 9
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 375
    and I_UnitDistanceFromPosition a2u4 0,0 < 400
    if I_CompareCounter a2u4_distance != 10
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 10
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 400
    and I_UnitDistanceFromPosition a2u4 0,0 < 425
    if I_CompareCounter a2u4_distance != 11
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 11
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 425
    and I_UnitDistanceFromPosition a2u4 0,0 < 450
    if I_CompareCounter a2u4_distance != 12
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 12
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 450
    and I_UnitDistanceFromPosition a2u4 0,0 < 500
    if I_CompareCounter a2u4_distance != 13
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 13
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 500
    and I_UnitDistanceFromPosition a2u4 0,0 < 550
    if I_CompareCounter a2u4_distance != 14
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 14
    inc_counter a2u4_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u4 0,0 >= 550
    and I_UnitDistanceFromPosition a2u4 0,0 < 600
    if I_CompareCounter a2u4_distance != 15
    set_counter a2u4_stuck 0
    end_if
    set_counter a2u4_distance 15
    inc_counter a2u4_stuck 1
    end_if

    if I_CompareCounter a2u4_stuck = 4
    unit_order_halt a2u4
    unit_set_morale a2u4 wavering
    battle_wait 0.1
    unit_unset_morale a2u4
    release_unit a2u4
    set_counter a2u4_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 4
and ! I_UnitDestroyed a2u5

    if I_UnitStatus a2u5 moving
    if I_CompareCounter a2u5_status = 0
    set_counter a2u5_status 1
    end_if
    if I_CompareCounter a2u5_status != 1
    set_counter a2u5_status 0
    end_if
    end_if

    if I_UnitStatus a2u5 routing
    if I_CompareCounter a2u5_status = 0
    set_counter a2u5_status 2
    end_if
    if I_CompareCounter a2u5_status != 2
    set_counter a2u5_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u5 moving
    and ! I_UnitStatus a2u5 routing
    set_counter a2u5_status 0
    end_if

    if I_CompareCounter a2u5_status > 0

    if I_UnitDistanceFromPosition a2u5 0,0 >= 150
    and I_UnitDistanceFromPosition a2u5 0,0 < 175
    if I_CompareCounter a2u5_distance != 1
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 1
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 175
    and I_UnitDistanceFromPosition a2u5 0,0 < 200
    if I_CompareCounter a2u5_distance != 2
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 2
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 200
    and I_UnitDistanceFromPosition a2u5 0,0 < 225
    if I_CompareCounter a2u5_distance != 3
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 3
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 225
    and I_UnitDistanceFromPosition a2u5 0,0 < 250
    if I_CompareCounter a2u5_distance != 4
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 4
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 250
    and I_UnitDistanceFromPosition a2u5 0,0 < 275
    if I_CompareCounter a2u5_distance != 5
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 5
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 275
    and I_UnitDistanceFromPosition a2u5 0,0 < 300
    if I_CompareCounter a2u5_distance != 6
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 6
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 300
    and I_UnitDistanceFromPosition a2u5 0,0 < 325
    if I_CompareCounter a2u5_distance != 7
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 7
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 325
    and I_UnitDistanceFromPosition a2u5 0,0 < 350
    if I_CompareCounter a2u5_distance != 8
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 8
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 350
    and I_UnitDistanceFromPosition a2u5 0,0 < 375
    if I_CompareCounter a2u5_distance != 9
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 9
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 375
    and I_UnitDistanceFromPosition a2u5 0,0 < 400
    if I_CompareCounter a2u5_distance != 10
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 10
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 400
    and I_UnitDistanceFromPosition a2u5 0,0 < 425
    if I_CompareCounter a2u5_distance != 11
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 11
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 425
    and I_UnitDistanceFromPosition a2u5 0,0 < 450
    if I_CompareCounter a2u5_distance != 12
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 12
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 450
    and I_UnitDistanceFromPosition a2u5 0,0 < 500
    if I_CompareCounter a2u5_distance != 13
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 13
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 500
    and I_UnitDistanceFromPosition a2u5 0,0 < 550
    if I_CompareCounter a2u5_distance != 14
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 14
    inc_counter a2u5_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u5 0,0 >= 550
    and I_UnitDistanceFromPosition a2u5 0,0 < 600
    if I_CompareCounter a2u5_distance != 15
    set_counter a2u5_stuck 0
    end_if
    set_counter a2u5_distance 15
    inc_counter a2u5_stuck 1
    end_if

    if I_CompareCounter a2u5_stuck = 4
    unit_order_halt a2u5
    unit_set_morale a2u5 wavering
    battle_wait 0.1
    unit_unset_morale a2u5
    release_unit a2u5
    set_counter a2u5_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 5
and ! I_UnitDestroyed a2u6

    if I_UnitStatus a2u6 moving
    if I_CompareCounter a2u6_status = 0
    set_counter a2u6_status 1
    end_if
    if I_CompareCounter a2u6_status != 1
    set_counter a2u6_status 0
    end_if
    end_if

    if I_UnitStatus a2u6 routing
    if I_CompareCounter a2u6_status = 0
    set_counter a2u6_status 2
    end_if
    if I_CompareCounter a2u6_status != 2
    set_counter a2u6_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u6 moving
    and ! I_UnitStatus a2u6 routing
    set_counter a2u6_status 0
    end_if

    if I_CompareCounter a2u6_status > 0

    if I_UnitDistanceFromPosition a2u6 0,0 >= 150
    and I_UnitDistanceFromPosition a2u6 0,0 < 175
    if I_CompareCounter a2u6_distance != 1
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 1
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 175
    and I_UnitDistanceFromPosition a2u6 0,0 < 200
    if I_CompareCounter a2u6_distance != 2
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 2
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 200
    and I_UnitDistanceFromPosition a2u6 0,0 < 225
    if I_CompareCounter a2u6_distance != 3
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 3
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 225
    and I_UnitDistanceFromPosition a2u6 0,0 < 250
    if I_CompareCounter a2u6_distance != 4
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 4
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 250
    and I_UnitDistanceFromPosition a2u6 0,0 < 275
    if I_CompareCounter a2u6_distance != 5
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 5
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 275
    and I_UnitDistanceFromPosition a2u6 0,0 < 300
    if I_CompareCounter a2u6_distance != 6
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 6
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 300
    and I_UnitDistanceFromPosition a2u6 0,0 < 325
    if I_CompareCounter a2u6_distance != 7
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 7
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 325
    and I_UnitDistanceFromPosition a2u6 0,0 < 350
    if I_CompareCounter a2u6_distance != 8
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 8
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 350
    and I_UnitDistanceFromPosition a2u6 0,0 < 375
    if I_CompareCounter a2u6_distance != 9
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 9
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 375
    and I_UnitDistanceFromPosition a2u6 0,0 < 400
    if I_CompareCounter a2u6_distance != 10
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 10
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 400
    and I_UnitDistanceFromPosition a2u6 0,0 < 425
    if I_CompareCounter a2u6_distance != 11
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 11
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 425
    and I_UnitDistanceFromPosition a2u6 0,0 < 450
    if I_CompareCounter a2u6_distance != 12
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 12
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 450
    and I_UnitDistanceFromPosition a2u6 0,0 < 500
    if I_CompareCounter a2u6_distance != 13
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 13
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 500
    and I_UnitDistanceFromPosition a2u6 0,0 < 550
    if I_CompareCounter a2u6_distance != 14
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 14
    inc_counter a2u6_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u6 0,0 >= 550
    and I_UnitDistanceFromPosition a2u6 0,0 < 600
    if I_CompareCounter a2u6_distance != 15
    set_counter a2u6_stuck 0
    end_if
    set_counter a2u6_distance 15
    inc_counter a2u6_stuck 1
    end_if

    if I_CompareCounter a2u6_stuck = 4
    unit_order_halt a2u6
    unit_set_morale a2u6 wavering
    battle_wait 0.1
    unit_unset_morale a2u6
    release_unit a2u6
    set_counter a2u6_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 6
and ! I_UnitDestroyed a2u7

    if I_UnitStatus a2u7 moving
    if I_CompareCounter a2u7_status = 0
    set_counter a2u7_status 1
    end_if
    if I_CompareCounter a2u7_status != 1
    set_counter a2u7_status 0
    end_if
    end_if

    if I_UnitStatus a2u7 routing
    if I_CompareCounter a2u7_status = 0
    set_counter a2u7_status 2
    end_if
    if I_CompareCounter a2u7_status != 2
    set_counter a2u7_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u7 moving
    and ! I_UnitStatus a2u7 routing
    set_counter a2u7_status 0
    end_if

    if I_CompareCounter a2u7_status > 0

    if I_UnitDistanceFromPosition a2u7 0,0 >= 150
    and I_UnitDistanceFromPosition a2u7 0,0 < 175
    if I_CompareCounter a2u7_distance != 1
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 1
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 175
    and I_UnitDistanceFromPosition a2u7 0,0 < 200
    if I_CompareCounter a2u7_distance != 2
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 2
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 200
    and I_UnitDistanceFromPosition a2u7 0,0 < 225
    if I_CompareCounter a2u7_distance != 3
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 3
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 225
    and I_UnitDistanceFromPosition a2u7 0,0 < 250
    if I_CompareCounter a2u7_distance != 4
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 4
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 250
    and I_UnitDistanceFromPosition a2u7 0,0 < 275
    if I_CompareCounter a2u7_distance != 5
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 5
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 275
    and I_UnitDistanceFromPosition a2u7 0,0 < 300
    if I_CompareCounter a2u7_distance != 6
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 6
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 300
    and I_UnitDistanceFromPosition a2u7 0,0 < 325
    if I_CompareCounter a2u7_distance != 7
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 7
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 325
    and I_UnitDistanceFromPosition a2u7 0,0 < 350
    if I_CompareCounter a2u7_distance != 8
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 8
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 350
    and I_UnitDistanceFromPosition a2u7 0,0 < 375
    if I_CompareCounter a2u7_distance != 9
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 9
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 375
    and I_UnitDistanceFromPosition a2u7 0,0 < 400
    if I_CompareCounter a2u7_distance != 10
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 10
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 400
    and I_UnitDistanceFromPosition a2u7 0,0 < 425
    if I_CompareCounter a2u7_distance != 11
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 11
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 425
    and I_UnitDistanceFromPosition a2u7 0,0 < 450
    if I_CompareCounter a2u7_distance != 12
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 12
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 450
    and I_UnitDistanceFromPosition a2u7 0,0 < 500
    if I_CompareCounter a2u7_distance != 13
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 13
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 500
    and I_UnitDistanceFromPosition a2u7 0,0 < 550
    if I_CompareCounter a2u7_distance != 14
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 14
    inc_counter a2u7_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u7 0,0 >= 550
    and I_UnitDistanceFromPosition a2u7 0,0 < 600
    if I_CompareCounter a2u7_distance != 15
    set_counter a2u7_stuck 0
    end_if
    set_counter a2u7_distance 15
    inc_counter a2u7_stuck 1
    end_if

    if I_CompareCounter a2u7_stuck = 4
    unit_order_halt a2u7
    unit_set_morale a2u7 wavering
    battle_wait 0.1
    unit_unset_morale a2u7
    release_unit a2u7
    set_counter a2u7_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 7
and ! I_UnitDestroyed a2u8

    if I_UnitStatus a2u8 moving
    if I_CompareCounter a2u8_status = 0
    set_counter a2u8_status 1
    end_if
    if I_CompareCounter a2u8_status != 1
    set_counter a2u8_status 0
    end_if
    end_if

    if I_UnitStatus a2u8 routing
    if I_CompareCounter a2u8_status = 0
    set_counter a2u8_status 2
    end_if
    if I_CompareCounter a2u8_status != 2
    set_counter a2u8_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u8 moving
    and ! I_UnitStatus a2u8 routing
    set_counter a2u8_status 0
    end_if

    if I_CompareCounter a2u8_status > 0

    if I_UnitDistanceFromPosition a2u8 0,0 >= 150
    and I_UnitDistanceFromPosition a2u8 0,0 < 175
    if I_CompareCounter a2u8_distance != 1
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 1
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 175
    and I_UnitDistanceFromPosition a2u8 0,0 < 200
    if I_CompareCounter a2u8_distance != 2
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 2
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 200
    and I_UnitDistanceFromPosition a2u8 0,0 < 225
    if I_CompareCounter a2u8_distance != 3
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 3
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 225
    and I_UnitDistanceFromPosition a2u8 0,0 < 250
    if I_CompareCounter a2u8_distance != 4
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 4
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 250
    and I_UnitDistanceFromPosition a2u8 0,0 < 275
    if I_CompareCounter a2u8_distance != 5
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 5
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 275
    and I_UnitDistanceFromPosition a2u8 0,0 < 300
    if I_CompareCounter a2u8_distance != 6
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 6
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 300
    and I_UnitDistanceFromPosition a2u8 0,0 < 325
    if I_CompareCounter a2u8_distance != 7
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 7
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 325
    and I_UnitDistanceFromPosition a2u8 0,0 < 350
    if I_CompareCounter a2u8_distance != 8
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 8
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 350
    and I_UnitDistanceFromPosition a2u8 0,0 < 375
    if I_CompareCounter a2u8_distance != 9
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 9
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 375
    and I_UnitDistanceFromPosition a2u8 0,0 < 400
    if I_CompareCounter a2u8_distance != 10
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 10
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 400
    and I_UnitDistanceFromPosition a2u8 0,0 < 425
    if I_CompareCounter a2u8_distance != 11
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 11
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 425
    and I_UnitDistanceFromPosition a2u8 0,0 < 450
    if I_CompareCounter a2u8_distance != 12
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 12
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 450
    and I_UnitDistanceFromPosition a2u8 0,0 < 500
    if I_CompareCounter a2u8_distance != 13
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 13
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 500
    and I_UnitDistanceFromPosition a2u8 0,0 < 550
    if I_CompareCounter a2u8_distance != 14
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 14
    inc_counter a2u8_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u8 0,0 >= 550
    and I_UnitDistanceFromPosition a2u8 0,0 < 600
    if I_CompareCounter a2u8_distance != 15
    set_counter a2u8_stuck 0
    end_if
    set_counter a2u8_distance 15
    inc_counter a2u8_stuck 1
    end_if

    if I_CompareCounter a2u8_stuck = 4
    unit_order_halt a2u8
    unit_set_morale a2u8 wavering
    battle_wait 0.1
    unit_unset_morale a2u8
    release_unit a2u8
    set_counter a2u8_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 8
and ! I_UnitDestroyed a2u9

    if I_UnitStatus a2u9 moving
    if I_CompareCounter a2u9_status = 0
    set_counter a2u9_status 1
    end_if
    if I_CompareCounter a2u9_status != 1
    set_counter a2u9_status 0
    end_if
    end_if

    if I_UnitStatus a2u9 routing
    if I_CompareCounter a2u9_status = 0
    set_counter a2u9_status 2
    end_if
    if I_CompareCounter a2u9_status != 2
    set_counter a2u9_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u9 moving
    and ! I_UnitStatus a2u9 routing
    set_counter a2u9_status 0
    end_if

    if I_CompareCounter a2u9_status > 0

    if I_UnitDistanceFromPosition a2u9 0,0 >= 150
    and I_UnitDistanceFromPosition a2u9 0,0 < 175
    if I_CompareCounter a2u9_distance != 1
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 1
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 175
    and I_UnitDistanceFromPosition a2u9 0,0 < 200
    if I_CompareCounter a2u9_distance != 2
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 2
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 200
    and I_UnitDistanceFromPosition a2u9 0,0 < 225
    if I_CompareCounter a2u9_distance != 3
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 3
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 225
    and I_UnitDistanceFromPosition a2u9 0,0 < 250
    if I_CompareCounter a2u9_distance != 4
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 4
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 250
    and I_UnitDistanceFromPosition a2u9 0,0 < 275
    if I_CompareCounter a2u9_distance != 5
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 5
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 275
    and I_UnitDistanceFromPosition a2u9 0,0 < 300
    if I_CompareCounter a2u9_distance != 6
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 6
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 300
    and I_UnitDistanceFromPosition a2u9 0,0 < 325
    if I_CompareCounter a2u9_distance != 7
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 7
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 325
    and I_UnitDistanceFromPosition a2u9 0,0 < 350
    if I_CompareCounter a2u9_distance != 8
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 8
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 350
    and I_UnitDistanceFromPosition a2u9 0,0 < 375
    if I_CompareCounter a2u9_distance != 9
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 9
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 375
    and I_UnitDistanceFromPosition a2u9 0,0 < 400
    if I_CompareCounter a2u9_distance != 10
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 10
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 400
    and I_UnitDistanceFromPosition a2u9 0,0 < 425
    if I_CompareCounter a2u9_distance != 11
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 11
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 425
    and I_UnitDistanceFromPosition a2u9 0,0 < 450
    if I_CompareCounter a2u9_distance != 12
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 12
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 450
    and I_UnitDistanceFromPosition a2u9 0,0 < 500
    if I_CompareCounter a2u9_distance != 13
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 13
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 500
    and I_UnitDistanceFromPosition a2u9 0,0 < 550
    if I_CompareCounter a2u9_distance != 14
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 14
    inc_counter a2u9_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u9 0,0 >= 550
    and I_UnitDistanceFromPosition a2u9 0,0 < 600
    if I_CompareCounter a2u9_distance != 15
    set_counter a2u9_stuck 0
    end_if
    set_counter a2u9_distance 15
    inc_counter a2u9_stuck 1
    end_if

    if I_CompareCounter a2u9_stuck = 4
    unit_order_halt a2u9
    unit_set_morale a2u9 wavering
    battle_wait 0.1
    unit_unset_morale a2u9
    release_unit a2u9
    set_counter a2u9_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 9
and ! I_UnitDestroyed a2u10

    if I_UnitStatus a2u10 moving
    if I_CompareCounter a2u10_status = 0
    set_counter a2u10_status 1
    end_if
    if I_CompareCounter a2u10_status != 1
    set_counter a2u10_status 0
    end_if
    end_if

    if I_UnitStatus a2u10 routing
    if I_CompareCounter a2u10_status = 0
    set_counter a2u10_status 2
    end_if
    if I_CompareCounter a2u10_status != 2
    set_counter a2u10_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u10 moving
    and ! I_UnitStatus a2u10 routing
    set_counter a2u10_status 0
    end_if

    if I_CompareCounter a2u10_status > 0

    if I_UnitDistanceFromPosition a2u10 0,0 >= 150
    and I_UnitDistanceFromPosition a2u10 0,0 < 175
    if I_CompareCounter a2u10_distance != 1
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 1
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 175
    and I_UnitDistanceFromPosition a2u10 0,0 < 200
    if I_CompareCounter a2u10_distance != 2
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 2
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 200
    and I_UnitDistanceFromPosition a2u10 0,0 < 225
    if I_CompareCounter a2u10_distance != 3
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 3
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 225
    and I_UnitDistanceFromPosition a2u10 0,0 < 250
    if I_CompareCounter a2u10_distance != 4
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 4
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 250
    and I_UnitDistanceFromPosition a2u10 0,0 < 275
    if I_CompareCounter a2u10_distance != 5
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 5
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 275
    and I_UnitDistanceFromPosition a2u10 0,0 < 300
    if I_CompareCounter a2u10_distance != 6
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 6
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 300
    and I_UnitDistanceFromPosition a2u10 0,0 < 325
    if I_CompareCounter a2u10_distance != 7
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 7
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 325
    and I_UnitDistanceFromPosition a2u10 0,0 < 350
    if I_CompareCounter a2u10_distance != 8
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 8
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 350
    and I_UnitDistanceFromPosition a2u10 0,0 < 375
    if I_CompareCounter a2u10_distance != 9
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 9
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 375
    and I_UnitDistanceFromPosition a2u10 0,0 < 400
    if I_CompareCounter a2u10_distance != 10
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 10
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 400
    and I_UnitDistanceFromPosition a2u10 0,0 < 425
    if I_CompareCounter a2u10_distance != 11
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 11
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 425
    and I_UnitDistanceFromPosition a2u10 0,0 < 450
    if I_CompareCounter a2u10_distance != 12
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 12
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 450
    and I_UnitDistanceFromPosition a2u10 0,0 < 500
    if I_CompareCounter a2u10_distance != 13
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 13
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 500
    and I_UnitDistanceFromPosition a2u10 0,0 < 550
    if I_CompareCounter a2u10_distance != 14
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 14
    inc_counter a2u10_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u10 0,0 >= 550
    and I_UnitDistanceFromPosition a2u10 0,0 < 600
    if I_CompareCounter a2u10_distance != 15
    set_counter a2u10_stuck 0
    end_if
    set_counter a2u10_distance 15
    inc_counter a2u10_stuck 1
    end_if

    if I_CompareCounter a2u10_stuck = 4
    unit_order_halt a2u10
    unit_set_morale a2u10 wavering
    battle_wait 0.1
    unit_unset_morale a2u10
    release_unit a2u10
    set_counter a2u10_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 10
and ! I_UnitDestroyed a2u11

    if I_UnitStatus a2u11 moving
    if I_CompareCounter a2u11_status = 0
    set_counter a2u11_status 1
    end_if
    if I_CompareCounter a2u11_status != 1
    set_counter a2u11_status 0
    end_if
    end_if

    if I_UnitStatus a2u11 routing
    if I_CompareCounter a2u11_status = 0
    set_counter a2u11_status 2
    end_if
    if I_CompareCounter a2u11_status != 2
    set_counter a2u11_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u11 moving
    and ! I_UnitStatus a2u11 routing
    set_counter a2u11_status 0
    end_if

    if I_CompareCounter a2u11_status > 0

    if I_UnitDistanceFromPosition a2u11 0,0 >= 150
    and I_UnitDistanceFromPosition a2u11 0,0 < 175
    if I_CompareCounter a2u11_distance != 1
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 1
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 175
    and I_UnitDistanceFromPosition a2u11 0,0 < 200
    if I_CompareCounter a2u11_distance != 2
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 2
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 200
    and I_UnitDistanceFromPosition a2u11 0,0 < 225
    if I_CompareCounter a2u11_distance != 3
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 3
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 225
    and I_UnitDistanceFromPosition a2u11 0,0 < 250
    if I_CompareCounter a2u11_distance != 4
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 4
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 250
    and I_UnitDistanceFromPosition a2u11 0,0 < 275
    if I_CompareCounter a2u11_distance != 5
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 5
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 275
    and I_UnitDistanceFromPosition a2u11 0,0 < 300
    if I_CompareCounter a2u11_distance != 6
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 6
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 300
    and I_UnitDistanceFromPosition a2u11 0,0 < 325
    if I_CompareCounter a2u11_distance != 7
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 7
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 325
    and I_UnitDistanceFromPosition a2u11 0,0 < 350
    if I_CompareCounter a2u11_distance != 8
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 8
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 350
    and I_UnitDistanceFromPosition a2u11 0,0 < 375
    if I_CompareCounter a2u11_distance != 9
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 9
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 375
    and I_UnitDistanceFromPosition a2u11 0,0 < 400
    if I_CompareCounter a2u11_distance != 10
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 10
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 400
    and I_UnitDistanceFromPosition a2u11 0,0 < 425
    if I_CompareCounter a2u11_distance != 11
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 11
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 425
    and I_UnitDistanceFromPosition a2u11 0,0 < 450
    if I_CompareCounter a2u11_distance != 12
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 12
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 450
    and I_UnitDistanceFromPosition a2u11 0,0 < 500
    if I_CompareCounter a2u11_distance != 13
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 13
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 500
    and I_UnitDistanceFromPosition a2u11 0,0 < 550
    if I_CompareCounter a2u11_distance != 14
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 14
    inc_counter a2u11_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u11 0,0 >= 550
    and I_UnitDistanceFromPosition a2u11 0,0 < 600
    if I_CompareCounter a2u11_distance != 15
    set_counter a2u11_stuck 0
    end_if
    set_counter a2u11_distance 15
    inc_counter a2u11_stuck 1
    end_if

    if I_CompareCounter a2u11_stuck = 4
    unit_order_halt a2u11
    unit_set_morale a2u11 wavering
    battle_wait 0.1
    unit_unset_morale a2u11
    release_unit a2u11
    set_counter a2u11_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 11
and ! I_UnitDestroyed a2u12

    if I_UnitStatus a2u12 moving
    if I_CompareCounter a2u12_status = 0
    set_counter a2u12_status 1
    end_if
    if I_CompareCounter a2u12_status != 1
    set_counter a2u12_status 0
    end_if
    end_if

    if I_UnitStatus a2u12 routing
    if I_CompareCounter a2u12_status = 0
    set_counter a2u12_status 2
    end_if
    if I_CompareCounter a2u12_status != 2
    set_counter a2u12_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u12 moving
    and ! I_UnitStatus a2u12 routing
    set_counter a2u12_status 0
    end_if

    if I_CompareCounter a2u12_status > 0

    if I_UnitDistanceFromPosition a2u12 0,0 >= 150
    and I_UnitDistanceFromPosition a2u12 0,0 < 175
    if I_CompareCounter a2u12_distance != 1
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 1
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 175
    and I_UnitDistanceFromPosition a2u12 0,0 < 200
    if I_CompareCounter a2u12_distance != 2
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 2
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 200
    and I_UnitDistanceFromPosition a2u12 0,0 < 225
    if I_CompareCounter a2u12_distance != 3
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 3
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 225
    and I_UnitDistanceFromPosition a2u12 0,0 < 250
    if I_CompareCounter a2u12_distance != 4
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 4
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 250
    and I_UnitDistanceFromPosition a2u12 0,0 < 275
    if I_CompareCounter a2u12_distance != 5
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 5
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 275
    and I_UnitDistanceFromPosition a2u12 0,0 < 300
    if I_CompareCounter a2u12_distance != 6
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 6
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 300
    and I_UnitDistanceFromPosition a2u12 0,0 < 325
    if I_CompareCounter a2u12_distance != 7
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 7
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 325
    and I_UnitDistanceFromPosition a2u12 0,0 < 350
    if I_CompareCounter a2u12_distance != 8
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 8
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 350
    and I_UnitDistanceFromPosition a2u12 0,0 < 375
    if I_CompareCounter a2u12_distance != 9
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 9
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 375
    and I_UnitDistanceFromPosition a2u12 0,0 < 400
    if I_CompareCounter a2u12_distance != 10
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 10
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 400
    and I_UnitDistanceFromPosition a2u12 0,0 < 425
    if I_CompareCounter a2u12_distance != 11
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 11
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 425
    and I_UnitDistanceFromPosition a2u12 0,0 < 450
    if I_CompareCounter a2u12_distance != 12
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 12
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 450
    and I_UnitDistanceFromPosition a2u12 0,0 < 500
    if I_CompareCounter a2u12_distance != 13
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 13
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 500
    and I_UnitDistanceFromPosition a2u12 0,0 < 550
    if I_CompareCounter a2u12_distance != 14
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 14
    inc_counter a2u12_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u12 0,0 >= 550
    and I_UnitDistanceFromPosition a2u12 0,0 < 600
    if I_CompareCounter a2u12_distance != 15
    set_counter a2u12_stuck 0
    end_if
    set_counter a2u12_distance 15
    inc_counter a2u12_stuck 1
    end_if

    if I_CompareCounter a2u12_stuck = 4
    unit_order_halt a2u12
    unit_set_morale a2u12 wavering
    battle_wait 0.1
    unit_unset_morale a2u12
    release_unit a2u12
    set_counter a2u12_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 12
and ! I_UnitDestroyed a2u13

    if I_UnitStatus a2u13 moving
    if I_CompareCounter a2u13_status = 0
    set_counter a2u13_status 1
    end_if
    if I_CompareCounter a2u13_status != 1
    set_counter a2u13_status 0
    end_if
    end_if

    if I_UnitStatus a2u13 routing
    if I_CompareCounter a2u13_status = 0
    set_counter a2u13_status 2
    end_if
    if I_CompareCounter a2u13_status != 2
    set_counter a2u13_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u13 moving
    and ! I_UnitStatus a2u13 routing
    set_counter a2u13_status 0
    end_if

    if I_CompareCounter a2u13_status > 0

    if I_UnitDistanceFromPosition a2u13 0,0 >= 150
    and I_UnitDistanceFromPosition a2u13 0,0 < 175
    if I_CompareCounter a2u13_distance != 1
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 1
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 175
    and I_UnitDistanceFromPosition a2u13 0,0 < 200
    if I_CompareCounter a2u13_distance != 2
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 2
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 200
    and I_UnitDistanceFromPosition a2u13 0,0 < 225
    if I_CompareCounter a2u13_distance != 3
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 3
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 225
    and I_UnitDistanceFromPosition a2u13 0,0 < 250
    if I_CompareCounter a2u13_distance != 4
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 4
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 250
    and I_UnitDistanceFromPosition a2u13 0,0 < 275
    if I_CompareCounter a2u13_distance != 5
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 5
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 275
    and I_UnitDistanceFromPosition a2u13 0,0 < 300
    if I_CompareCounter a2u13_distance != 6
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 6
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 300
    and I_UnitDistanceFromPosition a2u13 0,0 < 325
    if I_CompareCounter a2u13_distance != 7
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 7
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 325
    and I_UnitDistanceFromPosition a2u13 0,0 < 350
    if I_CompareCounter a2u13_distance != 8
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 8
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 350
    and I_UnitDistanceFromPosition a2u13 0,0 < 375
    if I_CompareCounter a2u13_distance != 9
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 9
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 375
    and I_UnitDistanceFromPosition a2u13 0,0 < 400
    if I_CompareCounter a2u13_distance != 10
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 10
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 400
    and I_UnitDistanceFromPosition a2u13 0,0 < 425
    if I_CompareCounter a2u13_distance != 11
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 11
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 425
    and I_UnitDistanceFromPosition a2u13 0,0 < 450
    if I_CompareCounter a2u13_distance != 12
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 12
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 450
    and I_UnitDistanceFromPosition a2u13 0,0 < 500
    if I_CompareCounter a2u13_distance != 13
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 13
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 500
    and I_UnitDistanceFromPosition a2u13 0,0 < 550
    if I_CompareCounter a2u13_distance != 14
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 14
    inc_counter a2u13_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u13 0,0 >= 550
    and I_UnitDistanceFromPosition a2u13 0,0 < 600
    if I_CompareCounter a2u13_distance != 15
    set_counter a2u13_stuck 0
    end_if
    set_counter a2u13_distance 15
    inc_counter a2u13_stuck 1
    end_if

    if I_CompareCounter a2u13_stuck = 4
    unit_order_halt a2u13
    unit_set_morale a2u13 wavering
    battle_wait 0.1
    unit_unset_morale a2u13
    release_unit a2u13
    set_counter a2u13_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 13
and ! I_UnitDestroyed a2u14

    if I_UnitStatus a2u14 moving
    if I_CompareCounter a2u14_status = 0
    set_counter a2u14_status 1
    end_if
    if I_CompareCounter a2u14_status != 1
    set_counter a2u14_status 0
    end_if
    end_if

    if I_UnitStatus a2u14 routing
    if I_CompareCounter a2u14_status = 0
    set_counter a2u14_status 2
    end_if
    if I_CompareCounter a2u14_status != 2
    set_counter a2u14_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u14 moving
    and ! I_UnitStatus a2u14 routing
    set_counter a2u14_status 0
    end_if

    if I_CompareCounter a2u14_status > 0

    if I_UnitDistanceFromPosition a2u14 0,0 >= 150
    and I_UnitDistanceFromPosition a2u14 0,0 < 175
    if I_CompareCounter a2u14_distance != 1
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 1
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 175
    and I_UnitDistanceFromPosition a2u14 0,0 < 200
    if I_CompareCounter a2u14_distance != 2
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 2
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 200
    and I_UnitDistanceFromPosition a2u14 0,0 < 225
    if I_CompareCounter a2u14_distance != 3
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 3
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 225
    and I_UnitDistanceFromPosition a2u14 0,0 < 250
    if I_CompareCounter a2u14_distance != 4
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 4
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 250
    and I_UnitDistanceFromPosition a2u14 0,0 < 275
    if I_CompareCounter a2u14_distance != 5
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 5
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 275
    and I_UnitDistanceFromPosition a2u14 0,0 < 300
    if I_CompareCounter a2u14_distance != 6
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 6
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 300
    and I_UnitDistanceFromPosition a2u14 0,0 < 325
    if I_CompareCounter a2u14_distance != 7
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 7
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 325
    and I_UnitDistanceFromPosition a2u14 0,0 < 350
    if I_CompareCounter a2u14_distance != 8
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 8
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 350
    and I_UnitDistanceFromPosition a2u14 0,0 < 375
    if I_CompareCounter a2u14_distance != 9
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 9
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 375
    and I_UnitDistanceFromPosition a2u14 0,0 < 400
    if I_CompareCounter a2u14_distance != 10
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 10
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 400
    and I_UnitDistanceFromPosition a2u14 0,0 < 425
    if I_CompareCounter a2u14_distance != 11
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 11
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 425
    and I_UnitDistanceFromPosition a2u14 0,0 < 450
    if I_CompareCounter a2u14_distance != 12
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 12
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 450
    and I_UnitDistanceFromPosition a2u14 0,0 < 500
    if I_CompareCounter a2u14_distance != 13
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 13
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 500
    and I_UnitDistanceFromPosition a2u14 0,0 < 550
    if I_CompareCounter a2u14_distance != 14
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 14
    inc_counter a2u14_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u14 0,0 >= 550
    and I_UnitDistanceFromPosition a2u14 0,0 < 600
    if I_CompareCounter a2u14_distance != 15
    set_counter a2u14_stuck 0
    end_if
    set_counter a2u14_distance 15
    inc_counter a2u14_stuck 1
    end_if

    if I_CompareCounter a2u14_stuck = 4
    unit_order_halt a2u14
    unit_set_morale a2u14 wavering
    battle_wait 0.1
    unit_unset_morale a2u14
    release_unit a2u14
    set_counter a2u14_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 14
and ! I_UnitDestroyed a2u15

    if I_UnitStatus a2u15 moving
    if I_CompareCounter a2u15_status = 0
    set_counter a2u15_status 1
    end_if
    if I_CompareCounter a2u15_status != 1
    set_counter a2u15_status 0
    end_if
    end_if

    if I_UnitStatus a2u15 routing
    if I_CompareCounter a2u15_status = 0
    set_counter a2u15_status 2
    end_if
    if I_CompareCounter a2u15_status != 2
    set_counter a2u15_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u15 moving
    and ! I_UnitStatus a2u15 routing
    set_counter a2u15_status 0
    end_if

    if I_CompareCounter a2u15_status > 0

    if I_UnitDistanceFromPosition a2u15 0,0 >= 150
    and I_UnitDistanceFromPosition a2u15 0,0 < 175
    if I_CompareCounter a2u15_distance != 1
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 1
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 175
    and I_UnitDistanceFromPosition a2u15 0,0 < 200
    if I_CompareCounter a2u15_distance != 2
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 2
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 200
    and I_UnitDistanceFromPosition a2u15 0,0 < 225
    if I_CompareCounter a2u15_distance != 3
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 3
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 225
    and I_UnitDistanceFromPosition a2u15 0,0 < 250
    if I_CompareCounter a2u15_distance != 4
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 4
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 250
    and I_UnitDistanceFromPosition a2u15 0,0 < 275
    if I_CompareCounter a2u15_distance != 5
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 5
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 275
    and I_UnitDistanceFromPosition a2u15 0,0 < 300
    if I_CompareCounter a2u15_distance != 6
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 6
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 300
    and I_UnitDistanceFromPosition a2u15 0,0 < 325
    if I_CompareCounter a2u15_distance != 7
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 7
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 325
    and I_UnitDistanceFromPosition a2u15 0,0 < 350
    if I_CompareCounter a2u15_distance != 8
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 8
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 350
    and I_UnitDistanceFromPosition a2u15 0,0 < 375
    if I_CompareCounter a2u15_distance != 9
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 9
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 375
    and I_UnitDistanceFromPosition a2u15 0,0 < 400
    if I_CompareCounter a2u15_distance != 10
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 10
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 400
    and I_UnitDistanceFromPosition a2u15 0,0 < 425
    if I_CompareCounter a2u15_distance != 11
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 11
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 425
    and I_UnitDistanceFromPosition a2u15 0,0 < 450
    if I_CompareCounter a2u15_distance != 12
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 12
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 450
    and I_UnitDistanceFromPosition a2u15 0,0 < 500
    if I_CompareCounter a2u15_distance != 13
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 13
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 500
    and I_UnitDistanceFromPosition a2u15 0,0 < 550
    if I_CompareCounter a2u15_distance != 14
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 14
    inc_counter a2u15_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u15 0,0 >= 550
    and I_UnitDistanceFromPosition a2u15 0,0 < 600
    if I_CompareCounter a2u15_distance != 15
    set_counter a2u15_stuck 0
    end_if
    set_counter a2u15_distance 15
    inc_counter a2u15_stuck 1
    end_if

    if I_CompareCounter a2u15_stuck = 4
    unit_order_halt a2u15
    unit_set_morale a2u15 wavering
    battle_wait 0.1
    unit_unset_morale a2u15
    release_unit a2u15
    set_counter a2u15_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 15
and ! I_UnitDestroyed a2u16

    if I_UnitStatus a2u16 moving
    if I_CompareCounter a2u16_status = 0
    set_counter a2u16_status 1
    end_if
    if I_CompareCounter a2u16_status != 1
    set_counter a2u16_status 0
    end_if
    end_if

    if I_UnitStatus a2u16 routing
    if I_CompareCounter a2u16_status = 0
    set_counter a2u16_status 2
    end_if
    if I_CompareCounter a2u16_status != 2
    set_counter a2u16_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u16 moving
    and ! I_UnitStatus a2u16 routing
    set_counter a2u16_status 0
    end_if

    if I_CompareCounter a2u16_status > 0

    if I_UnitDistanceFromPosition a2u16 0,0 >= 150
    and I_UnitDistanceFromPosition a2u16 0,0 < 175
    if I_CompareCounter a2u16_distance != 1
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 1
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 175
    and I_UnitDistanceFromPosition a2u16 0,0 < 200
    if I_CompareCounter a2u16_distance != 2
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 2
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 200
    and I_UnitDistanceFromPosition a2u16 0,0 < 225
    if I_CompareCounter a2u16_distance != 3
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 3
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 225
    and I_UnitDistanceFromPosition a2u16 0,0 < 250
    if I_CompareCounter a2u16_distance != 4
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 4
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 250
    and I_UnitDistanceFromPosition a2u16 0,0 < 275
    if I_CompareCounter a2u16_distance != 5
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 5
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 275
    and I_UnitDistanceFromPosition a2u16 0,0 < 300
    if I_CompareCounter a2u16_distance != 6
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 6
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 300
    and I_UnitDistanceFromPosition a2u16 0,0 < 325
    if I_CompareCounter a2u16_distance != 7
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 7
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 325
    and I_UnitDistanceFromPosition a2u16 0,0 < 350
    if I_CompareCounter a2u16_distance != 8
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 8
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 350
    and I_UnitDistanceFromPosition a2u16 0,0 < 375
    if I_CompareCounter a2u16_distance != 9
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 9
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 375
    and I_UnitDistanceFromPosition a2u16 0,0 < 400
    if I_CompareCounter a2u16_distance != 10
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 10
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 400
    and I_UnitDistanceFromPosition a2u16 0,0 < 425
    if I_CompareCounter a2u16_distance != 11
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 11
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 425
    and I_UnitDistanceFromPosition a2u16 0,0 < 450
    if I_CompareCounter a2u16_distance != 12
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 12
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 450
    and I_UnitDistanceFromPosition a2u16 0,0 < 500
    if I_CompareCounter a2u16_distance != 13
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 13
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 500
    and I_UnitDistanceFromPosition a2u16 0,0 < 550
    if I_CompareCounter a2u16_distance != 14
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 14
    inc_counter a2u16_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u16 0,0 >= 550
    and I_UnitDistanceFromPosition a2u16 0,0 < 600
    if I_CompareCounter a2u16_distance != 15
    set_counter a2u16_stuck 0
    end_if
    set_counter a2u16_distance 15
    inc_counter a2u16_stuck 1
    end_if

    if I_CompareCounter a2u16_stuck = 4
    unit_order_halt a2u16
    unit_set_morale a2u16 wavering
    battle_wait 0.1
    unit_unset_morale a2u16
    release_unit a2u16
    set_counter a2u16_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 16
and ! I_UnitDestroyed a2u17

    if I_UnitStatus a2u17 moving
    if I_CompareCounter a2u17_status = 0
    set_counter a2u17_status 1
    end_if
    if I_CompareCounter a2u17_status != 1
    set_counter a2u17_status 0
    end_if
    end_if

    if I_UnitStatus a2u17 routing
    if I_CompareCounter a2u17_status = 0
    set_counter a2u17_status 2
    end_if
    if I_CompareCounter a2u17_status != 2
    set_counter a2u17_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u17 moving
    and ! I_UnitStatus a2u17 routing
    set_counter a2u17_status 0
    end_if

    if I_CompareCounter a2u17_status > 0

    if I_UnitDistanceFromPosition a2u17 0,0 >= 150
    and I_UnitDistanceFromPosition a2u17 0,0 < 175
    if I_CompareCounter a2u17_distance != 1
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 1
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 175
    and I_UnitDistanceFromPosition a2u17 0,0 < 200
    if I_CompareCounter a2u17_distance != 2
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 2
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 200
    and I_UnitDistanceFromPosition a2u17 0,0 < 225
    if I_CompareCounter a2u17_distance != 3
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 3
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 225
    and I_UnitDistanceFromPosition a2u17 0,0 < 250
    if I_CompareCounter a2u17_distance != 4
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 4
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 250
    and I_UnitDistanceFromPosition a2u17 0,0 < 275
    if I_CompareCounter a2u17_distance != 5
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 5
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 275
    and I_UnitDistanceFromPosition a2u17 0,0 < 300
    if I_CompareCounter a2u17_distance != 6
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 6
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 300
    and I_UnitDistanceFromPosition a2u17 0,0 < 325
    if I_CompareCounter a2u17_distance != 7
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 7
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 325
    and I_UnitDistanceFromPosition a2u17 0,0 < 350
    if I_CompareCounter a2u17_distance != 8
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 8
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 350
    and I_UnitDistanceFromPosition a2u17 0,0 < 375
    if I_CompareCounter a2u17_distance != 9
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 9
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 375
    and I_UnitDistanceFromPosition a2u17 0,0 < 400
    if I_CompareCounter a2u17_distance != 10
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 10
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 400
    and I_UnitDistanceFromPosition a2u17 0,0 < 425
    if I_CompareCounter a2u17_distance != 11
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 11
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 425
    and I_UnitDistanceFromPosition a2u17 0,0 < 450
    if I_CompareCounter a2u17_distance != 12
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 12
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 450
    and I_UnitDistanceFromPosition a2u17 0,0 < 500
    if I_CompareCounter a2u17_distance != 13
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 13
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 500
    and I_UnitDistanceFromPosition a2u17 0,0 < 550
    if I_CompareCounter a2u17_distance != 14
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 14
    inc_counter a2u17_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u17 0,0 >= 550
    and I_UnitDistanceFromPosition a2u17 0,0 < 600
    if I_CompareCounter a2u17_distance != 15
    set_counter a2u17_stuck 0
    end_if
    set_counter a2u17_distance 15
    inc_counter a2u17_stuck 1
    end_if

    if I_CompareCounter a2u17_stuck = 4
    unit_order_halt a2u17
    unit_set_morale a2u17 wavering
    battle_wait 0.1
    unit_unset_morale a2u17
    release_unit a2u17
    set_counter a2u17_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 17
and ! I_UnitDestroyed a2u18

    if I_UnitStatus a2u18 moving
    if I_CompareCounter a2u18_status = 0
    set_counter a2u18_status 1
    end_if
    if I_CompareCounter a2u18_status != 1
    set_counter a2u18_status 0
    end_if
    end_if

    if I_UnitStatus a2u18 routing
    if I_CompareCounter a2u18_status = 0
    set_counter a2u18_status 2
    end_if
    if I_CompareCounter a2u18_status != 2
    set_counter a2u18_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u18 moving
    and ! I_UnitStatus a2u18 routing
    set_counter a2u18_status 0
    end_if

    if I_CompareCounter a2u18_status > 0

    if I_UnitDistanceFromPosition a2u18 0,0 >= 150
    and I_UnitDistanceFromPosition a2u18 0,0 < 175
    if I_CompareCounter a2u18_distance != 1
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 1
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 175
    and I_UnitDistanceFromPosition a2u18 0,0 < 200
    if I_CompareCounter a2u18_distance != 2
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 2
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 200
    and I_UnitDistanceFromPosition a2u18 0,0 < 225
    if I_CompareCounter a2u18_distance != 3
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 3
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 225
    and I_UnitDistanceFromPosition a2u18 0,0 < 250
    if I_CompareCounter a2u18_distance != 4
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 4
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 250
    and I_UnitDistanceFromPosition a2u18 0,0 < 275
    if I_CompareCounter a2u18_distance != 5
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 5
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 275
    and I_UnitDistanceFromPosition a2u18 0,0 < 300
    if I_CompareCounter a2u18_distance != 6
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 6
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 300
    and I_UnitDistanceFromPosition a2u18 0,0 < 325
    if I_CompareCounter a2u18_distance != 7
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 7
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 325
    and I_UnitDistanceFromPosition a2u18 0,0 < 350
    if I_CompareCounter a2u18_distance != 8
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 8
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 350
    and I_UnitDistanceFromPosition a2u18 0,0 < 375
    if I_CompareCounter a2u18_distance != 9
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 9
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 375
    and I_UnitDistanceFromPosition a2u18 0,0 < 400
    if I_CompareCounter a2u18_distance != 10
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 10
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 400
    and I_UnitDistanceFromPosition a2u18 0,0 < 425
    if I_CompareCounter a2u18_distance != 11
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 11
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 425
    and I_UnitDistanceFromPosition a2u18 0,0 < 450
    if I_CompareCounter a2u18_distance != 12
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 12
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 450
    and I_UnitDistanceFromPosition a2u18 0,0 < 500
    if I_CompareCounter a2u18_distance != 13
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 13
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 500
    and I_UnitDistanceFromPosition a2u18 0,0 < 550
    if I_CompareCounter a2u18_distance != 14
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 14
    inc_counter a2u18_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u18 0,0 >= 550
    and I_UnitDistanceFromPosition a2u18 0,0 < 600
    if I_CompareCounter a2u18_distance != 15
    set_counter a2u18_stuck 0
    end_if
    set_counter a2u18_distance 15
    inc_counter a2u18_stuck 1
    end_if

    if I_CompareCounter a2u18_stuck = 4
    unit_order_halt a2u18
    unit_set_morale a2u18 wavering
    battle_wait 0.1
    unit_unset_morale a2u18
    release_unit a2u18
    set_counter a2u18_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count > 18
and ! I_UnitDestroyed a2u19

    if I_UnitStatus a2u19 moving
    if I_CompareCounter a2u19_status = 0
    set_counter a2u19_status 1
    end_if
    if I_CompareCounter a2u19_status != 1
    set_counter a2u19_status 0
    end_if
    end_if

    if I_UnitStatus a2u19 routing
    if I_CompareCounter a2u19_status = 0
    set_counter a2u19_status 2
    end_if
    if I_CompareCounter a2u19_status != 2
    set_counter a2u19_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u19 moving
    and ! I_UnitStatus a2u19 routing
    set_counter a2u19_status 0
    end_if

    if I_CompareCounter a2u19_status > 0

    if I_UnitDistanceFromPosition a2u19 0,0 >= 150
    and I_UnitDistanceFromPosition a2u19 0,0 < 175
    if I_CompareCounter a2u19_distance != 1
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 1
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 175
    and I_UnitDistanceFromPosition a2u19 0,0 < 200
    if I_CompareCounter a2u19_distance != 2
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 2
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 200
    and I_UnitDistanceFromPosition a2u19 0,0 < 225
    if I_CompareCounter a2u19_distance != 3
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 3
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 225
    and I_UnitDistanceFromPosition a2u19 0,0 < 250
    if I_CompareCounter a2u19_distance != 4
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 4
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 250
    and I_UnitDistanceFromPosition a2u19 0,0 < 275
    if I_CompareCounter a2u19_distance != 5
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 5
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 275
    and I_UnitDistanceFromPosition a2u19 0,0 < 300
    if I_CompareCounter a2u19_distance != 6
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 6
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 300
    and I_UnitDistanceFromPosition a2u19 0,0 < 325
    if I_CompareCounter a2u19_distance != 7
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 7
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 325
    and I_UnitDistanceFromPosition a2u19 0,0 < 350
    if I_CompareCounter a2u19_distance != 8
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 8
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 350
    and I_UnitDistanceFromPosition a2u19 0,0 < 375
    if I_CompareCounter a2u19_distance != 9
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 9
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 375
    and I_UnitDistanceFromPosition a2u19 0,0 < 400
    if I_CompareCounter a2u19_distance != 10
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 10
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 400
    and I_UnitDistanceFromPosition a2u19 0,0 < 425
    if I_CompareCounter a2u19_distance != 11
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 11
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 425
    and I_UnitDistanceFromPosition a2u19 0,0 < 450
    if I_CompareCounter a2u19_distance != 12
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 12
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 450
    and I_UnitDistanceFromPosition a2u19 0,0 < 500
    if I_CompareCounter a2u19_distance != 13
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 13
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 500
    and I_UnitDistanceFromPosition a2u19 0,0 < 550
    if I_CompareCounter a2u19_distance != 14
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 14
    inc_counter a2u19_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u19 0,0 >= 550
    and I_UnitDistanceFromPosition a2u19 0,0 < 600
    if I_CompareCounter a2u19_distance != 15
    set_counter a2u19_stuck 0
    end_if
    set_counter a2u19_distance 15
    inc_counter a2u19_stuck 1
    end_if

    if I_CompareCounter a2u19_stuck = 4
    unit_order_halt a2u19
    unit_set_morale a2u19 wavering
    battle_wait 0.1
    unit_unset_morale a2u19
    release_unit a2u19
    set_counter a2u19_stuck 0
    end_if

    end_if
end_if

if I_CompareCounter enemy_unit_count = 20
and ! I_UnitDestroyed a2u20

    if I_UnitStatus a2u20 moving
    if I_CompareCounter a2u20_status = 0
    set_counter a2u20_status 1
    end_if
    if I_CompareCounter a2u20_status != 1
    set_counter a2u20_status 0
    end_if
    end_if

    if I_UnitStatus a2u20 routing
    if I_CompareCounter a2u20_status = 0
    set_counter a2u20_status 2
    end_if
    if I_CompareCounter a2u20_status != 2
    set_counter a2u20_status 0
    end_if
    end_if

    if ! I_UnitStatus a2u20 moving
    and ! I_UnitStatus a2u20 routing
    set_counter a2u20_status 0
    end_if

    if I_CompareCounter a2u20_status > 0

    if I_UnitDistanceFromPosition a2u20 0,0 >= 150
    and I_UnitDistanceFromPosition a2u20 0,0 < 175
    if I_CompareCounter a2u20_distance != 1
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 1
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 175
    and I_UnitDistanceFromPosition a2u20 0,0 < 200
    if I_CompareCounter a2u20_distance != 2
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 2
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 200
    and I_UnitDistanceFromPosition a2u20 0,0 < 225
    if I_CompareCounter a2u20_distance != 3
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 3
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 225
    and I_UnitDistanceFromPosition a2u20 0,0 < 250
    if I_CompareCounter a2u20_distance != 4
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 4
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 250
    and I_UnitDistanceFromPosition a2u20 0,0 < 275
    if I_CompareCounter a2u20_distance != 5
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 5
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 275
    and I_UnitDistanceFromPosition a2u20 0,0 < 300
    if I_CompareCounter a2u20_distance != 6
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 6
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 300
    and I_UnitDistanceFromPosition a2u20 0,0 < 325
    if I_CompareCounter a2u20_distance != 7
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 7
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 325
    and I_UnitDistanceFromPosition a2u20 0,0 < 350
    if I_CompareCounter a2u20_distance != 8
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 8
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 350
    and I_UnitDistanceFromPosition a2u20 0,0 < 375
    if I_CompareCounter a2u20_distance != 9
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 9
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 375
    and I_UnitDistanceFromPosition a2u20 0,0 < 400
    if I_CompareCounter a2u20_distance != 10
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 10
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 400
    and I_UnitDistanceFromPosition a2u20 0,0 < 425
    if I_CompareCounter a2u20_distance != 11
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 11
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 425
    and I_UnitDistanceFromPosition a2u20 0,0 < 450
    if I_CompareCounter a2u20_distance != 12
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 12
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 450
    and I_UnitDistanceFromPosition a2u20 0,0 < 500
    if I_CompareCounter a2u20_distance != 13
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 13
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 500
    and I_UnitDistanceFromPosition a2u20 0,0 < 550
    if I_CompareCounter a2u20_distance != 14
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 14
    inc_counter a2u20_stuck 1
    end_if

    if I_UnitDistanceFromPosition a2u20 0,0 >= 550
    and I_UnitDistanceFromPosition a2u20 0,0 < 600
    if I_CompareCounter a2u20_distance != 15
    set_counter a2u20_stuck 0
    end_if
    set_counter a2u20_distance 15
    inc_counter a2u20_stuck 1
    end_if

    if I_CompareCounter a2u20_stuck = 4
    unit_order_halt a2u20
    unit_set_morale a2u20 wavering
    battle_wait 0.1
    unit_unset_morale a2u20
    release_unit a2u20
    set_counter a2u20_stuck 0
    end_if

    end_if
end_if

    battle_wait 10
end_monitor

;;;;;;;Anti-CTD
monitor_event BattleDeploymentPhaseCommenced FactionIsLocal
    wait 0.5
    simulate_mouse_click lclick_down
    simulate_mouse_click lclick_up
end_monitor

;################## Cleaning up ##################

monitor_event ScrollOpened ScrollOpened post_battle_scroll

    ;;;;;;;
    set_counter fire_labels 0
;    set_counter panel_check 0
    set_counter player_unit_count 0
    set_counter enemy_unit_count 0
    set_counter open_battle 0
    set_counter labels_only 0
    set_counter stakes_lock 0
    ;;;;;;;
    set_counter pu1_missile 0
    set_counter pu2_missile 0
    set_counter pu3_missile 0
    set_counter pu4_missile 0
    set_counter pu5_missile 0
    set_counter pu6_missile 0
    set_counter pu7_missile 0
    set_counter pu8_missile 0
    set_counter pu9_missile 0
    set_counter pu10_missile 0
    set_counter pu11_missile 0
    set_counter pu12_missile 0
    set_counter pu13_missile 0
    set_counter pu14_missile 0
    set_counter pu15_missile 0
    set_counter pu16_missile 0
    set_counter pu17_missile 0
    set_counter pu18_missile 0
    set_counter pu19_missile 0
    set_counter pu20_missile 0
    ;;;;;;;Checks
    set_counter check_timer 0
    set_counter elephant_fix_check 0
    set_counter elephant_fix_check_sally 0
    set_counter reinf_check 0
    set_counter script_delay 0
    set_counter sally_defense_check 0
    set_counter sally_check 0
    ;;;;;;;Stakes
    set_counter label_ready 0
    set_counter stakes_on 0
    ;;;;;;;Reinforcements
    set_counter army4_ready 0
    set_counter reinf_late 0

    set_counter distance_trigger1 0
    set_counter distance_trigger2 0
    set_counter distance_trigger3 0
    set_counter distance_trigger4 0
    set_counter distance_trigger5 0

    set_counter kill_labelling_reinf_allied 0
    set_counter army3_reinf_allied 0
    set_counter army4_reinf_allied 0
    set_counter army5_reinf_allied 0
    set_counter army6_reinf_allied 0
    set_counter army7_reinf_allied 0
    set_counter army8_reinf_allied 0
    set_counter army9_reinf_allied 0
    set_counter army10_reinf_allied 0
    set_counter army11_reinf_allied 0
    set_counter army12_reinf_allied 0
    set_counter army13_reinf_allied 0
    set_counter army14_reinf_allied 0
    set_counter army15_reinf_allied 0
    set_counter army16_reinf_allied 0
    set_counter launch_alliance_0 0
    set_counter launch_alliance_1 0

    set_counter apply_strategy 0
    set_counter relaunch_movement 0

    set_counter att_alliance_ready 0
    set_counter def_alliance_ready 0
    set_counter def_alliance_ready_siege 0

    set_counter army3_moving 0
    set_counter army3_run 0
    set_counter army3_reinf_late 0
    set_counter army4_moving 0
    set_counter army4_run 0
    set_counter army4_reinf_late 0
    set_counter army5_moving 0
    set_counter army5_run 0
    set_counter army5_reinf_late 0
    set_counter army6_moving 0
    set_counter army6_run 0
    set_counter army6_reinf_late 0
    set_counter army7_moving 0
    set_counter army7_run 0
    set_counter army7_reinf_late 0
    set_counter army8_moving 0
    set_counter army8_run 0
    set_counter army8_reinf_late 0
    set_counter army9_moving 0
    set_counter army9_run 0
    set_counter army9_reinf_late 0
    set_counter army10_moving 0
    set_counter army10_run 0
    set_counter army10_reinf_late 0
    set_counter army11_moving 0
    set_counter army11_run 0
    set_counter army11_reinf_late 0
    set_counter army12_moving 0
    set_counter army12_run 0
    set_counter army12_reinf_late 0
    set_counter army13_moving 0
    set_counter army13_run 0
    set_counter army13_reinf_late 0
    set_counter army14_moving 0
    set_counter army14_run 0
    set_counter army14_reinf_late 0
    set_counter army15_moving 0
    set_counter army15_run 0
    set_counter army15_reinf_late 0
    set_counter army16_moving 0
    set_counter army16_run 0
    set_counter army16_reinf_late 0

    set_counter army4_ready_siege 0 ; acts as launching counter
    set_counter army4_moving_siege 0
    set_counter army4_run_siege 0
    set_counter reinf_check_interval 0

    ;;;;;;;HA Fix
    set_counter ha_fix 0
    ;;;;;;;Elephant Fix
    set_counter elephant_fix 0
    set_counter elephant_gate 0
    set_counter elephant_gate_s 0
    set_counter elephant_gate_tier2 0
    set_counter elephant_gate_tier3 0
    set_counter elephant_gate_tier2s 0
    set_counter elephant_gate_tier3s 0
    set_counter rally_walls 0
    set_counter rally_walls_s 0
    set_counter second_ring 0
    set_counter third_ring 0
    set_counter second_ring_s 0
    set_counter third_ring_s 0
    set_counter del_objective 0
    set_counter del_objective_s 0
    ;;;;;;;Sally-out
    set_counter sally-out_fix 0
    set_counter sally_defense 0
    set_counter reform_back 0
    set_counter reform_multi 0
    set_counter unit_under_fire 0
    set_counter kill_sally 0
    set_counter sally_reinf 0
    set_counter reset_position 0
    set_counter defend_location 0
    set_counter reset_army2 0
    set_counter assign_labels 0
    ;;;;;;;Siege
    set_counter siege_fix 0
    set_counter army_sieging 0
    set_counter army_south 0
    set_counter army_north 0
    set_counter army_east 0
    set_counter army_west 0
    set_counter emergency_stop 0
    set_counter omfg_cannon_tower 0
    set_counter army2_sally 0
    set_counter wall_advance_s 0
    ;;;;;;;Protect General
    set_counter protect_general 0
    set_counter general_wait 0
    set_counter protect_siege 0
    set_counter g_stop 0
    ;;;;;;;Sally-out, AI defending
    set_counter army4_ready_sally 0
    set_counter army4_location 0
    set_counter path_n 0
    set_counter path_ne 0
    set_counter path_e 0
    set_counter path_se 0
    set_counter path_s 0
    set_counter path_sw 0
    set_counter path_w 0
    set_counter path_nw 0
    set_counter obstacle_check 0
    set_counter label_army4 0
    set_counter army4_moving_s 0
    set_counter army4_idle_s 0
    set_counter line_passed 0
    set_counter army2_idle_s 0
    set_counter army4_idle_r 0
    set_counter wall_line_passed 0
    set_counter reset_position_s 0
    set_counter repeat_test1 0
    set_counter repeat_test2 0
    set_counter repeat_test3 0
    set_counter repeat_test4 0
    set_counter repeat_test5 0
    set_counter repeat_test6 0
    ;;;;;;;Open Battles
    set_counter ob_defense_launch 0
    set_counter ob_defend 0
    set_counter ob_siege_attack 0
    set_counter ob_under_fire 0
    set_counter ob_repeat_test 0
    set_counter ob_engaged 0
    set_counter player_units_closing 0
    set_counter player_enveloping 0
    set_counter player_engaged_reinf 0
    ;;;;;;;AI Stuck Fix
    set_counter ai_stuck_launch 0
    set_counter a2u1_stuck 0
    set_counter a2u2_stuck 0
    set_counter a2u3_stuck 0
    set_counter a2u4_stuck 0
    set_counter a2u5_stuck 0
    set_counter a2u6_stuck 0
    set_counter a2u7_stuck 0
    set_counter a2u8_stuck 0
    set_counter a2u9_stuck 0
    set_counter a2u10_stuck 0
    set_counter a2u11_stuck 0
    set_counter a2u12_stuck 0
    set_counter a2u13_stuck 0
    set_counter a2u14_stuck 0
    set_counter a2u15_stuck 0
    set_counter a2u16_stuck 0
    set_counter a2u17_stuck 0
    set_counter a2u18_stuck 0
    set_counter a2u19_stuck 0
    set_counter a2u20_stuck 0
    set_counter a2u1_status 0
    set_counter a2u2_status 0
    set_counter a2u3_status 0
    set_counter a2u4_status 0
    set_counter a2u5_status 0
    set_counter a2u6_status 0
    set_counter a2u7_status 0
    set_counter a2u8_status 0
    set_counter a2u9_status 0
    set_counter a2u10_status 0
    set_counter a2u11_status 0
    set_counter a2u12_status 0
    set_counter a2u13_status 0
    set_counter a2u14_status 0
    set_counter a2u15_status 0
    set_counter a2u16_status 0
    set_counter a2u17_status 0
    set_counter a2u18_status 0
    set_counter a2u19_status 0
    set_counter a2u20_status 0
    set_counter a2u1_distance 0
    set_counter a2u2_distance 0
    set_counter a2u3_distance 0
    set_counter a2u4_distance 0
    set_counter a2u5_distance 0
    set_counter a2u6_distance 0
    set_counter a2u7_distance 0
    set_counter a2u8_distance 0
    set_counter a2u9_distance 0
    set_counter a2u10_distance 0
    set_counter a2u11_distance 0
    set_counter a2u12_distance 0
    set_counter a2u13_distance 0
    set_counter a2u14_distance 0
    set_counter a2u15_distance 0
    set_counter a2u16_distance 0
    set_counter a2u17_distance 0
    set_counter a2u18_distance 0
    set_counter a2u19_distance 0
    set_counter a2u20_distance 0
;    suspend_unscripted_advice false
end_monitor

;=======================================================;
;================= ADDITIONAL SCRIPTS ==================;
;=======================================================;
    wait_monitors

end_script

